/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{FirebaseError:()=>y,SDK_VERSION:()=>_e,_DEFAULT_ENTRY_NAME:()=>ce,_addComponent:()=>de,_addOrOverwriteComponent:()=>fe,_apps:()=>le,_clearComponents:()=>ye,_components:()=>he,_getProvider:()=>me,_registerComponent:()=>pe,_removeServiceInstance:()=>ge,deleteApp:()=>Ee,getApp:()=>be,getApps:()=>Te,initializeApp:()=>Ie,onLog:()=>Se,registerVersion:()=>Ce,setLogLevel:()=>Ae});const n=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==o||null==a||null==c)throw new i;const u=s<<2|o>>4;if(r.push(u),64!==a){const e=o<<4&240|a>>2;if(r.push(e),64!==c){const e=a<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(e){return function(e){const t=n(e);return r.encodeByteArray(t,!0)}(e).replace(/\./g,"")},o=function(e){try{return r.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function a(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=a(e[n],t[n]));return e}const c=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0==={ALLUSERSPROFILE:"C:\\ProgramData",APPDATA:"C:\\Users\\tanuj\\AppData\\Roaming",ChocolateyInstall:"C:\\ProgramData\\chocolatey",ChocolateyLastPathUpdate:"133002477445968421",COLOR:"1",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"TANUJS-PC",ComSpec:"C:\\Windows\\system32\\cmd.exe",CUDA_PATH:"C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8",CUDA_PATH_V11_8:"C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EDITOR:"C:\\Windows\\notepad.exe",HOME:"C:\\Users\\tanuj",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\tanuj",INIT_CWD:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend",JAVA_HOME:"C:\\Program Files (x86)\\Eclipse Adoptium\\jdk-16.0.2.7-hotspot\\",LOCALAPPDATA:"C:\\Users\\tanuj\\AppData\\Local",LOGONSERVER:"\\\\TANUJS-PC",NODE:"C:\\Program Files\\nodejs\\node.exe",NODE_EXE:"C:\\Program Files\\nodejs\\\\node.exe",NPM_CLI_JS:"C:\\Program Files\\nodejs\\\\node_modules\\npm\\bin\\npm-cli.js",npm_command:"exec",npm_config_cache:"C:\\Users\\tanuj\\AppData\\Local\\npm-cache",npm_config_globalconfig:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\etc\\npmrc",npm_config_global_prefix:"C:\\Users\\tanuj\\AppData\\Roaming\\npm",npm_config_init_module:"C:\\Users\\tanuj\\.npm-init.js",npm_config_local_prefix:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend",npm_config_metrics_registry:"https://registry.npmjs.org/",npm_config_node_gyp:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js",npm_config_noproxy:"",npm_config_prefix:"C:\\Users\\tanuj\\AppData\\Roaming\\npm",npm_config_userconfig:"C:\\Users\\tanuj\\.npmrc",npm_config_user_agent:"npm/9.6.5 node/v18.12.1 win32 x64 workspaces/false",npm_execpath:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npx-cli.js",npm_lifecycle_event:"npx",npm_lifecycle_script:"webpack",npm_node_execpath:"C:\\Program Files\\nodejs\\node.exe",npm_package_json:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend\\package.json",npm_package_name:"frontend",npm_package_version:"1.0.0",NPM_PREFIX_NPX_CLI_JS:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npx-cli.js",NPX_CLI_JS:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npx-cli.js",NUMBER_OF_PROCESSORS:"16",NVTOOLSEXT_PATH:"C:\\Program Files\\NVIDIA Corporation\\NvToolsExt\\",OneDrive:"C:\\Users\\tanuj\\OneDrive",OneDriveConsumer:"C:\\Users\\tanuj\\OneDrive",OPENAI_API_KEY:"test",OS:"Windows_NT",Path:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend\\node_modules\\.bin;C:\\Users\\tanuj\\Code\\WriteRight\\frontend\\node_modules\\.bin;C:\\Users\\tanuj\\Code\\WriteRight\\node_modules\\.bin;C:\\Users\\tanuj\\Code\\node_modules\\.bin;C:\\Users\\tanuj\\node_modules\\.bin;C:\\Users\\node_modules\\.bin;C:\\node_modules\\.bin;C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\@npmcli\\run-script\\lib\\node-gyp-bin;C:\\Program Files\\Eclipse Adoptium\\jdk-11.0.17.8-hotspot\\bin;C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8\\bin;C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8\\libnvvp;C:\\Users\\tanuj\\AppData\\Local\\Programs\\Python\\Python310\\Scripts\\;C:\\Users\\tanuj\\AppData\\Local\\Programs\\Python\\Python310\\;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\Program Files (x86)\\Eclipse Adoptium\\jdk-16.0.2.7-hotspot\\bin;C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\;C:\\Windows\\System32\\OpenSSH\\;D:\\Program Files\\PuTTY\\;C:\\Program Files (x86)\\NVIDIA Corporation\\PhysX\\Common;C:\\Program Files\\NVIDIA Corporation\\NVIDIA NvDLISR;C:\\Program Files\\Git\\cmd;C:\\ProgramData\\chocolatey\\bin;C:\\Program Files\\dotnet\\;C:\\Program Files\\Docker\\Docker\\resources\\bin;C:\\ProgramData\\DockerDesktop\\version-bin;C:\\Program Files\\WireGuard\\;C:\\Program Files\\NVIDIA Corporation\\Nsight Compute 2022.3.0\\;C:\\Program Files\\nodejs\\;C:\\Program Files\\Tailscale\\;C:\\Users\\tanuj\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\tanuj\\AppData\\Local\\atom\\bin;C:\\Program Files\\heroku\\bin;C:\\Program Files (x86)\\Nmap;C:\\Users\\tanuj\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\tanuj\\.dotnet\\tools;C:\\Users\\tanuj\\anaconda3\\Library\\bin;C:\\Users\\tanuj\\anaconda3\\Scripts;C:\\Users\\tanuj\\anaconda3\\condabin;C:\\Users\\tanuj\\AppData\\Roaming\\npm;C:\\Users\\tanuj\\AppData\\Local\\Programs\\oh-my-posh\\bin;C:\\ffmpeg-2023-05-11-git-ceb050427c-full_build\\bin",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.PY;.PYW",POSH_THEMES_PATH:"C:\\Users\\tanuj\\AppData\\Local\\Programs\\oh-my-posh\\themes",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 165 Stepping 5, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"a505",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Program Files\\WindowsPowerShell\\Modules;C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",SystemDrive:"C:",SystemRoot:"C:\\Windows",TEMP:"C:\\Users\\tanuj\\AppData\\Local\\Temp",TMP:"C:\\Users\\tanuj\\AppData\\Local\\Temp",USERDOMAIN:"TANUJS-PC",USERDOMAIN_ROAMINGPROFILE:"TANUJS-PC",USERNAME:"tanuj",USERPROFILE:"C:\\Users\\tanuj",VBOX_MSI_INSTALL_PATH:"C:\\Program Files\\Oracle\\VirtualBox\\",windir:"C:\\Windows",WSLENV:"WT_SESSION::WT_PROFILE_ID",WT_PROFILE_ID:"{0caa0dad-35be-5f56-a8ff-afceeeaa6101}",WT_SESSION:"d47979e6-8af5-40d1-a7e6-32dae0c3ba1d",ZES_ENABLE_SYSMAN:"1"})return;const e={ALLUSERSPROFILE:"C:\\ProgramData",APPDATA:"C:\\Users\\tanuj\\AppData\\Roaming",ChocolateyInstall:"C:\\ProgramData\\chocolatey",ChocolateyLastPathUpdate:"133002477445968421",COLOR:"1",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"TANUJS-PC",ComSpec:"C:\\Windows\\system32\\cmd.exe",CUDA_PATH:"C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8",CUDA_PATH_V11_8:"C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EDITOR:"C:\\Windows\\notepad.exe",HOME:"C:\\Users\\tanuj",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\tanuj",INIT_CWD:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend",JAVA_HOME:"C:\\Program Files (x86)\\Eclipse Adoptium\\jdk-16.0.2.7-hotspot\\",LOCALAPPDATA:"C:\\Users\\tanuj\\AppData\\Local",LOGONSERVER:"\\\\TANUJS-PC",NODE:"C:\\Program Files\\nodejs\\node.exe",NODE_EXE:"C:\\Program Files\\nodejs\\\\node.exe",NPM_CLI_JS:"C:\\Program Files\\nodejs\\\\node_modules\\npm\\bin\\npm-cli.js",npm_command:"exec",npm_config_cache:"C:\\Users\\tanuj\\AppData\\Local\\npm-cache",npm_config_globalconfig:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\etc\\npmrc",npm_config_global_prefix:"C:\\Users\\tanuj\\AppData\\Roaming\\npm",npm_config_init_module:"C:\\Users\\tanuj\\.npm-init.js",npm_config_local_prefix:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend",npm_config_metrics_registry:"https://registry.npmjs.org/",npm_config_node_gyp:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js",npm_config_noproxy:"",npm_config_prefix:"C:\\Users\\tanuj\\AppData\\Roaming\\npm",npm_config_userconfig:"C:\\Users\\tanuj\\.npmrc",npm_config_user_agent:"npm/9.6.5 node/v18.12.1 win32 x64 workspaces/false",npm_execpath:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npx-cli.js",npm_lifecycle_event:"npx",npm_lifecycle_script:"webpack",npm_node_execpath:"C:\\Program Files\\nodejs\\node.exe",npm_package_json:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend\\package.json",npm_package_name:"frontend",npm_package_version:"1.0.0",NPM_PREFIX_NPX_CLI_JS:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npx-cli.js",NPX_CLI_JS:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npx-cli.js",NUMBER_OF_PROCESSORS:"16",NVTOOLSEXT_PATH:"C:\\Program Files\\NVIDIA Corporation\\NvToolsExt\\",OneDrive:"C:\\Users\\tanuj\\OneDrive",OneDriveConsumer:"C:\\Users\\tanuj\\OneDrive",OPENAI_API_KEY:"test",OS:"Windows_NT",Path:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend\\node_modules\\.bin;C:\\Users\\tanuj\\Code\\WriteRight\\frontend\\node_modules\\.bin;C:\\Users\\tanuj\\Code\\WriteRight\\node_modules\\.bin;C:\\Users\\tanuj\\Code\\node_modules\\.bin;C:\\Users\\tanuj\\node_modules\\.bin;C:\\Users\\node_modules\\.bin;C:\\node_modules\\.bin;C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\@npmcli\\run-script\\lib\\node-gyp-bin;C:\\Program Files\\Eclipse Adoptium\\jdk-11.0.17.8-hotspot\\bin;C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8\\bin;C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8\\libnvvp;C:\\Users\\tanuj\\AppData\\Local\\Programs\\Python\\Python310\\Scripts\\;C:\\Users\\tanuj\\AppData\\Local\\Programs\\Python\\Python310\\;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\Program Files (x86)\\Eclipse Adoptium\\jdk-16.0.2.7-hotspot\\bin;C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\;C:\\Windows\\System32\\OpenSSH\\;D:\\Program Files\\PuTTY\\;C:\\Program Files (x86)\\NVIDIA Corporation\\PhysX\\Common;C:\\Program Files\\NVIDIA Corporation\\NVIDIA NvDLISR;C:\\Program Files\\Git\\cmd;C:\\ProgramData\\chocolatey\\bin;C:\\Program Files\\dotnet\\;C:\\Program Files\\Docker\\Docker\\resources\\bin;C:\\ProgramData\\DockerDesktop\\version-bin;C:\\Program Files\\WireGuard\\;C:\\Program Files\\NVIDIA Corporation\\Nsight Compute 2022.3.0\\;C:\\Program Files\\nodejs\\;C:\\Program Files\\Tailscale\\;C:\\Users\\tanuj\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\tanuj\\AppData\\Local\\atom\\bin;C:\\Program Files\\heroku\\bin;C:\\Program Files (x86)\\Nmap;C:\\Users\\tanuj\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\tanuj\\.dotnet\\tools;C:\\Users\\tanuj\\anaconda3\\Library\\bin;C:\\Users\\tanuj\\anaconda3\\Scripts;C:\\Users\\tanuj\\anaconda3\\condabin;C:\\Users\\tanuj\\AppData\\Roaming\\npm;C:\\Users\\tanuj\\AppData\\Local\\Programs\\oh-my-posh\\bin;C:\\ffmpeg-2023-05-11-git-ceb050427c-full_build\\bin",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.PY;.PYW",POSH_THEMES_PATH:"C:\\Users\\tanuj\\AppData\\Local\\Programs\\oh-my-posh\\themes",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 165 Stepping 5, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"a505",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Program Files\\WindowsPowerShell\\Modules;C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",SystemDrive:"C:",SystemRoot:"C:\\Windows",TEMP:"C:\\Users\\tanuj\\AppData\\Local\\Temp",TMP:"C:\\Users\\tanuj\\AppData\\Local\\Temp",USERDOMAIN:"TANUJS-PC",USERDOMAIN_ROAMINGPROFILE:"TANUJS-PC",USERNAME:"tanuj",USERPROFILE:"C:\\Users\\tanuj",VBOX_MSI_INSTALL_PATH:"C:\\Program Files\\Oracle\\VirtualBox\\",windir:"C:\\Windows",WSLENV:"WT_SESSION::WT_PROFILE_ID",WT_PROFILE_ID:"{0caa0dad-35be-5f56-a8ff-afceeeaa6101}",WT_SESSION:"d47979e6-8af5-40d1-a7e6-32dae0c3ba1d",ZES_ENABLE_SYSMAN:"1"}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&o(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},u=()=>{var e;return null===(e=c())||void 0===e?void 0:e.config};class l{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function d(){var t;const n=null===(t=c())||void 0===t?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function f(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function p(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function m(){const e=h();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function g(){try{return"object"==typeof indexedDB}catch(e){return!1}}class y extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,y.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,v.prototype.create)}}class v{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(w,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new y(r,o,n)}}const w=/\{\$([^}]+)}/g;function _(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function I(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(b(n)&&b(s)){if(!I(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function b(e){return null!==e&&"object"==typeof e}function T(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function E(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function C(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function S(e,t){const n=new A(e,t);return n.subscribe.bind(n)}class A{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=D),void 0===r.error&&(r.error=D),void 0===r.complete&&(r.complete=D);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function D(){}function k(e){return e&&e._delegate?e._delegate:e}class P{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const N="[DEFAULT]";class R{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new l;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:N})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=N){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=N){return this.instances.has(e)}getOptions(e=N){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===N?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=N){return this.component?this.component.multipleInstances?e:N:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class O{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new R(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const x=[];var L;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(L||(L={}));const F={debug:L.DEBUG,verbose:L.VERBOSE,info:L.INFO,warn:L.WARN,error:L.ERROR,silent:L.SILENT},M=L.INFO,U={[L.DEBUG]:"log",[L.VERBOSE]:"log",[L.INFO]:"info",[L.WARN]:"warn",[L.ERROR]:"error"},V=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=U[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class j{constructor(e){this.name=e,this._logLevel=M,this._logHandler=V,this._userLogHandler=null,x.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in L))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?F[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,L.DEBUG,...e),this._logHandler(this,L.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,L.VERBOSE,...e),this._logHandler(this,L.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,L.INFO,...e),this._logHandler(this,L.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,L.WARN,...e),this._logHandler(this,L.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,L.ERROR,...e),this._logHandler(this,L.ERROR,...e)}}const B=(e,t)=>t.some((t=>e instanceof t));let q,z;const G=new WeakMap,W=new WeakMap,$=new WeakMap,K=new WeakMap,H=new WeakMap;let Q={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return W.get(e);if("objectStoreNames"===t)return e.objectStoreNames||$.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return X(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function J(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(z||(z=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Y(this),e),X(G.get(this))}:function(...e){return X(t.apply(Y(this),e))}:function(e,...n){const r=t.call(Y(this),e,...n);return $.set(r,e.sort?e.sort():[e]),X(r)}:(e instanceof IDBTransaction&&function(e){if(W.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));W.set(e,t)}(e),B(e,q||(q=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Q):e);var t}function X(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(X(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&G.set(t,e)})).catch((()=>{})),H.set(t,e),t}(e);if(K.has(e))return K.get(e);const t=J(e);return t!==e&&(K.set(e,t),H.set(t,e)),t}const Y=e=>H.get(e),Z=["get","getKey","getAll","getAllKeys","count"],ee=["put","add","delete","clear"],te=new Map;function ne(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(te.get(t))return te.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=ee.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Z.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return te.set(t,s),s}var re;re=Q,Q={...re,get:(e,t,n)=>ne(e,t)||re.get(e,t,n),has:(e,t)=>!!ne(e,t)||re.has(e,t)};class ie{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const se="@firebase/app",oe="0.9.13",ae=new j("@firebase/app"),ce="[DEFAULT]",ue={[se]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},le=new Map,he=new Map;function de(e,t){try{e.container.addComponent(t)}catch(n){ae.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function fe(e,t){e.container.addOrOverwriteComponent(t)}function pe(e){const t=e.name;if(he.has(t))return ae.debug(`There were multiple attempts to register component ${t}.`),!1;he.set(t,e);for(const t of le.values())de(t,e);return!0}function me(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function ge(e,t,n=ce){me(e,t).clearInstance(n)}function ye(){he.clear()}const ve=new v("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class we{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new P("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ve.create("app-deleted",{appName:this._name})}}const _e="9.23.0";function Ie(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:ce,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw ve.create("bad-app-name",{appName:String(i)});if(n||(n=u()),!n)throw ve.create("no-options");const s=le.get(i);if(s){if(I(n,s.options)&&I(r,s.config))return s;throw ve.create("duplicate-app",{appName:i})}const o=new O(i);for(const e of he.values())o.addComponent(e);const a=new we(n,r,o);return le.set(i,a),a}function be(e=ce){const t=le.get(e);if(!t&&e===ce&&u())return Ie();if(!t)throw ve.create("no-app",{appName:e});return t}function Te(){return Array.from(le.values())}async function Ee(e){const t=e.name;le.has(t)&&(le.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function Ce(e,t,n){var r;let i=null!==(r=ue[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void ae.warn(e.join(" "))}pe(new P(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}function Se(e,t){if(null!==e&&"function"!=typeof e)throw ve.create("invalid-log-argument");!function(e,t){for(const n of x){let r=null;t&&t.level&&(r=F[t.level]),n.userLogHandler=null===e?null:(t,n,...i)=>{const s=i.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:L[n].toLowerCase(),message:s,args:i,type:t.name})}}}(e,t)}function Ae(e){var t;t=e,x.forEach((e=>{e.setLogLevel(t)}))}const De="firebase-heartbeat-database",ke=1,Pe="firebase-heartbeat-store";let Ne=null;function Re(){return Ne||(Ne=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=X(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(X(o.result),e.oldVersion,e.newVersion,X(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(De,ke,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Pe)}}).catch((e=>{throw ve.create("idb-open",{originalErrorMessage:e.message})}))),Ne}async function Oe(e,t){try{const n=(await Re()).transaction(Pe,"readwrite"),r=n.objectStore(Pe);await r.put(t,xe(e)),await n.done}catch(e){if(e instanceof y)ae.warn(e.message);else{const t=ve.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});ae.warn(t.message)}}}function xe(e){return`${e.name}!${e.options.appId}`}class Le{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Me(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Fe();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=Fe(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),Ue(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Ue(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=s(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function Fe(){return(new Date).toISOString().substring(0,10)}class Me{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!g()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=await Re();return await t.transaction(Pe).objectStore(Pe).get(xe(e))}catch(e){if(e instanceof y)ae.warn(e.message);else{const t=ve.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});ae.warn(t.message)}}}(this.app);return e||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Oe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Oe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Ue(e){return s(JSON.stringify({version:2,heartbeats:e})).length}pe(new P("platform-logger",(e=>new ie(e)),"PRIVATE")),pe(new P("heartbeat",(e=>new Le(e)),"PRIVATE")),Ce(se,oe,""),Ce(se,oe,"esm2017"),Ce("fire-js","");class Ve{constructor(e,t){this._delegate=e,this.firebase=t,de(e,new P("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),Ee(this._delegate))))}_getService(e,t=ce){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=ce){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){de(this._delegate,e)}_addOrOverwriteComponent(e){fe(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const je=new v("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),Be=function e(){const n=function(e){const n={},r={__esModule:!0,initializeApp:function(t,i={}){const s=Ie(t,i);if(_(n,s.name))return n[s.name];const o=new e(s,r);return n[s.name]=o,o},app:i,registerVersion:Ce,setLogLevel:Ae,onLog:Se,apps:null,SDK_VERSION:_e,INTERNAL:{registerComponent:function(t){const n=t.name,s=n.replace("-compat","");if(pe(t)&&"PUBLIC"===t.type){const o=(e=i())=>{if("function"!=typeof e[s])throw je.create("invalid-app-argument",{appName:n});return e[s]()};void 0!==t.serviceProps&&a(o,t.serviceProps),r[s]=o,e.prototype[s]=function(...e){return this._getService.bind(this,n).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?r[s]:null},removeApp:function(e){delete n[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:t}};function i(e){if(!_(n,e=e||ce))throw je.create("no-app",{appName:e});return n[e]}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(n).map((e=>n[e]))}}),i.App=e,r}(Ve);return n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){a(n,e)},createSubscribe:S,ErrorFactory:v,deepExtend:a}),n}(),qe=new j("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){qe.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&qe.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const ze=Be;function Ge(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Ce("@firebase/app-compat","0.2.13",void 0),ze.registerVersion("firebase","9.23.0","app-compat"),Object.create,Object.create;const We={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"};const $e=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend."}},Ke=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},He=new v("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Qe=new j("@firebase/auth");function Je(e,...t){Qe.logLevel<=L.ERROR&&Qe.error(`Auth (${_e}): ${e}`,...t)}function Xe(e,...t){throw tt(e,...t)}function Ye(e,...t){return tt(e,...t)}function Ze(e,t,n){const r=Object.assign(Object.assign({},Ke()),{[t]:n});return new v("auth","Firebase",r).create(t,{appName:e.name})}function et(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&Xe(e,"argument-error"),Ze(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function tt(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return He.create(e,...t)}function nt(e,t,...n){if(!e)throw tt(t,...n)}function rt(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Je(t),new Error(t)}function it(e,t){e||rt(t)}function st(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function ot(){return"http:"===at()||"https:"===at()}function at(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class ct{constructor(e,t){this.shortDelay=e,this.longDelay=t,it(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(h())||p()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(ot()||f()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function ut(e,t){it(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class lt{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void rt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void rt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void rt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const ht={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},dt=new ct(3e4,6e4);function ft(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function pt(e,t,n,r,i={}){return mt(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=T(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),lt.fetch()(yt(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function mt(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},ht),t);try{const t=new vt(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw wt(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw wt(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw wt(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw wt(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Ze(e,a,o);Xe(e,a)}}catch(t){if(t instanceof y)throw t;Xe(e,"network-request-failed",{message:String(t)})}}async function gt(e,t,n,r,i={}){const s=await pt(e,t,n,r,i);return"mfaPendingCredential"in s&&Xe(e,"multi-factor-auth-required",{_serverResponse:s}),s}function yt(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?ut(e.config,i):`${e.config.apiScheme}://${i}`}class vt{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Ye(this.auth,"network-request-failed"))),dt.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function wt(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Ye(e,t,r);return i.customData._tokenResponse=n,i}function _t(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function It(e){return 1e3*Number(e)}function bt(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Je("JWT malformed, contained fewer than 3 sections"),null;try{const e=o(n);return e?JSON.parse(e):(Je("Failed to decode base64 JWT payload"),null)}catch(e){return Je("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function Tt(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof y&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class Et{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Ct{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=_t(this.lastLoginAt),this.creationTime=_t(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function St(e){var t;const n=e.auth,r=await e.getIdToken(),i=await Tt(e,async function(e,t){return pt(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));nt(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=Ge(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Ct(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class At{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){nt(e.idToken,"internal-error"),nt(void 0!==e.idToken,"internal-error"),nt(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=bt(e);return nt(t,"internal-error"),nt(void 0!==t.exp,"internal-error"),nt(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return nt(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await mt(e,{},(async()=>{const n=T({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=yt(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",lt.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new At;return n&&(nt("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(nt("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(nt("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new At,this.toJSON())}_performRefresh(){return rt("not implemented")}}function Dt(e,t){nt("string"==typeof e||void 0===e,"internal-error",{appName:t})}class kt{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Ge(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Et(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Ct(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Tt(this,this.stsTokenManager.getToken(this.auth,e));return nt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=k(e),r=await n.getIdToken(t),i=bt(r);nt(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:_t(It(i.auth_time)),issuedAtTime:_t(It(i.iat)),expirationTime:_t(It(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=k(e);await St(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(nt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new kt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){nt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await St(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Tt(this,async function(e,t){return pt(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:_,providerData:I,stsTokenManager:b}=t;nt(v&&b,e,"internal-error");const T=At.fromJSON(this.name,b);nt("string"==typeof v,e,"internal-error"),Dt(l,e.name),Dt(h,e.name),nt("boolean"==typeof w,e,"internal-error"),nt("boolean"==typeof _,e,"internal-error"),Dt(d,e.name),Dt(f,e.name),Dt(p,e.name),Dt(m,e.name),Dt(g,e.name),Dt(y,e.name);const E=new kt({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:_,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return I&&Array.isArray(I)&&(E.providerData=I.map((e=>Object.assign({},e)))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t,n=!1){const r=new At;r.updateFromServerResponse(t);const i=new kt({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await St(i),i}}const Pt=new Map;function Nt(e){it(e instanceof Function,"Expected a class definition");let t=Pt.get(e);return t?(it(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Pt.set(e,t),t)}class Rt{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Rt.type="NONE";const Ot=Rt;function xt(e,t,n){return`firebase:${e}:${t}:${n}`}class Lt{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=xt(this.userKey,r.apiKey,i),this.fullPersistenceKey=xt("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?kt._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Lt(Nt(Ot),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||Nt(Ot);const s=xt(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=kt._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new Lt(i,e,n)):new Lt(i,e,n)}}function Ft(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(jt(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Mt(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(qt(t))return"Blackberry";if(zt(t))return"Webos";if(Ut(t))return"Safari";if((t.includes("chrome/")||Vt(t))&&!t.includes("edge/"))return"Chrome";if(Bt(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Mt(e=h()){return/firefox\//i.test(e)}function Ut(e=h()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Vt(e=h()){return/crios\//i.test(e)}function jt(e=h()){return/iemobile/i.test(e)}function Bt(e=h()){return/android/i.test(e)}function qt(e=h()){return/blackberry/i.test(e)}function zt(e=h()){return/webos/i.test(e)}function Gt(e=h()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Wt(e=h()){return Gt(e)||Bt(e)||zt(e)||qt(e)||/windows phone/i.test(e)||jt(e)}function $t(e,t=[]){let n;switch(e){case"Browser":n=Ft(h());break;case"Worker":n=`${Ft(h())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${_e}/${r}`}async function Kt(e,t){return pt(e,"GET","/v2/recaptchaConfig",ft(e,t))}function Ht(e){return void 0!==e&&void 0!==e.getResponse}function Qt(e){return void 0!==e&&void 0!==e.enterprise}class Jt{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some((e=>"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState))}}function Xt(e){return new Promise(((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=Ye("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)}))}function Yt(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Zt{constructor(e){this.type="recaptcha-enterprise",this.auth=rn(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;Qt(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{Kt(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new Jt(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&Qt(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));Xt("https://www.google.com/recaptcha/enterprise.js?render="+i).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function en(e,t,n,r=!1){const i=new Zt(e);let s;try{s=await i.verify(n)}catch(e){s=await i.verify(n,!0)}const o=Object.assign({},t);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class tn{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class nn{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new sn(this),this.idTokenSubscription=new sn(this),this.beforeStateQueue=new tn(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=He,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Nt(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await Lt.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return nt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await St(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?k(e):null;return t&&nt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&nt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(Nt(e))}))}async initializeRecaptchaConfig(){const e=await Kt(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),t=new Jt(e);null==this.tenantId?this._agentRecaptchaConfig=t:this._tenantRecaptchaConfigs[this.tenantId]=t,t.emailPasswordEnabled&&new Zt(this).verify()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new v("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Nt(e)||this._popupRedirectResolver;nt(t,this,"argument-error"),this.redirectPersistenceManager=await Lt.create(this,[Nt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return nt(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return nt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=$t(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Qe.logLevel<=L.WARN&&Qe.warn(`Auth (${_e}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function rn(e){return k(e)}class sn{constructor(e){this.auth=e,this.observer=null,this.addObserver=S((e=>this.observer=e))}get next(){return nt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function on(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function an(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class cn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return rt("not implemented")}_getIdTokenResponse(e){return rt("not implemented")}_linkToIdToken(e,t){return rt("not implemented")}_getReauthenticationResolver(e){return rt("not implemented")}}async function un(e,t){return pt(e,"POST","/v1/accounts:resetPassword",ft(e,t))}async function ln(e,t){return pt(e,"POST","/v1/accounts:update",t)}async function hn(e,t){return gt(e,"POST","/v1/accounts:signInWithPassword",ft(e,t))}async function dn(e,t){return pt(e,"POST","/v1/accounts:sendOobCode",ft(e,t))}async function fn(e,t){return dn(e,t)}async function pn(e,t){return dn(e,t)}class mn extends cn{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new mn(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new mn(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){var t;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null===(t=e._getRecaptchaConfig())||void 0===t?void 0:t.emailPasswordEnabled){const t=await en(e,n,"signInWithPassword");return hn(e,t)}return hn(e,n).catch((async t=>{if("auth/missing-recaptcha-token"===t.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const t=await en(e,n,"signInWithPassword");return hn(e,t)}return Promise.reject(t)}));case"emailLink":return async function(e,t){return gt(e,"POST","/v1/accounts:signInWithEmailLink",ft(e,t))}(e,{email:this._email,oobCode:this._password});default:Xe(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ln(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return gt(e,"POST","/v1/accounts:signInWithEmailLink",ft(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Xe(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function gn(e,t){return gt(e,"POST","/v1/accounts:signInWithIdp",ft(e,t))}class yn extends cn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new yn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Xe("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=Ge(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new yn(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return gn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,gn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,gn(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=T(t)}return e}}const vn={USER_NOT_FOUND:"user-not-found"};class wn extends cn{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new wn({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new wn({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return gt(e,"POST","/v1/accounts:signInWithPhoneNumber",ft(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await gt(e,"POST","/v1/accounts:signInWithPhoneNumber",ft(e,t));if(n.temporaryProof)throw wt(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return gt(e,"POST","/v1/accounts:signInWithPhoneNumber",ft(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),vn)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new wn({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class _n{constructor(e){var t,n,r,i,s,o;const a=E(C(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);nt(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=E(C(e)).link,n=t?E(C(t)).deep_link_id:null,r=E(C(e)).deep_link_id;return(r?E(C(r)).link:null)||r||n||t||e}(e);try{return new _n(t)}catch(e){return null}}}class In{constructor(){this.providerId=In.PROVIDER_ID}static credential(e,t){return mn._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=_n.parseLink(t);return nt(n,"argument-error"),mn._fromEmailAndCode(e,n.code,n.tenantId)}}In.PROVIDER_ID="password",In.EMAIL_PASSWORD_SIGN_IN_METHOD="password",In.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class bn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Tn extends bn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class En extends Tn{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return nt("providerId"in t&&"signInMethod"in t,"argument-error"),yn._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return nt(e.idToken||e.accessToken,"argument-error"),yn._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return En.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return En.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:o}=e;if(!(n||r||t||i))return null;if(!o)return null;try{return new En(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class Cn extends Tn{constructor(){super("facebook.com")}static credential(e){return yn._fromParams({providerId:Cn.PROVIDER_ID,signInMethod:Cn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Cn.credentialFromTaggedObject(e)}static credentialFromError(e){return Cn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Cn.credential(e.oauthAccessToken)}catch(e){return null}}}Cn.FACEBOOK_SIGN_IN_METHOD="facebook.com",Cn.PROVIDER_ID="facebook.com";class Sn extends Tn{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return yn._fromParams({providerId:Sn.PROVIDER_ID,signInMethod:Sn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Sn.credentialFromTaggedObject(e)}static credentialFromError(e){return Sn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Sn.credential(t,n)}catch(e){return null}}}Sn.GOOGLE_SIGN_IN_METHOD="google.com",Sn.PROVIDER_ID="google.com";class An extends Tn{constructor(){super("github.com")}static credential(e){return yn._fromParams({providerId:An.PROVIDER_ID,signInMethod:An.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return An.credentialFromTaggedObject(e)}static credentialFromError(e){return An.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return An.credential(e.oauthAccessToken)}catch(e){return null}}}An.GITHUB_SIGN_IN_METHOD="github.com",An.PROVIDER_ID="github.com";class Dn extends cn{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return gn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,gn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,gn(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new Dn(n,i):null}static _create(e,t){return new Dn(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class kn extends bn{constructor(e){nt(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return kn.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return kn.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Dn.fromJSON(e);return nt(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return Dn._create(n,t)}catch(e){return null}}}class Pn extends Tn{constructor(){super("twitter.com")}static credential(e,t){return yn._fromParams({providerId:Pn.PROVIDER_ID,signInMethod:Pn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Pn.credentialFromTaggedObject(e)}static credentialFromError(e){return Pn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Pn.credential(t,n)}catch(e){return null}}}async function Nn(e,t){return gt(e,"POST","/v1/accounts:signUp",ft(e,t))}Pn.TWITTER_SIGN_IN_METHOD="twitter.com",Pn.PROVIDER_ID="twitter.com";class Rn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await kt._fromIdTokenResponse(e,n,r),s=On(n);return new Rn({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=On(n);return new Rn({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function On(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class xn extends y{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,xn.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new xn(e,t,n,r)}}function Ln(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw xn._fromErrorAndOperation(e,n,t,r);throw n}))}function Fn(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function Mn(e,t,n=!1){const r=await Tt(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Rn._forOperation(e,"link",r)}async function Un(e,t,n){await St(t);const r=!1===e?"provider-already-linked":"no-such-provider";nt(Fn(t.providerData).has(n)===e,t.auth,r)}async function Vn(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await Tt(e,Ln(r,i,t,e),n);nt(s.idToken,r,"internal-error");const o=bt(s.idToken);nt(o,r,"internal-error");const{sub:a}=o;return nt(e.uid===a,r,"user-mismatch"),Rn._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Xe(r,"user-mismatch"),e}}async function jn(e,t,n=!1){const r="signIn",i=await Ln(e,r,t),s=await Rn._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function Bn(e,t){return jn(rn(e),t)}async function qn(e,t){const n=k(e);return await Un(!1,n,t.providerId),Mn(n,t)}async function zn(e,t){return Vn(k(e),t)}class Gn{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Wn._fromServerResponse(e,t):"totpInfo"in t?$n._fromServerResponse(e,t):Xe(e,"internal-error")}}class Wn extends Gn{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Wn(t)}}class $n extends Gn{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new $n(t)}}function Kn(e,t,n){var r;nt((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),nt(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(nt(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(nt(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function Hn(e,t){const n=k(e),r=await un(n,{oobCode:t}),i=r.requestType;switch(nt(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":nt(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":nt(r.mfaInfo,n,"internal-error");default:nt(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=Gn._fromServerResponse(rn(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function Qn(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await Tt(e,ln(r,i));await e._updateTokensIfNecessary(s,!0)}class Jn{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Xn extends Jn{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Yn extends Jn{constructor(e,t){super(e,"facebook.com",t)}}class Zn extends Xn{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class er extends Jn{constructor(e,t){super(e,"google.com",t)}}class tr extends Xn{constructor(e,t,n){super(e,"twitter.com",t,n)}}function nr(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){const r=null===(n=null===(t=bt(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new Jn(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new Yn(s,i);case"github.com":return new Zn(s,i);case"google.com":return new er(s,i);case"twitter.com":return new tr(s,i,e.screenName||null);case"custom":case"anonymous":return new Jn(s,null);default:return new Jn(s,r,i)}}(n)}class rr{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new rr("enroll",e,t)}static _fromMfaPendingCredential(e){return new rr("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return rr._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return rr._fromIdtoken(e.multiFactorSession.idToken)}return null}}class ir{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=rn(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map((e=>Gn._fromServerResponse(n,e)));nt(r.mfaPendingCredential,n,"internal-error");const s=rr._fromMfaPendingCredential(r.mfaPendingCredential);return new ir(s,i,(async e=>{const i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;const o=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=await Rn._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return nt(t.user,n,"internal-error"),Rn._forOperation(t.user,t.operationType,o);default:Xe(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}class sr{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>Gn._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new sr(e)}async getSession(){return rr._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const n=e,r=await this.getSession(),i=await Tt(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{const e=await Tt(this.user,(r=this.user.auth,i={idToken:n,mfaEnrollmentId:t},pt(r,"POST","/v2/accounts/mfaEnrollment:withdraw",ft(r,i))));this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==t)),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}var r,i}}const or=new WeakMap,ar="__sak";class cr{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ar,"1"),this.storage.removeItem(ar),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class ur extends cr{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=h();return Ut(e)||Gt(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Wt(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);m()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ur.type="LOCAL";const lr=ur;class hr extends cr{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}hr.type="SESSION";const dr=hr;class fr{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new fr(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function pr(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}fr.receivers=[];class mr{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=pr("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function gr(){return window}function yr(){return void 0!==gr().WorkerGlobalScope&&"function"==typeof gr().importScripts}const vr="firebaseLocalStorageDb",wr="firebaseLocalStorage",_r="fbase_key";class Ir{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function br(e,t){return e.transaction([wr],t?"readwrite":"readonly").objectStore(wr)}function Tr(){const e=indexedDB.open(vr,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(wr,{keyPath:_r})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(wr)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(vr);return new Ir(e).toPromise()}(),t(await Tr()))}))}))}async function Er(e,t,n){const r=br(e,!0).put({[_r]:t,value:n});return new Ir(r).toPromise()}function Cr(e,t){const n=br(e,!0).delete(t);return new Ir(n).toPromise()}class Sr{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Tr()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return yr()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=fr._getInstance(yr()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new mr(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Tr();return await Er(e,ar,"1"),await Cr(e,ar),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Er(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=br(e,!1).get(t),r=await new Ir(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Cr(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=br(e,!1).getAll();return new Ir(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Sr.type="LOCAL";const Ar=Sr,Dr=1e12;class kr{constructor(e){this.auth=e,this.counter=Dr,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new Pr(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||Dr;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||Dr;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||Dr;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class Pr{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;nt(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<50;e++)t.push(n.charAt(Math.floor(62*Math.random())));return t.join("")}();const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Nr=Yt("rcb"),Rr=new ct(3e4,6e4);class Or{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(e=gr().grecaptcha)||void 0===e?void 0:e.render)}load(e,t=""){return nt(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)&&Ht(gr().grecaptcha)?Promise.resolve(gr().grecaptcha):new Promise(((n,r)=>{const i=gr().setTimeout((()=>{r(Ye(e,"network-request-failed"))}),Rr.get());gr()[Nr]=()=>{gr().clearTimeout(i),delete gr()[Nr];const s=gr().grecaptcha;if(!s||!Ht(s))return void r(Ye(e,"internal-error"));const o=s.render;s.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(s)},Xt(`https://www.google.com/recaptcha/api.js??${T({onload:Nr,render:"explicit",hl:t})}`).catch((()=>{clearTimeout(i),r(Ye(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null===(t=gr().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class xr{async load(e){return new kr(e)}clearedOneInstance(){}}const Lr="recaptcha",Fr={theme:"light",type:"image"};class Mr{constructor(e,t=Object.assign({},Fr),n){this.parameters=t,this.type=Lr,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=rn(n),this.isInvisible="invisible"===this.parameters.size,nt("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof e?document.getElementById(e):e;nt(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new xr:new Or,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha();return t.getResponse(e)||new Promise((n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){nt(!this.parameters.sitekey,this.auth,"argument-error"),nt(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),nt("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"==typeof e)e(t);else if("string"==typeof e){const n=gr()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){nt(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){nt(ot()&&!yr(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await pt(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);nt(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return nt(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Ur{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=wn._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Vr(e,t,n){var r;const i=await n.verify();try{let s;if(nt("string"==typeof i,e,"argument-error"),nt(n.type===Lr,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){nt("enroll"===t.type,e,"internal-error");const n=await function(e,t){return pt(e,"POST","/v2/accounts/mfaEnrollment:start",ft(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{nt("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;nt(n,e,"missing-multi-factor-info");const o=await function(e,t){return pt(e,"POST","/v2/accounts/mfaSignIn:start",ft(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return pt(e,"POST","/v1/accounts:sendVerificationCode",ft(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}class jr{constructor(e){this.providerId=jr.PROVIDER_ID,this.auth=rn(e)}verifyPhoneNumber(e,t){return Vr(this.auth,e,k(t))}static credential(e,t){return wn._fromVerification(e,t)}static credentialFromResult(e){const t=e;return jr.credentialFromTaggedObject(t)}static credentialFromError(e){return jr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?wn._fromTokenResponse(t,n):null}}function Br(e,t){return t?Nt(t):(nt(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}jr.PROVIDER_ID="phone",jr.PHONE_SIGN_IN_METHOD="phone";class qr extends cn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return gn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return gn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return gn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function zr(e){return jn(e.auth,new qr(e),e.bypassAuthState)}function Gr(e){const{auth:t,user:n}=e;return nt(n,t,"internal-error"),Vn(n,new qr(e),e.bypassAuthState)}async function Wr(e){const{auth:t,user:n}=e;return nt(n,t,"internal-error"),Mn(n,new qr(e),e.bypassAuthState)}class $r{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return zr;case"linkViaPopup":case"linkViaRedirect":return Wr;case"reauthViaPopup":case"reauthViaRedirect":return Gr;default:Xe(this.auth,"internal-error")}}resolve(e){it(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){it(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Kr=new ct(2e3,1e4);class Hr extends $r{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Hr.currentPopupAction&&Hr.currentPopupAction.cancel(),Hr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return nt(e,this.auth,"internal-error"),e}async onExecution(){it(1===this.filter.length,"Popup operations only handle one event");const e=pr();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Ye(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Ye(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Hr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Ye(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Kr.get())};e()}}Hr.currentPopupAction=null;const Qr="pendingRedirect",Jr=new Map;class Xr extends $r{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Jr.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=ti(t),r=ei(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Jr.set(this.auth._key(),e)}return this.bypassAuthState||Jr.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Yr(e,t){return ei(e)._set(ti(t),"true")}function Zr(e,t){Jr.set(e._key(),t)}function ei(e){return Nt(e._redirectPersistence)}function ti(e){return xt(Qr,e.config.apiKey,e.name)}async function ni(e,t,n=!1){const r=rn(e),i=Br(r,t),s=new Xr(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function ri(e){const t=pr(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class ii{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return oi(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!oi(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Ye(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(si(e))}saveEventToCache(e){this.cachedEventUids.add(si(e)),this.lastProcessedEventTime=Date.now()}}function si(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function oi({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function ai(e,t={}){return pt(e,"GET","/v1/projects",t)}const ci=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ui=/^https?/;function li(e){const t=st(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!ui.test(n))return!1;if(ci.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const hi=new ct(3e4,6e4);function di(){const e=gr().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let fi=null;function pi(e){return fi=fi||function(e){return new Promise(((t,n)=>{var r,i,s;function o(){di(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{di(),n(Ye(e,"network-request-failed"))},timeout:hi.get()})}if(null===(i=null===(r=gr().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=gr().gapi)||void 0===s?void 0:s.load)){const t=Yt("iframefcb");return gr()[t]=()=>{gapi.load?o():n(Ye(e,"network-request-failed"))},Xt(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw fi=null,e}))}(e),fi}const mi=new ct(5e3,15e3),gi={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},yi=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function vi(e){const t=e.config;nt(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?ut(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:_e},i=yi.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${T(r).slice(1)}`}const wi={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class _i{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const Ii="__/auth/handler",bi="emulator/auth/handler",Ti=encodeURIComponent("fac");async function Ei(e,t,n,r,i,s){nt(e.config.authDomain,e,"auth-domain-config-required"),nt(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:_e,eventId:i};if(t instanceof bn){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof Tn){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),u=c?`#${Ti}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?ut(e,bi):`https://${e.authDomain}/${Ii}`}(e)}?${T(a).slice(1)}${u}`}const Ci="webStorageSupport",Si=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=dr,this._completeRedirectFn=ni,this._overrideRedirectResult=Zr}async _openPopup(e,t,n,r){var i;return it(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},wi),{width:r.toString(),height:i.toString(),top:s,left:o}),u=h().toLowerCase();n&&(a=Vt(u)?"_blank":n),Mt(u)&&(t=t||"http://localhost",c.scrollbars="yes");const l=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=h()){var t;return Gt(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new _i(null);const d=window.open(t||"",a,l);nt(d,e,"popup-blocked");try{d.focus()}catch(e){}return new _i(d)}(e,await Ei(e,t,n,st(),r),pr())}async _openRedirect(e,t,n,r){return await this._originValidation(e),i=await Ei(e,t,n,st(),r),gr().location.href=i,new Promise((()=>{}));var i}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(it(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await pi(e),n=gr().gapi;return nt(n,e,"internal-error"),t.open({where:document.body,url:vi(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:gi,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=Ye(e,"network-request-failed"),s=gr().setTimeout((()=>{r(i)}),mi.get());function o(){gr().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new ii(e);return t.register("authEvent",(t=>(nt(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ci,{type:Ci},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[Ci];void 0!==i&&t(!!i),Xe(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await ai(e);for(const e of t)try{if(li(e))return}catch(e){}Xe(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Wt()||Ut()||Gt()}};class Ai{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return rt("unexpected MultiFactorSessionType")}}}class Di extends Ai{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Di(e)}_finalizeEnroll(e,t,n){return function(e,t){return pt(e,"POST","/v2/accounts/mfaEnrollment:finalize",ft(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return pt(e,"POST","/v2/accounts/mfaSignIn:finalize",ft(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class ki{constructor(){}static assertion(e){return Di._fromCredential(e)}}ki.FACTOR_ID="phone";var Pi,Ni="@firebase/auth",Ri="0.23.2";class Oi{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){nt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function xi(){return window}(e=>{var t;null===(t=c())||void 0===t||t._authIdTokenMaxAge})(),Pi="Browser",pe(new P("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;nt(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:Pi,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:$t(Pi)},c=new nn(n,r,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Nt);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),pe(new P("auth-internal",(e=>{return t=rn(e.getProvider("auth").getImmediate()),new Oi(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),Ce(Ni,Ri,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Pi)),Ce(Ni,Ri,"esm2017");class Li extends ii{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function Fi(e){const t=await Ui()._get(Vi(e));return t&&await Ui()._remove(Vi(e)),t}function Mi(){const e=[];for(let t=0;t<20;t++){const t=Math.floor(62*Math.random());e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(t))}return e.join("")}function Ui(){return Nt(lr)}function Vi(e){return xt("authEvent",e.config.apiKey,e.name)}function ji(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return E(n.join("?"))}const Bi=class{constructor(){this._redirectPersistence=dr,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=ni,this._overrideRedirectResult=Zr}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new Li(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){Xe(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,i,s,o,a,c,u,l;const h=xi();nt("function"==typeof(null===(t=null==h?void 0:h.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),nt(void 0!==(null===(n=null==h?void 0:h.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),nt("function"==typeof(null===(s=null===(i=null===(r=null==h?void 0:h.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),nt("function"==typeof(null===(c=null===(a=null===(o=null==h?void 0:h.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===c?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),nt("function"==typeof(null===(l=null===(u=null==h?void 0:h.cordova)||void 0===u?void 0:u.InAppBrowser)||void 0===l?void 0:l.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const i=await this._initialize(e);await i.initialized(),i.resetRedirect(),Jr.clear(),await this._originValidation(e);const s=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:Mi(),postBody:null,tenantId:e.tenantId,error:Ye(e,"no-auth-event")}}(e,n,r);await function(e,t){return Ui()._set(Vi(e),t)}(e,s);const o=await async function(e,t,n){var r;const{BuildInfo:i}=xi();it(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(it(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),o={};return Gt()?o.ibi=i.packageName:Bt()?o.apn=i.packageName:Xe(e,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,Ei(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,o)}(e,s,t);return async function(e,t,n){const{cordova:r}=xi();let i=()=>{};try{await new Promise(((s,o)=>{let a=null;function c(){var e;s();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function u(){a||(a=window.setTimeout((()=>{o(Ye(e,"redirect-cancelled-by-user"))}),2e3))}function l(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),Bt()&&document.addEventListener("visibilitychange",l,!1),i=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",l,!1),a&&window.clearTimeout(a)}}))}finally{i()}}(e,i,await function(e){const{cordova:t}=xi();return new Promise((n=>{t.plugins.browsertab.isAvailable((r=>{let i=null;r?t.plugins.browsertab.openUrl(e):i=t.InAppBrowser.open(e,function(e=h()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(i)}))}))}(o))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=xi(),n={};Gt()?n.iosBundleId=t.packageName:Bt()?n.androidPackageName=t.packageName:Xe(e,"operation-not-supported-in-this-environment"),await ai(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=xi(),s=setTimeout((async()=>{await Fi(e),t.onEvent(qi())}),500),o=async n=>{clearTimeout(s);const r=await Fi(e);let i=null;r&&(null==n?void 0:n.url)&&(i=function(e,t){var n,r;const i=function(e){const t=ji(e),n=t.link?decodeURIComponent(t.link):void 0,r=ji(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return ji(i).link||i||r||n||e}(t);if(i.includes("/__/auth/callback")){const t=ji(i),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(t.firebaseError)):null,o=null===(r=null===(n=null==s?void 0:s.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],a=o?Ye(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}(r,n.url)),t.onEvent(i||qi())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,o);const a=r,c=`${i.packageName.toLowerCase()}://`;xi().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}};function qi(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Ye("no-auth-event")}}function zi(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Gi(e=h()){return!("file:"!==zi()&&"ionic:"!==zi()&&"capacitor:"!==zi()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Wi(){try{const e=self.localStorage,t=pr();if(e)return e.setItem(t,"1"),e.removeItem(t),!function(e=h()){return m()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=h()){return/Edge\/\d+/.test(e)}(e)}()||g()}catch(e){return $i()&&g()}return!1}function $i(){return void 0!==e.g&&"WorkerGlobalScope"in e.g&&"importScripts"in e.g}function Ki(){return("http:"===zi()||"https:"===zi()||f()||Gi())&&!(p()||d())&&Wi()&&!$i()}function Hi(){return Gi()&&"undefined"!=typeof document}const Qi={LOCAL:"local",NONE:"none",SESSION:"session"},Ji=nt,Xi="persistence";async function Yi(e){await e._initializationPromise;const t=Zi(),n=xt(Xi,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function Zi(){var e;try{return(null===(e="undefined"!=typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(e){return null}}const es=nt;class ts{constructor(){this.browserResolver=Nt(Si),this.cordovaResolver=Nt(Bi),this.underlyingResolver=null,this._redirectPersistence=dr,this._completeRedirectFn=ni,this._overrideRedirectResult=Zr}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Hi()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return es(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!Hi()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function ns(e){return e.unwrap()}function rs(e){const{_tokenResponse:t}=e instanceof y?e.customData:e;if(!t)return null;if(!(e instanceof y)&&"temporaryProof"in t&&"phoneNumber"in t)return jr.credentialFromResult(e);const n=t.providerId;if(!n||n===We.PASSWORD)return null;let r;switch(n){case We.GOOGLE:r=Sn;break;case We.FACEBOOK:r=Cn;break;case We.GITHUB:r=An;break;case We.TWITTER:r=Pn;break;default:const{oauthIdToken:e,oauthAccessToken:i,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return i||s||e||o?o?n.startsWith("saml.")?Dn._create(n,o):yn._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:i}):new En(n).credential({idToken:e,accessToken:i,rawNonce:a}):null}return e instanceof y?r.credentialFromError(e):r.credentialFromResult(e)}function is(e,t){return t.catch((t=>{throw t instanceof y&&function(e,t){var n;const r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code))t.resolver=new os(e,function(e,t){var n;const r=k(e),i=t;return nt(t.customData.operationType,r,"argument-error"),nt(null===(n=i.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,r,"argument-error"),ir._fromError(r,i)}(e,t));else if(r){const e=rs(t),n=t;e&&(n.credential=e,n.tenantId=r.tenantId||void 0,n.email=r.email||void 0,n.phoneNumber=r.phoneNumber||void 0)}}(e,t),t})).then((e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(r=e,rs(r)),additionalUserInfo:nr(e),user:as.getOrCreate(n)};var r}))}async function ss(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>is(e,n.confirm(t))}}class os{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return is(ns(this.auth),this.resolver.resolveSignIn(e))}}class as{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=k(e);return or.has(t)||or.set(t,sr._fromUser(t)),or.get(t)}(e)}static getOrCreate(e){return as.USER_MAP.has(e)||as.USER_MAP.set(e,new as(e)),as.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return is(this.auth,qn(this._delegate,e))}async linkWithPhoneNumber(e,t){return ss(this.auth,async function(e,t,n){const r=k(e);await Un(!1,r,"phone");const i=await Vr(r.auth,t,k(n));return new Ur(i,(e=>qn(r,e)))}(this._delegate,e,t))}async linkWithPopup(e){return is(this.auth,async function(e,t,n){const r=k(e);et(r.auth,t,bn);const i=Br(r.auth,n);return new Hr(r.auth,"linkViaPopup",t,i,r).executeNotNull()}(this._delegate,e,ts))}async linkWithRedirect(e){return await Yi(rn(this.auth)),function(e,t,n){return async function(e,t,n){const r=k(e);et(r.auth,t,bn),await r.auth._initializationPromise;const i=Br(r.auth,n);await Un(!1,r,t.providerId),await Yr(i,r.auth);const s=await ri(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}(e,t,n)}(this._delegate,e,ts)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return is(this.auth,zn(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return ss(this.auth,async function(e,t,n){const r=k(e),i=await Vr(r.auth,t,k(n));return new Ur(i,(e=>zn(r,e)))}(this._delegate,e,t))}reauthenticateWithPopup(e){return is(this.auth,async function(e,t,n){const r=k(e);et(r.auth,t,bn);const i=Br(r.auth,n);return new Hr(r.auth,"reauthViaPopup",t,i,r).executeNotNull()}(this._delegate,e,ts))}async reauthenticateWithRedirect(e){return await Yi(rn(this.auth)),function(e,t,n){return async function(e,t,n){const r=k(e);et(r.auth,t,bn),await r.auth._initializationPromise;const i=Br(r.auth,n);await Yr(i,r.auth);const s=await ri(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}(e,t,n)}(this._delegate,e,ts)}sendEmailVerification(e){return async function(e,t){const n=k(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Kn(n.auth,r,t);const{email:i}=await async function(e,t){return dn(e,t)}(n.auth,r);i!==e.email&&await e.reload()}(this._delegate,e)}async unlink(e){return await async function(e,t){const n=k(e);await Un(!0,n,t);const{providerUserInfo:r}=await async function(e,t){return pt(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),i=Fn(r||[]);return n.providerData=n.providerData.filter((e=>i.has(e.providerId))),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}(this._delegate,e),this}updateEmail(e){return function(e,t){return Qn(k(e),t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return Qn(k(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return async function(e,t){await Mn(k(e),t)}(this._delegate,e)}updateProfile(e){return async function(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=k(e),i={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=await Tt(r,async function(e,t){return pt(e,"POST","/v1/accounts:update",t)}(r.auth,i));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find((({providerId:e})=>"password"===e));o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(s)}(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return async function(e,t,n){const r=k(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&Kn(r.auth,i,n);const{email:s}=await async function(e,t){return dn(e,t)}(r.auth,i);s!==e.email&&await e.reload()}(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}as.USER_MAP=new WeakMap;const cs=nt;class us{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;cs(n,"invalid-api-key",{appName:e.name}),cs(n,"invalid-api-key",{appName:e.name});const r="undefined"!=typeof window?ts:void 0;this._delegate=t.initialize({options:{persistence:hs(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap($e),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?as.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){!function(e,t,n){const r=rn(e);nt(r._canInitEmulator,r,"emulator-config-failed"),nt(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=on(t),{host:o,port:a}=function(e){const t=on(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:an(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:an(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(this._delegate,e,t)}applyActionCode(e){return async function(e,t){await async function(e,t){return pt(e,"POST","/v1/accounts:update",ft(e,t))}(k(e),{oobCode:t})}(this._delegate,e)}checkActionCode(e){return Hn(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await un(k(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return is(this._delegate,async function(e,t,n){var r;const i=rn(e),s={returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"};let o;if(null===(r=i._getRecaptchaConfig())||void 0===r?void 0:r.emailPasswordEnabled){const e=await en(i,s,"signUpPassword");o=Nn(i,e)}else o=Nn(i,s).catch((async e=>{if("auth/missing-recaptcha-token"===e.code){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const e=await en(i,s,"signUpPassword");return Nn(i,e)}return Promise.reject(e)}));const a=await o.catch((e=>Promise.reject(e))),c=await Rn._fromIdTokenResponse(i,"signIn",a);return await i._updateCurrentUser(c.user),c}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return async function(e,t){const n={identifier:t,continueUri:ot()?st():"http://localhost"},{signinMethods:r}=await async function(e,t){return pt(e,"POST","/v1/accounts:createAuthUri",ft(e,t))}(k(e),n);return r||[]}(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const n=_n.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}(this._delegate,e)}async getRedirectResult(){cs(Ki(),this._delegate,"operation-not-supported-in-this-environment");const e=await async function(e,t){return await rn(e)._initializationPromise,ni(e,t,!1)}(this._delegate,ts);return e?is(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){rn(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=ls(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=ls(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return async function(e,t,n){var r;const i=rn(e),s={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};function o(e,t){nt(t.handleCodeInApp,i,"argument-error"),t&&Kn(i,e,t)}if(null===(r=i._getRecaptchaConfig())||void 0===r?void 0:r.emailPasswordEnabled){const e=await en(i,s,"getOobCode",!0);o(e,n),await pn(i,e)}else o(s,n),await pn(i,s).catch((async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);{console.log("Email link sign-in is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const e=await en(i,s,"getOobCode",!0);o(e,n),await pn(i,e)}}))}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,n){var r;const i=rn(e),s={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};if(null===(r=i._getRecaptchaConfig())||void 0===r?void 0:r.emailPasswordEnabled){const e=await en(i,s,"getOobCode",!0);n&&Kn(i,e,n),await fn(i,e)}else n&&Kn(i,s,n),await fn(i,s).catch((async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);{console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");const e=await en(i,s,"getOobCode",!0);n&&Kn(i,e,n),await fn(i,e)}}))}(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){Ji(Object.values(Qi).includes(t),e,"invalid-persistence-type"),p()?Ji(t!==Qi.SESSION,e,"unsupported-persistence-type"):d()?Ji(t===Qi.NONE,e,"unsupported-persistence-type"):$i()?Ji(t===Qi.NONE||t===Qi.LOCAL&&g(),e,"unsupported-persistence-type"):Ji(t===Qi.NONE||Wi(),e,"unsupported-persistence-type")}(this._delegate,e),e){case Qi.SESSION:t=dr;break;case Qi.LOCAL:t=await Nt(Ar)._isAvailable()?Ar:lr;break;case Qi.NONE:t=Ot;break;default:return Xe("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return is(this._delegate,async function(e){var t;const n=rn(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new Rn({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await Nn(n,{returnSecureToken:!0}),i=await Rn._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}(this._delegate))}signInWithCredential(e){return is(this._delegate,Bn(this._delegate,e))}signInWithCustomToken(e){return is(this._delegate,async function(e,t){const n=rn(e),r=await async function(e,t){return gt(e,"POST","/v1/accounts:signInWithCustomToken",ft(e,t))}(n,{token:t,returnSecureToken:!0}),i=await Rn._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}(this._delegate,e))}signInWithEmailAndPassword(e,t){return is(this._delegate,function(e,t,n){return Bn(k(e),In.credential(t,n))}(this._delegate,e,t))}signInWithEmailLink(e,t){return is(this._delegate,async function(e,t,n){const r=k(e),i=In.credentialWithLink(t,n||st());return nt(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Bn(r,i)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return ss(this._delegate,async function(e,t,n){const r=rn(e),i=await Vr(r,t,k(n));return new Ur(i,(e=>Bn(r,e)))}(this._delegate,e,t))}async signInWithPopup(e){return cs(Ki(),this._delegate,"operation-not-supported-in-this-environment"),is(this._delegate,async function(e,t,n){const r=rn(e);et(e,t,bn);const i=Br(r,n);return new Hr(r,"signInViaPopup",t,i).executeNotNull()}(this._delegate,e,ts))}async signInWithRedirect(e){return cs(Ki(),this._delegate,"operation-not-supported-in-this-environment"),await Yi(this._delegate),function(e,t,n){return async function(e,t,n){const r=rn(e);et(e,t,bn),await r._initializationPromise;const i=Br(r,n);return await Yr(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}(this._delegate,e,ts)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){const{data:n}=await Hn(k(e),t);return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function ls(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&as.getOrCreate(e)),error:t,complete:n}}function hs(e,t){const n=function(e,t){const n=Zi();if(!n)return[];const r=xt(Xi,e,t);switch(n.getItem(r)){case Qi.NONE:return[Ot];case Qi.LOCAL:return[Ar,dr];case Qi.SESSION:return[dr];default:return[]}}(e,t);if("undefined"==typeof self||n.includes(Ar)||n.push(Ar),"undefined"!=typeof window)for(const e of[lr,dr])n.includes(e)||n.push(e);return n.includes(Ot)||n.push(Ot),n}us.Persistence=Qi;class ds{constructor(){this.providerId="phone",this._delegate=new jr(ns(ze.auth()))}static credential(e,t){return jr.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}ds.PHONE_SIGN_IN_METHOD=jr.PHONE_SIGN_IN_METHOD,ds.PROVIDER_ID=jr.PROVIDER_ID;const fs=nt;var ps;(ps=ze).INTERNAL.registerComponent(new P("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new us(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:In,FacebookAuthProvider:Cn,GithubAuthProvider:An,GoogleAuthProvider:Sn,OAuthProvider:En,SAMLAuthProvider:kn,PhoneAuthProvider:ds,PhoneMultiFactorGenerator:ki,RecaptchaVerifier:class{constructor(e,t,n=ze.app()){var r;fs(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new Mr(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:Pn,Auth:us,AuthCredential:cn,Error:y}).setInstantiationMode("LAZY").setMultipleInstances(!1)),ps.registerVersion("@firebase/auth-compat","0.4.2");var ms,gs="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ys={},vs=vs||{},ws=gs||self;function _s(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Is(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var bs="closure_uid_"+(1e9*Math.random()>>>0),Ts=0;function Es(e,t,n){return e.call.apply(e.bind,arguments)}function Cs(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function Ss(e,t,n){return(Ss=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Es:Cs).apply(null,arguments)}function As(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function Ds(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function ks(){this.s=this.s,this.o=this.o}ks.prototype.s=!1,ks.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,bs)&&e[bs]||(e[bs]=++Ts))},ks.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Ps=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Ns(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function Rs(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(_s(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function Os(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}Os.prototype.h=function(){this.defaultPrevented=!0};var xs=function(){if(!ws.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{ws.addEventListener("test",(()=>{}),t),ws.removeEventListener("test",(()=>{}),t)}catch(e){}return e}();function Ls(e){return/^[\s\xa0]*$/.test(e)}function Fs(){var e=ws.navigator;return e&&(e=e.userAgent)?e:""}function Ms(e){return-1!=Fs().indexOf(e)}function Us(e){return Us[" "](e),e}Us[" "]=function(){};var Vs,js,Bs,qs=Ms("Opera"),zs=Ms("Trident")||Ms("MSIE"),Gs=Ms("Edge"),Ws=Gs||zs,$s=Ms("Gecko")&&!(-1!=Fs().toLowerCase().indexOf("webkit")&&!Ms("Edge"))&&!(Ms("Trident")||Ms("MSIE"))&&!Ms("Edge"),Ks=-1!=Fs().toLowerCase().indexOf("webkit")&&!Ms("Edge");function Hs(){var e=ws.document;return e?e.documentMode:void 0}e:{var Qs="",Js=(js=Fs(),$s?/rv:([^\);]+)(\)|;)/.exec(js):Gs?/Edge\/([\d\.]+)/.exec(js):zs?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(js):Ks?/WebKit\/(\S+)/.exec(js):qs?/(?:Version)[ \/]?(\S+)/.exec(js):void 0);if(Js&&(Qs=Js?Js[1]:""),zs){var Xs=Hs();if(null!=Xs&&Xs>parseFloat(Qs)){Vs=String(Xs);break e}}Vs=Qs}ws.document&&zs?Bs=Hs()||parseInt(Vs,10)||void 0:Bs=void 0;var Ys=Bs;function Zs(e,t){if(Os.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if($s){e:{try{Us(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:eo[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Zs.$.h.call(this)}}Ds(Zs,Os);var eo={2:"touch",3:"pen",4:"mouse"};Zs.prototype.h=function(){Zs.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var to="closure_listenable_"+(1e6*Math.random()|0),no=0;function ro(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++no,this.fa=this.ia=!1}function io(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function so(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function oo(e){const t={};for(const n in e)t[n]=e[n];return t}const ao="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function co(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<ao.length;t++)n=ao[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function uo(e){this.src=e,this.g={},this.h=0}function lo(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Ps(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(io(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function ho(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}uo.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=ho(e,t,r,i);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new ro(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var fo="closure_lm_"+(1e6*Math.random()|0),po={};function mo(e,t,n,r,i){if(r&&r.once)return yo(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)mo(e,t[s],n,r,i);return null}return n=Eo(n),e&&e[to]?e.O(t,n,Is(r)?!!r.capture:!!r,i):go(e,t,n,!1,r,i)}function go(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=Is(i)?!!i.capture:!!i,a=bo(e);if(a||(e[fo]=a=new uo(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=Io;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)xs||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(_o(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function yo(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)yo(e,t[s],n,r,i);return null}return n=Eo(n),e&&e[to]?e.P(t,n,Is(r)?!!r.capture:!!r,i):go(e,t,n,!0,r,i)}function vo(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)vo(e,t[s],n,r,i);else r=Is(r)?!!r.capture:!!r,n=Eo(n),e&&e[to]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=ho(s=e.g[t],n,r,i))&&(io(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=bo(e))&&(t=e.g[t.toString()],e=-1,t&&(e=ho(t,n,r,i)),(n=-1<e?t[e]:null)&&wo(n))}function wo(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[to])lo(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(_o(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=bo(t))?(lo(n,e),0==n.h&&(n.src=null,t[fo]=null)):io(e)}}}function _o(e){return e in po?po[e]:po[e]="on"+e}function Io(e,t){if(e.fa)e=!0;else{t=new Zs(t,this);var n=e.listener,r=e.la||e.src;e.ia&&wo(e),e=n.call(r,t)}return e}function bo(e){return(e=e[fo])instanceof uo?e:null}var To="__closure_events_fn_"+(1e9*Math.random()>>>0);function Eo(e){return"function"==typeof e?e:(e[To]||(e[To]=function(t){return e.handleEvent(t)}),e[To])}function Co(){ks.call(this),this.i=new uo(this),this.S=this,this.J=null}function So(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new Os(t,e);else if(t instanceof Os)t.target=t.target||e;else{var i=t;co(t=new Os(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=Ao(o,r,!0,t)&&i}if(i=Ao(o=t.g=e,r,!0,t)&&i,i=Ao(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=Ao(o=t.g=n[s],r,!1,t)&&i}function Ao(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&lo(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}Ds(Co,ks),Co.prototype[to]=!0,Co.prototype.removeEventListener=function(e,t,n,r){vo(this,e,t,n,r)},Co.prototype.N=function(){if(Co.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)io(n[r]);delete t.g[e],t.h--}}this.J=null},Co.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Co.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Do=ws.JSON.stringify;function ko(){var e=Fo;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Po=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new No),(e=>e.reset()));class No{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Ro(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Oo(e){ws.setTimeout((()=>{throw e}),0)}let xo,Lo=!1,Fo=new class{constructor(){this.h=this.g=null}add(e,t){const n=Po.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},Mo=()=>{const e=ws.Promise.resolve(void 0);xo=()=>{e.then(Uo)}};var Uo=()=>{for(var e;e=ko();){try{e.h.call(e.g)}catch(e){Oo(e)}var t=Po;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Lo=!1};function Vo(e,t){Co.call(this),this.h=e||1,this.g=t||ws,this.j=Ss(this.qb,this),this.l=Date.now()}function jo(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function Bo(e,t,n){if("function"==typeof e)n&&(e=Ss(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Ss(e.handleEvent,e)}return 2147483647<Number(t)?-1:ws.setTimeout(e,t||0)}function qo(e){e.g=Bo((()=>{e.g=null,e.i&&(e.i=!1,qo(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}Ds(Vo,Co),(ms=Vo.prototype).ga=!1,ms.T=null,ms.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),So(this,"tick"),this.ga&&(jo(this),this.start()))}},ms.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},ms.N=function(){Vo.$.N.call(this),jo(this),delete this.g};class zo extends ks{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:qo(this)}N(){super.N(),this.g&&(ws.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Go(e){ks.call(this),this.h=e,this.g={}}Ds(Go,ks);var Wo=[];function $o(e,t,n,r){Array.isArray(n)||(n&&(Wo[0]=n.toString()),n=Wo);for(var i=0;i<n.length;i++){var s=mo(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Ko(e){so(e.g,(function(e,t){this.g.hasOwnProperty(t)&&wo(e)}),e),e.g={}}function Ho(){this.g=!0}function Qo(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Do(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}Go.prototype.N=function(){Go.$.N.call(this),Ko(this)},Go.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ho.prototype.Ea=function(){this.g=!1},Ho.prototype.info=function(){};var Jo={},Xo=null;function Yo(){return Xo=Xo||new Co}function Zo(e){Os.call(this,Jo.Ta,e)}function ea(e){const t=Yo();So(t,new Zo(t))}function ta(e,t){Os.call(this,Jo.STAT_EVENT,e),this.stat=t}function na(e){const t=Yo();So(t,new ta(t,e))}function ra(e,t){Os.call(this,Jo.Ua,e),this.size=t}function ia(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return ws.setTimeout((function(){e()}),t)}Jo.Ta="serverreachability",Ds(Zo,Os),Jo.STAT_EVENT="statevent",Ds(ta,Os),Jo.Ua="timingevent",Ds(ra,Os);var sa={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},oa={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function aa(){}function ca(e){return e.h||(e.h=e.i())}function ua(){}aa.prototype.h=null;var la,ha={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function da(){Os.call(this,"d")}function fa(){Os.call(this,"c")}function pa(){}function ma(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new Go(this),this.P=ya,e=Ws?125:void 0,this.V=new Vo(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ga}function ga(){this.i=null,this.g="",this.h=!1}Ds(da,Os),Ds(fa,Os),Ds(pa,aa),pa.prototype.g=function(){return new XMLHttpRequest},pa.prototype.i=function(){return{}},la=new pa;var ya=45e3,va={},wa={};function _a(e,t,n){e.L=1,e.v=Va(xa(t)),e.s=n,e.S=!0,Ia(e,null)}function Ia(e,t){e.G=Date.now(),Ca(e),e.A=xa(e.v);var n=e.A,r=e.W;Array.isArray(r)||(r=[String(r)]),Ya(n.i,"t",r),e.C=0,n=e.l.J,e.h=new ga,e.g=Xc(e.l,n?t:null,!e.s),0<e.O&&(e.M=new zo(Ss(e.Pa,e,e.g),e.O)),$o(e.U,e.g,"readystatechange",e.nb),t=e.I?oo(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),ea(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.W,e.s)}function ba(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.l.Ha}function Ta(e,t,n){let r,i=!0;for(;!e.J&&e.C<n.length;){if(r=Ea(e,n),r==wa){4==t&&(e.o=4,na(14),i=!1),Qo(e.j,e.m,null,"[Incomplete Response]");break}if(r==va){e.o=4,na(15),Qo(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Qo(e.j,e.m,r,null),Pa(e,r)}ba(e)&&r!=wa&&r!=va&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,na(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),zc(t),t.M=!0,na(11))):(Qo(e.j,e.m,n,"[Invalid Chunked Response]"),ka(e),Da(e))}function Ea(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?wa:(n=Number(t.substring(n,r)),isNaN(n)?va:(r+=1)+n>t.length?wa:(t=t.slice(r,r+n),e.C=r+n,t))}function Ca(e){e.Y=Date.now()+e.P,Sa(e,e.P)}function Sa(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=ia(Ss(e.lb,e),t)}function Aa(e){e.B&&(ws.clearTimeout(e.B),e.B=null)}function Da(e){0==e.l.H||e.J||$c(e.l,e)}function ka(e){Aa(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,jo(e.V),Ko(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Pa(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||ic(n.i,e)))if(!e.K&&ic(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;Wc(n),Lc(n)}qc(n),na(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=ia(Ss(n.ib,n),6e3));if(1>=rc(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else Hc(n,11)}else if((e.K||n.g==e)&&Wc(n),!Ls(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(sc(s,s.h),s.h=null))}if(r.F){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,Ua(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((r=n).wa=Jc(r,r.J?r.pa:null,r.Y),o.K){oc(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.B&&(Aa(a),Ca(a)),r.g=o}else Bc(r);0<n.j.length&&Mc(n)}else"stop"!=u[0]&&"close"!=u[0]||Hc(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Hc(n,7):xc(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}ea()}catch(e){}}function Na(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(_s(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(_s(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(_s(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(ms=ma.prototype).setTimeout=function(e){this.P=e},ms.nb=function(e){e=e.target;const t=this.M;t&&3==Dc(e)?t.l():this.Pa(e)},ms.Pa=function(e){try{if(e==this.g)e:{const l=Dc(this.g);var t=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||Ws||this.g&&(this.h.h||this.g.ja()||kc(this.g)))){this.J||4!=l||7==t||ea(),Aa(this);var n=this.g.da();this.ca=n;t:if(ba(this)){var r=kc(this.g);e="";var i=r.length,s=4==Dc(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){ka(this),Da(this);var o="";break t}this.h.i=new ws.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ls(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,na(12),ka(this),Da(this);break e}Qo(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Pa(this,n)}this.S?(Ta(this,l,o),Ws&&this.i&&3==l&&($o(this.U,this.V,"tick",this.mb),this.V.start())):(Qo(this.j,this.m,o,null),Pa(this,o)),4==l&&ka(this),this.i&&!this.J&&(4==l?$c(this.l,this):(this.i=!1,Ca(this)))}else(function(e){const t={};e=(e.g&&2<=Dc(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(Ls(e[r]))continue;var n=Ro(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,na(12)):(this.o=0,na(13)),ka(this),Da(this)}}}catch(e){}},ms.mb=function(){if(this.g){var e=Dc(this.g),t=this.g.ja();this.C<t.length&&(Aa(this),Ta(this,e,t),this.i&&4!=e&&Ca(this))}},ms.cancel=function(){this.J=!0,ka(this)},ms.lb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.L&&(ea(),na(17)),ka(this),this.o=2,Da(this)):Sa(this,this.Y-e)};var Ra=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Oa(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Oa){this.h=e.h,La(this,e.j),this.s=e.s,this.g=e.g,Fa(this,e.m),this.l=e.l;var t=e.i,n=new Ha;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Ma(this,n),this.o=e.o}else e&&(t=String(e).match(Ra))?(this.h=!1,La(this,t[1]||"",!0),this.s=ja(t[2]||""),this.g=ja(t[3]||"",!0),Fa(this,t[4]),this.l=ja(t[5]||"",!0),Ma(this,t[6]||"",!0),this.o=ja(t[7]||"")):(this.h=!1,this.i=new Ha(null,this.h))}function xa(e){return new Oa(e)}function La(e,t,n){e.j=n?ja(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Fa(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Ma(e,t,n){t instanceof Ha?(e.i=t,function(e,t){t&&!e.j&&(Qa(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Ja(this,t),Ya(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Ba(t,$a)),e.i=new Ha(t,e.h))}function Ua(e,t,n){e.i.set(t,n)}function Va(e){return Ua(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ja(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Ba(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,qa),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function qa(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Oa.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Ba(t,za,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Ba(t,za,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Ba(n,"/"==n.charAt(0)?Wa:Ga,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Ba(n,Ka)),e.join("")};var za=/[#\/\?@]/g,Ga=/[#\?:]/g,Wa=/[#\?]/g,$a=/[#\?@]/g,Ka=/#/g;function Ha(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Qa(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Ja(e,t){Qa(e),t=Za(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Xa(e,t){return Qa(e),t=Za(e,t),e.g.has(t)}function Ya(e,t,n){Ja(e,t),0<n.length&&(e.i=null,e.g.set(Za(e,t),Ns(n)),e.h+=n.length)}function Za(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function ec(e){this.l=e||tc,e=ws.PerformanceNavigationTiming?0<(e=ws.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(ws.g&&ws.g.Ka&&ws.g.Ka()&&ws.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(ms=Ha.prototype).add=function(e,t){Qa(this),this.i=null,e=Za(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},ms.forEach=function(e,t){Qa(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},ms.ta=function(){Qa(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},ms.Z=function(e){Qa(this);let t=[];if("string"==typeof e)Xa(this,e)&&(t=t.concat(this.g.get(Za(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},ms.set=function(e,t){return Qa(this),this.i=null,Xa(this,e=Za(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},ms.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},ms.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var tc=10;function nc(e){return!!e.h||!!e.g&&e.g.size>=e.j}function rc(e){return e.h?1:e.g?e.g.size:0}function ic(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function sc(e,t){e.g?e.g.add(t):e.h=t}function oc(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function ac(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return Ns(e.i)}ec.prototype.cancel=function(){if(this.i=ac(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var cc=class{stringify(e){return ws.JSON.stringify(e,void 0)}parse(e){return ws.JSON.parse(e,void 0)}};function uc(){this.g=new cc}function lc(e,t,n){const r=n||"";try{Na(e,(function(e,n){let i=e;Is(e)&&(i=Do(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function hc(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function dc(e){this.l=e.fc||null,this.j=e.ob||!1}function fc(e,t){Co.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=pc,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ds(dc,aa),dc.prototype.g=function(){return new fc(this.l,this.j)},dc.prototype.i=function(e){return function(){return e}}({}),Ds(fc,Co);var pc=0;function mc(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function gc(e){e.readyState=4,e.l=null,e.j=null,e.A=null,yc(e)}function yc(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(ms=fc.prototype).open=function(e,t){if(this.readyState!=pc)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,yc(this)},ms.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||ws).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},ms.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,gc(this)),this.readyState=pc},ms.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,yc(this)),this.g&&(this.readyState=3,yc(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==ws.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;mc(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},ms.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?gc(this):yc(this),3==this.readyState&&mc(this)}},ms.Za=function(e){this.g&&(this.response=this.responseText=e,gc(this))},ms.Ya=function(e){this.g&&(this.response=e,gc(this))},ms.ka=function(){this.g&&gc(this)},ms.setRequestHeader=function(e,t){this.v.append(e,t)},ms.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},ms.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(fc.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var vc=ws.JSON.parse;function wc(e){Co.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=_c,this.L=this.M=!1}Ds(wc,Co);var _c="",Ic=/^https?$/i,bc=["POST","PUT"];function Tc(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Ec(e),Sc(e)}function Ec(e){e.F||(e.F=!0,So(e,"complete"),So(e,"error"))}function Cc(e){if(e.h&&void 0!==vs&&(!e.C[1]||4!=Dc(e)||2!=e.da()))if(e.v&&4==Dc(e))Bo(e.La,0,e);else if(So(e,"readystatechange"),4==Dc(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===o){var i=String(e.I).match(Ra)[1]||null;!i&&ws.self&&ws.self.location&&(i=ws.self.location.protocol.slice(0,-1)),r=!Ic.test(i?i.toLowerCase():"")}n=r}if(n)So(e,"complete"),So(e,"success");else{e.m=6;try{var s=2<Dc(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",Ec(e)}}finally{Sc(e)}}}function Sc(e,t){if(e.g){Ac(e);const n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||So(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Ac(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(ws.clearTimeout(e.A),e.A=null)}function Dc(e){return e.g?e.g.readyState:0}function kc(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case _c:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Pc(e){let t="";return so(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Nc(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Pc(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Ua(e,t,n))}function Rc(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Oc(e){this.Ga=0,this.j=[],this.l=new Ho,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Rc("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Rc("baseRetryDelayMs",5e3,e),this.hb=Rc("retryDelaySeedMs",1e4,e),this.eb=Rc("forwardChannelMaxRetries",2,e),this.xa=Rc("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new ec(e&&e.concurrentRequestLimit),this.Ja=new uc,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function xc(e){if(Fc(e),3==e.H){var t=e.W++,n=xa(e.I);if(Ua(n,"SID",e.K),Ua(n,"RID",t),Ua(n,"TYPE","terminate"),Vc(e,n),(t=new ma(e,e.l,t)).L=2,t.v=Va(xa(n)),n=!1,ws.navigator&&ws.navigator.sendBeacon)try{n=ws.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&ws.Image&&((new Image).src=t.v,n=!0),n||(t.g=Xc(t.l,null),t.g.ha(t.v)),t.G=Date.now(),Ca(t)}Qc(e)}function Lc(e){e.g&&(zc(e),e.g.cancel(),e.g=null)}function Fc(e){Lc(e),e.u&&(ws.clearTimeout(e.u),e.u=null),Wc(e),e.i.cancel(),e.m&&("number"==typeof e.m&&ws.clearTimeout(e.m),e.m=null)}function Mc(e){if(!nc(e.i)&&!e.m){e.m=!0;var t=e.Na;xo||Mo(),Lo||(xo(),Lo=!0),Fo.add(t,e),e.C=0}}function Uc(e,t){var n;n=t?t.m:e.W++;const r=xa(e.I);Ua(r,"SID",e.K),Ua(r,"RID",n),Ua(r,"AID",e.V),Vc(e,r),e.o&&e.s&&Nc(r,e.o,e.s),n=new ma(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=jc(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),sc(e.i,n),_a(n,r,t)}function Vc(e,t){e.na&&so(e.na,(function(e,n){Ua(t,n,e)})),e.h&&Na({},(function(e,n){Ua(t,n,e)}))}function jc(e,t,n){n=Math.min(e.j.length,n);var r=e.h?Ss(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{lc(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function Bc(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;xo||Mo(),Lo||(xo(),Lo=!0),Fo.add(t,e),e.A=0}}function qc(e){return!(e.g||e.u||3<=e.A||(e.ba++,e.u=ia(Ss(e.Ma,e),Kc(e,e.A)),e.A++,0))}function zc(e){null!=e.B&&(ws.clearTimeout(e.B),e.B=null)}function Gc(e){e.g=new ma(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=xa(e.wa);Ua(t,"RID","rpc"),Ua(t,"SID",e.K),Ua(t,"AID",e.V),Ua(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&Ua(t,"TO",e.qa),Ua(t,"TYPE","xmlhttp"),Vc(e,t),e.o&&e.s&&Nc(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=Va(xa(t)),n.s=null,n.S=!0,Ia(n,e)}function Wc(e){null!=e.v&&(ws.clearTimeout(e.v),e.v=null)}function $c(e,t){var n=null;if(e.g==t){Wc(e),zc(e),e.g=null;var r=2}else{if(!ic(e.i,t))return;n=t.F,oc(e.i,t),r=1}if(0!=e.H)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.G;var i=e.C;So(r=Yo(),new ra(r,n)),Mc(e)}else Bc(e);else if(3==(i=t.o)||0==i&&0<t.ca||!(1==r&&function(e,t){return!(rc(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=ia(Ss(e.Na,e,t),Kc(e,e.C)),e.C++,0)))}(e,t)||2==r&&qc(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:Hc(e,5);break;case 4:Hc(e,10);break;case 3:Hc(e,6);break;default:Hc(e,2)}}function Kc(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function Hc(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=Ss(e.pb,e);n||(n=new Oa("//www.google.com/images/cleardot.gif"),ws.location&&"http"==ws.location.protocol||La(n,"https"),Va(n)),function(e,t){const n=new Ho;if(ws.Image){const r=new Image;r.onload=As(hc,n,r,"TestLoadImage: loaded",!0,t),r.onerror=As(hc,n,r,"TestLoadImage: error",!1,t),r.onabort=As(hc,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=As(hc,n,r,"TestLoadImage: timeout",!1,t),ws.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else na(2);e.H=0,e.h&&e.h.za(t),Qc(e),Fc(e)}function Qc(e){if(e.H=0,e.ma=[],e.h){const t=ac(e.i);0==t.length&&0==e.j.length||(Rs(e.ma,t),Rs(e.ma,e.j),e.i.i.length=0,Ns(e.j),e.j.length=0),e.h.ya()}}function Jc(e,t,n){var r=n instanceof Oa?xa(n):new Oa(n);if(""!=r.g)t&&(r.g=t+"."+r.g),Fa(r,r.m);else{var i=ws.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new Oa(null);r&&La(s,r),t&&(s.g=t),i&&Fa(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&Ua(r,n,t),Ua(r,"VER",e.ra),Vc(e,r),r}function Xc(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new wc(new dc({ob:!0})):new wc(e.va)).Oa(e.J),t}function Yc(){}function Zc(){if(zs&&!(10<=Number(Ys)))throw Error("Environmental error: no available transport.")}function eu(e,t){Co.call(this),this.g=new Oc(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!Ls(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Ls(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new ru(this)}function tu(e){da.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function nu(){fa.call(this),this.status=1}function ru(e){this.g=e}function iu(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function su(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function ou(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(ms=wc.prototype).Oa=function(e){this.M=e},ms.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():la.g(),this.C=this.u?ca(this.u):ca(la),this.g.onreadystatechange=Ss(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void Tc(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=ws.FormData&&e instanceof ws.FormData,!(0<=Ps(bc,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Ac(this),0<this.B&&((this.L=function(e){return zs&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ss(this.ua,this)):this.A=Bo(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Tc(this,e)}},ms.ua=function(){void 0!==vs&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,So(this,"timeout"),this.abort(8))},ms.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,So(this,"complete"),So(this,"abort"),Sc(this))},ms.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Sc(this,!0)),wc.$.N.call(this)},ms.La=function(){this.s||(this.G||this.v||this.l?Cc(this):this.kb())},ms.kb=function(){Cc(this)},ms.isActive=function(){return!!this.g},ms.da=function(){try{return 2<Dc(this)?this.g.status:-1}catch(e){return-1}},ms.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},ms.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),vc(t)}},ms.Ia=function(){return this.m},ms.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(ms=Oc.prototype).ra=8,ms.H=1,ms.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const i=new ma(this,this.l,e);let s=this.s;if(this.U&&(s?(s=oo(s),co(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=jc(this,i,t),Ua(n=xa(this.I),"RID",e),Ua(n,"CVER",22),this.F&&Ua(n,"X-HTTP-Session-Id",this.F),Vc(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Pc(s)))+"&"+t:this.o&&Nc(n,this.o,s)),sc(this.i,i),this.bb&&Ua(n,"TYPE","init"),this.P?(Ua(n,"$req",t),Ua(n,"SID","null"),i.aa=!0,_a(i,n,null)):_a(i,n,t),this.H=2}}else 3==this.H&&(e?Uc(this,e):0==this.j.length||nc(this.i)||Uc(this))},ms.Ma=function(){if(this.u=null,Gc(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=ia(Ss(this.jb,this),e)}},ms.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,na(10),Lc(this),Gc(this))},ms.ib=function(){null!=this.v&&(this.v=null,Lc(this),qc(this),na(19))},ms.pb=function(e){e?(this.l.info("Successfully pinged google.com"),na(2)):(this.l.info("Failed to ping google.com"),na(1))},ms.isActive=function(){return!!this.h&&this.h.isActive(this)},(ms=Yc.prototype).Ba=function(){},ms.Aa=function(){},ms.za=function(){},ms.ya=function(){},ms.isActive=function(){return!0},ms.Va=function(){},Zc.prototype.g=function(e,t){return new eu(e,t)},Ds(eu,Co),eu.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;na(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=Jc(e,null,e.Y),Mc(e)},eu.prototype.close=function(){xc(this.g)},eu.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=Do(e),e=n);t.j.push(new class{constructor(e,t){this.g=e,this.map=t}}(t.fb++,e)),3==t.H&&Mc(t)},eu.prototype.N=function(){this.g.h=null,delete this.j,xc(this.g),delete this.g,eu.$.N.call(this)},Ds(tu,da),Ds(nu,fa),Ds(ru,Yc),ru.prototype.Ba=function(){So(this.g,"a")},ru.prototype.Aa=function(e){So(this.g,new tu(e))},ru.prototype.za=function(e){So(this.g,new nu)},ru.prototype.ya=function(){So(this.g,"b")},Ds(iu,(function(){this.blockSize=-1})),iu.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},iu.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)su(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){su(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){su(this,r),i=0;break}}this.h=i,this.i+=t},iu.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var au={};function cu(e){return-128<=e&&128>e?function(e,t){var n=au;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=function(e){return new ou([0|e],0>e?-1:0)}(e)}(e):new ou([0|e],0>e?-1:0)}function uu(e){if(isNaN(e)||!isFinite(e))return hu;if(0>e)return gu(uu(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=lu;return new ou(t,0)}var lu=4294967296,hu=cu(0),du=cu(1),fu=cu(16777216);function pu(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function mu(e){return-1==e.h}function gu(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new ou(n,~e.h).add(du)}function yu(e,t){return e.add(gu(t))}function vu(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function wu(e,t){this.g=e,this.h=t}function _u(e,t){if(pu(t))throw Error("division by zero");if(pu(e))return new wu(hu,hu);if(mu(e))return t=_u(gu(e),t),new wu(gu(t.g),gu(t.h));if(mu(t))return t=_u(e,gu(t)),new wu(gu(t.g),t.h);if(30<e.g.length){if(mu(e)||mu(t))throw Error("slowDivide_ only works with positive integers.");for(var n=du,r=t;0>=r.X(e);)n=Iu(n),r=Iu(r);var i=bu(n,1),s=bu(r,1);for(r=bu(r,2),n=bu(n,2);!pu(r);){var o=s.add(r);0>=o.X(e)&&(i=i.add(n),s=o),r=bu(r,1),n=bu(n,1)}return t=yu(e,i.R(t)),new wu(i,t)}for(i=hu;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=uu(n)).R(t);mu(o)||0<o.X(e);)o=(s=uu(n-=r)).R(t);pu(s)&&(s=du),i=i.add(s),e=yu(e,o)}return new wu(i,e)}function Iu(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new ou(n,e.h)}function bu(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new ou(i,e.h)}(ms=ou.prototype).ea=function(){if(mu(this))return-gu(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:lu+r)*t,t*=lu}return e},ms.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(pu(this))return"0";if(mu(this))return"-"+gu(this).toString(e);for(var t=uu(Math.pow(e,6)),n=this,r="";;){var i=_u(n,t).g,s=((0<(n=yu(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(pu(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},ms.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},ms.X=function(e){return mu(e=yu(this,e))?-1:pu(e)?0:1},ms.abs=function(){return mu(this)?gu(this):this},ms.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new ou(n,-2147483648&n[n.length-1]?-1:0)},ms.R=function(e){if(pu(this)||pu(e))return hu;if(mu(this))return mu(e)?gu(this).R(gu(e)):gu(gu(this).R(e));if(mu(e))return gu(this.R(gu(e)));if(0>this.X(fu)&&0>e.X(fu))return uu(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=e.D(i)>>>16,c=65535&e.D(i);n[2*r+2*i]+=o*c,vu(n,2*r+2*i),n[2*r+2*i+1]+=s*c,vu(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,vu(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,vu(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new ou(n,0)},ms.gb=function(e){return _u(this,e).h},ms.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new ou(n,this.h&e.h)},ms.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new ou(n,this.h|e.h)},ms.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new ou(n,this.h^e.h)},Zc.prototype.createWebChannel=Zc.prototype.g,eu.prototype.send=eu.prototype.u,eu.prototype.open=eu.prototype.m,eu.prototype.close=eu.prototype.close,sa.NO_ERROR=0,sa.TIMEOUT=8,sa.HTTP_ERROR=6,oa.COMPLETE="complete",ua.EventType=ha,ha.OPEN="a",ha.CLOSE="b",ha.ERROR="c",ha.MESSAGE="d",Co.prototype.listen=Co.prototype.O,wc.prototype.listenOnce=wc.prototype.P,wc.prototype.getLastError=wc.prototype.Sa,wc.prototype.getLastErrorCode=wc.prototype.Ia,wc.prototype.getStatus=wc.prototype.da,wc.prototype.getResponseJson=wc.prototype.Wa,wc.prototype.getResponseText=wc.prototype.ja,wc.prototype.send=wc.prototype.ha,wc.prototype.setWithCredentials=wc.prototype.Oa,iu.prototype.digest=iu.prototype.l,iu.prototype.reset=iu.prototype.reset,iu.prototype.update=iu.prototype.j,ou.prototype.add=ou.prototype.add,ou.prototype.multiply=ou.prototype.R,ou.prototype.modulo=ou.prototype.gb,ou.prototype.compare=ou.prototype.X,ou.prototype.toNumber=ou.prototype.ea,ou.prototype.toString=ou.prototype.toString,ou.prototype.getBits=ou.prototype.D,ou.fromNumber=uu,ou.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return gu(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=uu(Math.pow(n,8)),i=hu,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=uu(Math.pow(n,o)),i=i.R(o).add(uu(a))):i=(i=i.R(r)).add(uu(a))}return i};var Tu=ys.createWebChannelTransport=function(){return new Zc},Eu=ys.getStatEventTarget=function(){return Yo()},Cu=ys.ErrorCode=sa,Su=ys.EventType=oa,Au=ys.Event=Jo,Du=ys.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},ku=ys.FetchXmlHttpFactory=dc,Pu=ys.WebChannel=ua,Nu=ys.XhrIo=wc,Ru=ys.Md5=iu,Ou=ys.Integer=ou;const xu="@firebase/firestore";class Lu{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Lu.UNAUTHENTICATED=new Lu(null),Lu.GOOGLE_CREDENTIALS=new Lu("google-credentials-uid"),Lu.FIRST_PARTY=new Lu("first-party-uid"),Lu.MOCK_USER=new Lu("mock-user");let Fu="9.23.0";const Mu=new j("@firebase/firestore");function Uu(){return Mu.logLevel}function Vu(e,...t){if(Mu.logLevel<=L.DEBUG){const n=t.map(qu);Mu.debug(`Firestore (${Fu}): ${e}`,...n)}}function ju(e,...t){if(Mu.logLevel<=L.ERROR){const n=t.map(qu);Mu.error(`Firestore (${Fu}): ${e}`,...n)}}function Bu(e,...t){if(Mu.logLevel<=L.WARN){const n=t.map(qu);Mu.warn(`Firestore (${Fu}): ${e}`,...n)}}function qu(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function zu(e="Unexpected state"){const t=`FIRESTORE (${Fu}) INTERNAL ASSERTION FAILED: `+e;throw ju(t),new Error(t)}function Gu(e,t){e||zu()}function Wu(e,t){return e}const $u={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ku extends y{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Hu{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Qu{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ju{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Lu.UNAUTHENTICATED)))}shutdown(){}}class Xu{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Yu{constructor(e){this.t=e,this.currentUser=Lu.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Hu;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Hu,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{Vu("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Vu("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Hu)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Vu("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Gu("string"==typeof t.accessToken),new Qu(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Gu(null===e||"string"==typeof e),new Lu(e)}}class Zu{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=Lu.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class el{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Zu(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(Lu.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class tl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class nl{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const n=e=>{null!=e.error&&Vu("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.T;return this.T=e.token,Vu("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{Vu("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.I.getImmediate({optional:!0});e?r(e):Vu("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Gu("string"==typeof e.token),this.T=e.token,new tl(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function rl(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class il{static A(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=rl(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function sl(e,t){return e<t?-1:e>t?1:0}function ol(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function al(e){return e+"\0"}class cl{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ku($u.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ku($u.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Ku($u.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ku($u.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return cl.fromMillis(Date.now())}static fromDate(e){return cl.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new cl(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?sl(this.nanoseconds,e.nanoseconds):sl(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ul{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ul(e)}static min(){return new ul(new cl(0,0))}static max(){return new ul(new cl(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ll{constructor(e,t,n){void 0===t?t=0:t>e.length&&zu(),void 0===n?n=e.length-t:n>e.length-t&&zu(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ll.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ll?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class hl extends ll{construct(e,t,n){return new hl(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Ku($u.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new hl(t)}static emptyPath(){return new hl([])}}const dl=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class fl extends ll{construct(e,t,n){return new fl(e,t,n)}static isValidIdentifier(e){return dl.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),fl.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new fl(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Ku($u.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Ku($u.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Ku($u.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new Ku($u.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new fl(t)}static emptyPath(){return new fl([])}}class pl{constructor(e){this.path=e}static fromPath(e){return new pl(hl.fromString(e))}static fromName(e){return new pl(hl.fromString(e).popFirst(5))}static empty(){return new pl(hl.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===hl.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return hl.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new pl(new hl(e.slice()))}}class ml{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function gl(e){return e.fields.find((e=>2===e.kind))}function yl(e){return e.fields.filter((e=>2!==e.kind))}ml.UNKNOWN_ID=-1;class vl{constructor(e,t){this.fieldPath=e,this.kind=t}}class wl{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new wl(0,bl.min())}}function _l(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=ul.fromTimestamp(1e9===r?new cl(n+1,0):new cl(n,r));return new bl(i,pl.empty(),t)}function Il(e){return new bl(e.readTime,e.key,-1)}class bl{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new bl(ul.min(),pl.empty(),-1)}static max(){return new bl(ul.max(),pl.empty(),-1)}}function Tl(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=pl.comparator(e.documentKey,t.documentKey),0!==n?n:sl(e.largestBatchId,t.largestBatchId))}const El="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Cl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Sl(e){if(e.code!==$u.FAILED_PRECONDITION||e.message!==El)throw e;Vu("LocalStore","Unexpectedly lost primary lease")}class Al{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&zu(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Al(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Al?t:Al.resolve(t)}catch(e){return Al.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Al.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Al.reject(t)}static resolve(e){return new Al(((t,n)=>{t(e)}))}static reject(e){return new Al(((t,n)=>{n(e)}))}static waitFor(e){return new Al(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=Al.resolve(!1);for(const n of e)t=t.next((e=>e?Al.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new Al(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new Al(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}class Dl{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.v=new Hu,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{t.error?this.v.reject(new Nl(e,t.error)):this.v.resolve()},this.transaction.onerror=t=>{const n=Fl(t.target.error);this.v.reject(new Nl(e,n))}}static open(e,t,n,r){try{return new Dl(t,e.transaction(r,n))}catch(e){throw new Nl(t,e)}}get R(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(Vu("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Ol(t)}}class kl{constructor(e,t,n){this.name=e,this.version=t,this.V=n,12.2===kl.S(h())&&ju("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Vu("SimpleDb","Removing database:",e),xl(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!g())return!1;if(kl.C())return!0;const e=h(),t=kl.S(e),n=0<t&&t<10,r=kl.N(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static C(){var e;return"undefined"!=typeof process&&"YES"===(null===(e={ALLUSERSPROFILE:"C:\\ProgramData",APPDATA:"C:\\Users\\tanuj\\AppData\\Roaming",ChocolateyInstall:"C:\\ProgramData\\chocolatey",ChocolateyLastPathUpdate:"133002477445968421",COLOR:"1",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"TANUJS-PC",ComSpec:"C:\\Windows\\system32\\cmd.exe",CUDA_PATH:"C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8",CUDA_PATH_V11_8:"C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EDITOR:"C:\\Windows\\notepad.exe",HOME:"C:\\Users\\tanuj",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\tanuj",INIT_CWD:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend",JAVA_HOME:"C:\\Program Files (x86)\\Eclipse Adoptium\\jdk-16.0.2.7-hotspot\\",LOCALAPPDATA:"C:\\Users\\tanuj\\AppData\\Local",LOGONSERVER:"\\\\TANUJS-PC",NODE:"C:\\Program Files\\nodejs\\node.exe",NODE_EXE:"C:\\Program Files\\nodejs\\\\node.exe",NPM_CLI_JS:"C:\\Program Files\\nodejs\\\\node_modules\\npm\\bin\\npm-cli.js",npm_command:"exec",npm_config_cache:"C:\\Users\\tanuj\\AppData\\Local\\npm-cache",npm_config_globalconfig:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\etc\\npmrc",npm_config_global_prefix:"C:\\Users\\tanuj\\AppData\\Roaming\\npm",npm_config_init_module:"C:\\Users\\tanuj\\.npm-init.js",npm_config_local_prefix:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend",npm_config_metrics_registry:"https://registry.npmjs.org/",npm_config_node_gyp:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js",npm_config_noproxy:"",npm_config_prefix:"C:\\Users\\tanuj\\AppData\\Roaming\\npm",npm_config_userconfig:"C:\\Users\\tanuj\\.npmrc",npm_config_user_agent:"npm/9.6.5 node/v18.12.1 win32 x64 workspaces/false",npm_execpath:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npx-cli.js",npm_lifecycle_event:"npx",npm_lifecycle_script:"webpack",npm_node_execpath:"C:\\Program Files\\nodejs\\node.exe",npm_package_json:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend\\package.json",npm_package_name:"frontend",npm_package_version:"1.0.0",NPM_PREFIX_NPX_CLI_JS:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npx-cli.js",NPX_CLI_JS:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npx-cli.js",NUMBER_OF_PROCESSORS:"16",NVTOOLSEXT_PATH:"C:\\Program Files\\NVIDIA Corporation\\NvToolsExt\\",OneDrive:"C:\\Users\\tanuj\\OneDrive",OneDriveConsumer:"C:\\Users\\tanuj\\OneDrive",OPENAI_API_KEY:"test",OS:"Windows_NT",Path:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend\\node_modules\\.bin;C:\\Users\\tanuj\\Code\\WriteRight\\frontend\\node_modules\\.bin;C:\\Users\\tanuj\\Code\\WriteRight\\node_modules\\.bin;C:\\Users\\tanuj\\Code\\node_modules\\.bin;C:\\Users\\tanuj\\node_modules\\.bin;C:\\Users\\node_modules\\.bin;C:\\node_modules\\.bin;C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\@npmcli\\run-script\\lib\\node-gyp-bin;C:\\Program Files\\Eclipse Adoptium\\jdk-11.0.17.8-hotspot\\bin;C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8\\bin;C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8\\libnvvp;C:\\Users\\tanuj\\AppData\\Local\\Programs\\Python\\Python310\\Scripts\\;C:\\Users\\tanuj\\AppData\\Local\\Programs\\Python\\Python310\\;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\Program Files (x86)\\Eclipse Adoptium\\jdk-16.0.2.7-hotspot\\bin;C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\;C:\\Windows\\System32\\OpenSSH\\;D:\\Program Files\\PuTTY\\;C:\\Program Files (x86)\\NVIDIA Corporation\\PhysX\\Common;C:\\Program Files\\NVIDIA Corporation\\NVIDIA NvDLISR;C:\\Program Files\\Git\\cmd;C:\\ProgramData\\chocolatey\\bin;C:\\Program Files\\dotnet\\;C:\\Program Files\\Docker\\Docker\\resources\\bin;C:\\ProgramData\\DockerDesktop\\version-bin;C:\\Program Files\\WireGuard\\;C:\\Program Files\\NVIDIA Corporation\\Nsight Compute 2022.3.0\\;C:\\Program Files\\nodejs\\;C:\\Program Files\\Tailscale\\;C:\\Users\\tanuj\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\tanuj\\AppData\\Local\\atom\\bin;C:\\Program Files\\heroku\\bin;C:\\Program Files (x86)\\Nmap;C:\\Users\\tanuj\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\tanuj\\.dotnet\\tools;C:\\Users\\tanuj\\anaconda3\\Library\\bin;C:\\Users\\tanuj\\anaconda3\\Scripts;C:\\Users\\tanuj\\anaconda3\\condabin;C:\\Users\\tanuj\\AppData\\Roaming\\npm;C:\\Users\\tanuj\\AppData\\Local\\Programs\\oh-my-posh\\bin;C:\\ffmpeg-2023-05-11-git-ceb050427c-full_build\\bin",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.PY;.PYW",POSH_THEMES_PATH:"C:\\Users\\tanuj\\AppData\\Local\\Programs\\oh-my-posh\\themes",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 165 Stepping 5, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"a505",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Program Files\\WindowsPowerShell\\Modules;C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",SystemDrive:"C:",SystemRoot:"C:\\Windows",TEMP:"C:\\Users\\tanuj\\AppData\\Local\\Temp",TMP:"C:\\Users\\tanuj\\AppData\\Local\\Temp",USERDOMAIN:"TANUJS-PC",USERDOMAIN_ROAMINGPROFILE:"TANUJS-PC",USERNAME:"tanuj",USERPROFILE:"C:\\Users\\tanuj",VBOX_MSI_INSTALL_PATH:"C:\\Program Files\\Oracle\\VirtualBox\\",windir:"C:\\Windows",WSLENV:"WT_SESSION::WT_PROFILE_ID",WT_PROFILE_ID:"{0caa0dad-35be-5f56-a8ff-afceeeaa6101}",WT_SESSION:"d47979e6-8af5-40d1-a7e6-32dae0c3ba1d",ZES_ENABLE_SYSMAN:"1"})||void 0===e?void 0:e.k)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static N(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async $(e){return this.db||(Vu("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new Nl(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new Ku($u.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Ku($u.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Nl(e,r))},r.onupgradeneeded=e=>{Vu("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.V.O(t,r.transaction,e.oldVersion,this.version).next((()=>{Vu("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.F&&(this.db.onversionchange=e=>this.F(e)),this.db}B(e){this.F=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.$(e);const t=Dl.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.P(),e))).catch((e=>(t.abort(e),Al.reject(e)))).toPromise();return s.catch((()=>{})),await t.R,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(Vu("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Pl{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return xl(this.L.delete())}}class Nl extends Ku{constructor(e,t){super($u.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Rl(e){return"IndexedDbTransactionError"===e.name}class Ol{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(Vu("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(Vu("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),xl(n)}add(e){return Vu("SimpleDb","ADD",this.store.name,e,e),xl(this.store.add(e))}get(e){return xl(this.store.get(e)).next((t=>(void 0===t&&(t=null),Vu("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return Vu("SimpleDb","DELETE",this.store.name,e),xl(this.store.delete(e))}count(){return Vu("SimpleDb","COUNT",this.store.name),xl(this.store.count())}j(e,t){const n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){const e=this.cursor(n),t=[];return this.W(e,((e,n)=>{t.push(n)})).next((()=>t))}{const e=this.store.getAll(n.range);return new Al(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}}H(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new Al(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}J(e,t){Vu("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Y=!1;const r=this.cursor(n);return this.W(r,((e,t,n)=>n.delete()))}X(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.W(r,t)}Z(e){const t=this.cursor({});return new Al(((n,r)=>{t.onerror=e=>{const t=Fl(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}W(e,t){const n=[];return new Al(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new Pl(i),o=t(i.primaryKey,i.value,s);if(o instanceof Al){const e=o.catch((e=>(s.done(),Al.reject(e))));n.push(e)}s.isDone?r():null===s.K?i.continue():i.continue(s.K)}})).next((()=>Al.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function xl(e){return new Al(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=Fl(e.target.error);n(t)}}))}let Ll=!1;function Fl(e){const t=kl.S(h());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new Ku("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ll||(Ll=!0,setTimeout((()=>{throw e}),0)),e}}return e}class Ml{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){Vu("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{Vu("IndexBackiller",`Documents written: ${await this.tt.nt()}`)}catch(e){Rl(e)?Vu("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await Sl(e)}await this.et(6e4)}))}}class Ul{constructor(e,t){this.localStore=e,this.persistence=t}async nt(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.st(t,e)))}st(e,t){const n=new Set;let r=t,i=!0;return Al.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return Vu("IndexBackiller",`Processing collection: ${t}`),this.it(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}it(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.rt(r,n))).next((n=>(Vu("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}rt(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=Il(t);Tl(r,n)>0&&(n=r)})),new bl(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Vl{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ut&&this.ut(e),e}}function jl(e){return null==e}function Bl(e){return 0===e&&1/e==-1/0}function ql(e){return"number"==typeof e&&Number.isInteger(e)&&!Bl(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function zl(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Wl(t)),t=Gl(e.get(n),t);return Wl(t)}function Gl(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Wl(e){return e+""}function $l(e){const t=e.length;if(Gu(t>=2),2===t)return Gu(""===e.charAt(0)&&""===e.charAt(1)),hl.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("",s);switch((t<0||t>n)&&zu(),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:zu()}s=t+2}return new hl(r)}Vl.ct=-1;const Kl=["userId","batchId"];function Hl(e,t){return[e,zl(t)]}function Ql(e,t,n){return[e,zl(t),n]}const Jl={},Xl=["prefixPath","collectionGroup","readTime","documentId"],Yl=["prefixPath","collectionGroup","documentId"],Zl=["collectionGroup","readTime","prefixPath","documentId"],eh=["canonicalId","targetId"],th=["targetId","path"],nh=["path","targetId"],rh=["collectionId","parent"],ih=["indexId","uid"],sh=["uid","sequenceNumber"],oh=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ah=["indexId","uid","orderedDocumentKey"],ch=["userId","collectionPath","documentId"],uh=["userId","collectionPath","largestBatchId"],lh=["userId","collectionGroup","largestBatchId"],hh=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],dh=[...hh,"documentOverlays"],fh=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ph=fh,mh=[...ph,"indexConfiguration","indexState","indexEntries"];class gh extends Cl{constructor(e,t){super(),this.ht=e,this.currentSequenceNumber=t}}function yh(e,t){const n=Wu(e);return kl.M(n.ht,t)}function vh(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function wh(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function _h(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Ih{constructor(e,t){this.comparator=e,this.root=t||Th.EMPTY}insert(e,t){return new Ih(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Th.BLACK,null,null))}remove(e){return new Ih(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Th.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new bh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new bh(this.root,e,this.comparator,!1)}getReverseIterator(){return new bh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new bh(this.root,e,this.comparator,!0)}}class bh{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Th{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Th.RED,this.left=null!=r?r:Th.EMPTY,this.right=null!=i?i:Th.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Th(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Th.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Th.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Th.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Th.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw zu();if(this.right.isRed())throw zu();const e=this.left.check();if(e!==this.right.check())throw zu();return e+(this.isRed()?0:1)}}Th.EMPTY=null,Th.RED=!0,Th.BLACK=!1,Th.EMPTY=new class{constructor(){this.size=0}get key(){throw zu()}get value(){throw zu()}get color(){throw zu()}get left(){throw zu()}get right(){throw zu()}copy(e,t,n,r,i){return this}insert(e,t,n){return new Th(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Eh{constructor(e){this.comparator=e,this.data=new Ih(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ch(this.data.getIterator())}getIteratorFrom(e){return new Ch(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Eh))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Eh(this.comparator);return t.data=e,t}}class Ch{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Sh(e){return e.hasNext()?e.getNext():void 0}class Ah{constructor(e){this.fields=e,e.sort(fl.comparator)}static empty(){return new Ah([])}unionWith(e){let t=new Eh(fl.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Ah(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ol(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Dh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class kh{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Dh("Invalid base64 string: "+e):e}}(e);return new kh(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new kh(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return sl(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}kh.EMPTY_BYTE_STRING=new kh("");const Ph=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Nh(e){if(Gu(!!e),"string"==typeof e){let t=0;const n=Ph.exec(e);if(Gu(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Rh(e.seconds),nanos:Rh(e.nanos)}}function Rh(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Oh(e){return"string"==typeof e?kh.fromBase64String(e):kh.fromUint8Array(e)}function xh(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Lh(e){const t=e.mapValue.fields.__previous_value__;return xh(t)?Lh(t):t}function Fh(e){const t=Nh(e.mapValue.fields.__local_write_time__.timestampValue);return new cl(t.seconds,t.nanos)}class Mh{constructor(e,t,n,r,i,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Uh{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Uh("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Uh&&e.projectId===this.projectId&&e.database===this.database}}const Vh={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},jh={nullValue:"NULL_VALUE"};function Bh(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?xh(e)?4:td(e)?9007199254740991:10:zu()}function qh(e,t){if(e===t)return!0;const n=Bh(e);if(n!==Bh(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Fh(e).isEqual(Fh(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Nh(e.timestampValue),r=Nh(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Oh(e.bytesValue).isEqual(Oh(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Rh(e.geoPointValue.latitude)===Rh(t.geoPointValue.latitude)&&Rh(e.geoPointValue.longitude)===Rh(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Rh(e.integerValue)===Rh(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Rh(e.doubleValue),r=Rh(t.doubleValue);return n===r?Bl(n)===Bl(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return ol(e.arrayValue.values||[],t.arrayValue.values||[],qh);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(vh(n)!==vh(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!qh(n[e],r[e])))return!1;return!0}(e,t);default:return zu()}}function zh(e,t){return void 0!==(e.values||[]).find((e=>qh(e,t)))}function Gh(e,t){if(e===t)return 0;const n=Bh(e),r=Bh(t);if(n!==r)return sl(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return sl(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Rh(e.integerValue||e.doubleValue),r=Rh(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Wh(e.timestampValue,t.timestampValue);case 4:return Wh(Fh(e),Fh(t));case 5:return sl(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Oh(e),r=Oh(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=sl(n[e],r[e]);if(0!==t)return t}return sl(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=sl(Rh(e.latitude),Rh(t.latitude));return 0!==n?n:sl(Rh(e.longitude),Rh(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Gh(n[e],r[e]);if(t)return t}return sl(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Vh.mapValue&&t===Vh.mapValue)return 0;if(e===Vh.mapValue)return 1;if(t===Vh.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=sl(r[e],s[e]);if(0!==t)return t;const o=Gh(n[r[e]],i[s[e]]);if(0!==o)return o}return sl(r.length,s.length)}(e.mapValue,t.mapValue);default:throw zu()}}function Wh(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return sl(e,t);const n=Nh(e),r=Nh(t),i=sl(n.seconds,r.seconds);return 0!==i?i:sl(n.nanos,r.nanos)}function $h(e){return Kh(e)}function Kh(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Nh(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Oh(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,pl.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Kh(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Kh(e.fields[i])}`;return n+"}"}(e.mapValue):zu();var t,n}function Hh(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Qh(e){return!!e&&"integerValue"in e}function Jh(e){return!!e&&"arrayValue"in e}function Xh(e){return!!e&&"nullValue"in e}function Yh(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Zh(e){return!!e&&"mapValue"in e}function ed(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return wh(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=ed(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=ed(e.arrayValue.values[n]);return t}return Object.assign({},e)}function td(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function nd(e){return"nullValue"in e?jh:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Hh(Uh.empty(),pl.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:zu()}function rd(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Hh(Uh.empty(),pl.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?Vh:zu()}function id(e,t){const n=Gh(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function sd(e,t){const n=Gh(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class od{constructor(e){this.value=e}static empty(){return new od({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Zh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ed(t)}setAll(e){let t=fl.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=ed(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Zh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return qh(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Zh(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){wh(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new od(ed(this.value))}}function ad(e){const t=[];return wh(e.fields,((e,n)=>{const r=new fl([e]);if(Zh(n)){const e=ad(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new Ah(t)}class cd{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new cd(e,0,ul.min(),ul.min(),ul.min(),od.empty(),0)}static newFoundDocument(e,t,n,r){return new cd(e,1,t,ul.min(),n,r,0)}static newNoDocument(e,t){return new cd(e,2,t,ul.min(),ul.min(),od.empty(),0)}static newUnknownDocument(e,t){return new cd(e,3,t,ul.min(),ul.min(),od.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ul.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=od.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=od.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ul.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof cd&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new cd(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ud{constructor(e,t){this.position=e,this.inclusive=t}}function ld(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?pl.comparator(pl.fromName(o.referenceValue),n.key):Gh(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function hd(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!qh(e.position[n],t.position[n]))return!1;return!0}class dd{constructor(e,t="asc"){this.field=e,this.dir=t}}function fd(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class pd{}class md extends pd{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Cd(e,t,n):"array-contains"===t?new kd(e,n):"in"===t?new Pd(e,n):"not-in"===t?new Nd(e,n):"array-contains-any"===t?new Rd(e,n):new md(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Sd(e,n):new Ad(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Gh(t,this.value)):null!==t&&Bh(this.value)===Bh(t)&&this.matchesComparison(Gh(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return zu()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class gd extends pd{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new gd(e,t)}matches(e){return yd(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft((e=>e.isInequality()));return null!==e?e.field:null}ft(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function yd(e){return"and"===e.op}function vd(e){return"or"===e.op}function wd(e){return _d(e)&&yd(e)}function _d(e){for(const t of e.filters)if(t instanceof gd)return!1;return!0}function Id(e){if(e instanceof md)return e.field.canonicalString()+e.op.toString()+$h(e.value);if(wd(e))return e.filters.map((e=>Id(e))).join(",");{const t=e.filters.map((e=>Id(e))).join(",");return`${e.op}(${t})`}}function bd(e,t){return e instanceof md?function(e,t){return t instanceof md&&e.op===t.op&&e.field.isEqual(t.field)&&qh(e.value,t.value)}(e,t):e instanceof gd?function(e,t){return t instanceof gd&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&bd(n,t.filters[r])),!0)}(e,t):void zu()}function Td(e,t){const n=e.filters.concat(t);return gd.create(n,e.op)}function Ed(e){return e instanceof md?function(e){return`${e.field.canonicalString()} ${e.op} ${$h(e.value)}`}(e):e instanceof gd?function(e){return e.op.toString()+" {"+e.getFilters().map(Ed).join(" ,")+"}"}(e):"Filter"}class Cd extends md{constructor(e,t,n){super(e,t,n),this.key=pl.fromName(n.referenceValue)}matches(e){const t=pl.comparator(e.key,this.key);return this.matchesComparison(t)}}class Sd extends md{constructor(e,t){super(e,"in",t),this.keys=Dd(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Ad extends md{constructor(e,t){super(e,"not-in",t),this.keys=Dd(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Dd(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>pl.fromName(e.referenceValue)))}class kd extends md{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Jh(t)&&zh(t.arrayValue,this.value)}}class Pd extends md{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&zh(this.value.arrayValue,t)}}class Nd extends md{constructor(e,t){super(e,"not-in",t)}matches(e){if(zh(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!zh(this.value.arrayValue,t)}}class Rd extends md{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Jh(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>zh(this.value.arrayValue,e)))}}class Od{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.dt=null}}function xd(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Od(e,t,n,r,i,s,o)}function Ld(e){const t=Wu(e);if(null===t.dt){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>Id(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),jl(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>$h(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>$h(e))).join(",")),t.dt=e}return t.dt}function Fd(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!fd(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!bd(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!hd(e.startAt,t.startAt)&&hd(e.endAt,t.endAt)}function Md(e){return pl.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Ud(e,t){return e.filters.filter((e=>e instanceof md&&e.field.isEqual(t)))}function Vd(e,t,n){let r=jh,i=!0;for(const n of Ud(e,t)){let e=jh,t=!0;switch(n.op){case"<":case"<=":e=nd(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=jh}id({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];id({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function jd(e,t,n){let r=Vh,i=!0;for(const n of Ud(e,t)){let e=Vh,t=!0;switch(n.op){case">=":case">":e=rd(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=Vh}sd({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];sd({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class Bd{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function qd(e,t,n,r,i,s,o,a){return new Bd(e,t,n,r,i,s,o,a)}function zd(e){return new Bd(e)}function Gd(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Wd(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function $d(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function Kd(e){return null!==e.collectionGroup}function Hd(e){const t=Wu(e);if(null===t.wt){t.wt=[];const e=$d(t),n=Wd(t);if(null!==e&&null===n)e.isKeyField()||t.wt.push(new dd(e)),t.wt.push(new dd(fl.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.wt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.wt.push(new dd(fl.keyField(),e))}}}return t.wt}function Qd(e){const t=Wu(e);if(!t._t)if("F"===t.limitType)t._t=xd(t.path,t.collectionGroup,Hd(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of Hd(t)){const t="desc"===n.dir?"asc":"desc";e.push(new dd(n.field,t))}const n=t.endAt?new ud(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new ud(t.startAt.position,t.startAt.inclusive):null;t._t=xd(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t._t}function Jd(e,t){t.getFirstInequalityField(),$d(e);const n=e.filters.concat([t]);return new Bd(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Xd(e,t,n){return new Bd(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Yd(e,t){return Fd(Qd(e),Qd(t))&&e.limitType===t.limitType}function Zd(e){return`${Ld(Qd(e))}|lt:${e.limitType}`}function ef(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>Ed(e))).join(", ")}]`),jl(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>$h(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>$h(e))).join(",")),`Target(${t})`}(Qd(e))}; limitType=${e.limitType})`}function tf(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):pl.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Hd(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=ld(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Hd(e),t)||e.endAt&&!function(e,t,n){const r=ld(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Hd(e),t))}(e,t)}function nf(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function rf(e){return(t,n)=>{let r=!1;for(const i of Hd(e)){const e=sf(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function sf(e,t,n){const r=e.field.isKeyField()?pl.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Gh(r,i):zu()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return zu()}}class of{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){wh(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return _h(this.inner)}size(){return this.innerSize}}const af=new Ih(pl.comparator);function cf(){return af}const uf=new Ih(pl.comparator);function lf(...e){let t=uf;for(const n of e)t=t.insert(n.key,n);return t}function hf(e){let t=uf;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function df(){return pf()}function ff(){return pf()}function pf(){return new of((e=>e.toString()),((e,t)=>e.isEqual(t)))}const mf=new Ih(pl.comparator),gf=new Eh(pl.comparator);function yf(...e){let t=gf;for(const n of e)t=t.add(n);return t}const vf=new Eh(sl);function wf(){return vf}function _f(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Bl(t)?"-0":t}}function If(e){return{integerValue:""+e}}function bf(e,t){return ql(t)?If(t):_f(e,t)}class Tf{constructor(){this._=void 0}}function Ef(e,t,n){return e instanceof Af?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&xh(t)&&(t=Lh(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Df?kf(e,t):e instanceof Pf?Nf(e,t):function(e,t){const n=Sf(e,t),r=Of(n)+Of(e.gt);return Qh(n)&&Qh(e.gt)?If(r):_f(e.serializer,r)}(e,t)}function Cf(e,t,n){return e instanceof Df?kf(e,t):e instanceof Pf?Nf(e,t):n}function Sf(e,t){return e instanceof Rf?Qh(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class Af extends Tf{}class Df extends Tf{constructor(e){super(),this.elements=e}}function kf(e,t){const n=xf(t);for(const t of e.elements)n.some((e=>qh(e,t)))||n.push(t);return{arrayValue:{values:n}}}class Pf extends Tf{constructor(e){super(),this.elements=e}}function Nf(e,t){let n=xf(t);for(const t of e.elements)n=n.filter((e=>!qh(e,t)));return{arrayValue:{values:n}}}class Rf extends Tf{constructor(e,t){super(),this.serializer=e,this.gt=t}}function Of(e){return Rh(e.integerValue||e.doubleValue)}function xf(e){return Jh(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Lf{constructor(e,t){this.field=e,this.transform=t}}class Ff{constructor(e,t){this.version=e,this.transformResults=t}}class Mf{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Mf}static exists(e){return new Mf(void 0,e)}static updateTime(e){return new Mf(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Uf(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Vf{}function jf(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Jf(e.key,Mf.none()):new Wf(e.key,e.data,Mf.none());{const n=e.data,r=od.empty();let i=new Eh(fl.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new $f(e.key,r,new Ah(i.toArray()),Mf.none())}}function Bf(e,t,n){e instanceof Wf?function(e,t,n){const r=e.value.clone(),i=Hf(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof $f?function(e,t,n){if(!Uf(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Hf(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Kf(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function qf(e,t,n,r){return e instanceof Wf?function(e,t,n,r){if(!Uf(e.precondition,t))return n;const i=e.value.clone(),s=Qf(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof $f?function(e,t,n,r){if(!Uf(e.precondition,t))return n;const i=Qf(e.fieldTransforms,r,t),s=t.data;return s.setAll(Kf(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Uf(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function zf(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Sf(r.transform,e||null);null!=i&&(null===n&&(n=od.empty()),n.set(r.field,i))}return n||null}function Gf(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&ol(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Df&&t instanceof Df||e instanceof Pf&&t instanceof Pf?ol(e.elements,t.elements,qh):e instanceof Rf&&t instanceof Rf?qh(e.gt,t.gt):e instanceof Af&&t instanceof Af}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Wf extends Vf{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class $f extends Vf{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Kf(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Hf(e,t,n){const r=new Map;Gu(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Cf(o,a,n[i]))}return r}function Qf(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Ef(e,s,t))}return r}class Jf extends Vf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Xf extends Vf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Yf{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Bf(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=qf(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=qf(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=ff();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=jf(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(ul.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),yf())}isEqual(e){return this.batchId===e.batchId&&ol(this.mutations,e.mutations,((e,t)=>Gf(e,t)))&&ol(this.baseMutations,e.baseMutations,((e,t)=>Gf(e,t)))}}class Zf{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Gu(e.mutations.length===n.length);let r=mf;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Zf(e,t,n,r)}}class ep{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class tp{constructor(e,t){this.count=e,this.unchangedNames=t}}var np,rp;function ip(e){switch(e){default:return zu();case $u.CANCELLED:case $u.UNKNOWN:case $u.DEADLINE_EXCEEDED:case $u.RESOURCE_EXHAUSTED:case $u.INTERNAL:case $u.UNAVAILABLE:case $u.UNAUTHENTICATED:return!1;case $u.INVALID_ARGUMENT:case $u.NOT_FOUND:case $u.ALREADY_EXISTS:case $u.PERMISSION_DENIED:case $u.FAILED_PRECONDITION:case $u.ABORTED:case $u.OUT_OF_RANGE:case $u.UNIMPLEMENTED:case $u.DATA_LOSS:return!0}}function sp(e){if(void 0===e)return ju("GRPC error has no .code"),$u.UNKNOWN;switch(e){case np.OK:return $u.OK;case np.CANCELLED:return $u.CANCELLED;case np.UNKNOWN:return $u.UNKNOWN;case np.DEADLINE_EXCEEDED:return $u.DEADLINE_EXCEEDED;case np.RESOURCE_EXHAUSTED:return $u.RESOURCE_EXHAUSTED;case np.INTERNAL:return $u.INTERNAL;case np.UNAVAILABLE:return $u.UNAVAILABLE;case np.UNAUTHENTICATED:return $u.UNAUTHENTICATED;case np.INVALID_ARGUMENT:return $u.INVALID_ARGUMENT;case np.NOT_FOUND:return $u.NOT_FOUND;case np.ALREADY_EXISTS:return $u.ALREADY_EXISTS;case np.PERMISSION_DENIED:return $u.PERMISSION_DENIED;case np.FAILED_PRECONDITION:return $u.FAILED_PRECONDITION;case np.ABORTED:return $u.ABORTED;case np.OUT_OF_RANGE:return $u.OUT_OF_RANGE;case np.UNIMPLEMENTED:return $u.UNIMPLEMENTED;case np.DATA_LOSS:return $u.DATA_LOSS;default:return zu()}}(rp=np||(np={}))[rp.OK=0]="OK",rp[rp.CANCELLED=1]="CANCELLED",rp[rp.UNKNOWN=2]="UNKNOWN",rp[rp.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",rp[rp.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",rp[rp.NOT_FOUND=5]="NOT_FOUND",rp[rp.ALREADY_EXISTS=6]="ALREADY_EXISTS",rp[rp.PERMISSION_DENIED=7]="PERMISSION_DENIED",rp[rp.UNAUTHENTICATED=16]="UNAUTHENTICATED",rp[rp.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",rp[rp.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",rp[rp.ABORTED=10]="ABORTED",rp[rp.OUT_OF_RANGE=11]="OUT_OF_RANGE",rp[rp.UNIMPLEMENTED=12]="UNIMPLEMENTED",rp[rp.INTERNAL=13]="INTERNAL",rp[rp.UNAVAILABLE=14]="UNAVAILABLE",rp[rp.DATA_LOSS=15]="DATA_LOSS";class op{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return ap}static getOrCreateInstance(){return null===ap&&(ap=new op),ap}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach((t=>t(e)))}}let ap=null;function cp(){return new TextEncoder}const up=new Ou([4294967295,4294967295],0);function lp(e){const t=cp().encode(e),n=new Ru;return n.update(t),new Uint8Array(n.digest())}function hp(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Ou([n,r],0),new Ou([i,s],0)]}class dp{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new fp(`Invalid padding: ${t}`);if(n<0)throw new fp(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new fp(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new fp(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=Ou.fromNumber(this.It)}Et(e,t,n){let r=e.add(t.multiply(Ou.fromNumber(n)));return 1===r.compare(up)&&(r=new Ou([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Tt).toNumber()}At(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;const t=lp(e),[n,r]=hp(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,r,e);if(!this.At(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new dp(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.It)return;const t=lp(e),[n,r]=hp(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,r,e);this.Rt(t)}}Rt(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class fp extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class pp{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,mp.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new pp(ul.min(),r,new Ih(sl),cf(),yf())}}class mp{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new mp(n,t,yf(),yf(),yf())}}class gp{constructor(e,t,n,r){this.Pt=e,this.removedTargetIds=t,this.key=n,this.bt=r}}class yp{constructor(e,t){this.targetId=e,this.Vt=t}}class vp{constructor(e,t,n=kh.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class wp{constructor(){this.St=0,this.Dt=bp(),this.Ct=kh.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=yf(),t=yf(),n=yf();return this.Dt.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:zu()}})),new mp(this.Ct,this.xt,e,t,n)}Ft(){this.Nt=!1,this.Dt=bp()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class _p{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=cf(),this.zt=Ip(),this.Wt=new Ih(sl)}Ht(e){for(const t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(const t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,(t=>{const n=this.Zt(t);switch(e.state){case 0:this.te(t)&&n.$t(e.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(e.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(t);break;case 3:this.te(t)&&(n.Kt(),n.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),n.$t(e.resumeToken));break;default:zu()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach(((e,n)=>{this.te(n)&&t(n)}))}ne(e){var t;const n=e.targetId,r=e.Vt.count,i=this.se(n);if(i){const s=i.target;if(Md(s))if(0===r){const e=new pl(s.path);this.Yt(n,e,cd.newNoDocument(e,ul.min()))}else Gu(1===r);else{const i=this.ie(n);if(i!==r){const r=this.re(e,i);if(0!==r){this.ee(n);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,e)}null===(t=op.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(e,t,n){var r,i,s,o,a,c;const u={localCacheCount:t,existenceFilterCount:n.count},l=n.unchangedNames;return l&&(u.bloomFilter={applied:0===e,hashCount:null!==(r=null==l?void 0:l.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(o=null===(s=null===(i=null==l?void 0:l.bits)||void 0===i?void 0:i.bitmap)||void 0===s?void 0:s.length)&&void 0!==o?o:0,padding:null!==(c=null===(a=null==l?void 0:l.bits)||void 0===a?void 0:a.padding)&&void 0!==c?c:0}),u}(r,i,e.Vt))}}}}re(e,t){const{unchangedNames:n,count:r}=e.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:i="",padding:s=0},hashCount:o=0}=n;let a,c;try{a=Oh(i).toUint8Array()}catch(e){if(e instanceof Dh)return Bu("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{c=new dp(a,s,o)}catch(e){return Bu(e instanceof fp?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===c.It?1:r!==t-this.oe(e.targetId,c)?2:0}oe(e,t){const n=this.Gt.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.Gt.ue(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.vt(s)||(this.Yt(e,n,null),r++)})),r}ce(e){const t=new Map;this.Qt.forEach(((n,r)=>{const i=this.se(r);if(i){if(n.current&&Md(i.target)){const t=new pl(i.target.path);null!==this.jt.get(t)||this.ae(r,t)||this.Yt(r,t,cd.newNoDocument(t,e))}n.Mt&&(t.set(r,n.Ot()),n.Ft())}}));let n=yf();this.zt.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.se(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.jt.forEach(((t,n)=>n.setReadTime(e)));const r=new pp(e,t,this.Wt,this.jt,n);return this.jt=cf(),this.zt=Ip(),this.Wt=new Ih(sl),r}Jt(e,t){if(!this.te(e))return;const n=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,n),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,n){if(!this.te(e))return;const r=this.Zt(e);this.ae(e,t)?r.Bt(t,1):r.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),n&&(this.jt=this.jt.insert(t,n))}removeTarget(e){this.Qt.delete(e)}ie(e){const t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new wp,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new Eh(sl),this.zt=this.zt.insert(e,t)),t}te(e){const t=null!==this.se(e);return t||Vu("WatchChangeAggregator","Detected inactive target",e),t}se(e){const t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new wp),this.Gt.getRemoteKeysForTarget(e).forEach((t=>{this.Yt(e,t,null)}))}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function Ip(){return new Ih(pl.comparator)}function bp(){return new Ih(pl.comparator)}const Tp={asc:"ASCENDING",desc:"DESCENDING"},Ep={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Cp={and:"AND",or:"OR"};class Sp{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ap(e,t){return e.useProto3Json||jl(t)?t:{value:t}}function Dp(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function kp(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Pp(e,t){return Dp(e,t.toTimestamp())}function Np(e){return Gu(!!e),ul.fromTimestamp(function(e){const t=Nh(e);return new cl(t.seconds,t.nanos)}(e))}function Rp(e,t){return function(e){return new hl(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Op(e){const t=hl.fromString(e);return Gu(tm(t)),t}function xp(e,t){return Rp(e.databaseId,t.path)}function Lp(e,t){const n=Op(t);if(n.get(1)!==e.databaseId.projectId)throw new Ku($u.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Ku($u.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new pl(Vp(n))}function Fp(e,t){return Rp(e.databaseId,t)}function Mp(e){const t=Op(e);return 4===t.length?hl.emptyPath():Vp(t)}function Up(e){return new hl(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Vp(e){return Gu(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function jp(e,t,n){return{name:xp(e,t),fields:n.value.mapValue.fields}}function Bp(e,t,n){const r=Lp(e,t.name),i=Np(t.updateTime),s=t.createTime?Np(t.createTime):ul.min(),o=new od({mapValue:{fields:t.fields}}),a=cd.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function qp(e,t){let n;if(t instanceof Wf)n={update:jp(e,t.key,t.value)};else if(t instanceof Jf)n={delete:xp(e,t.key)};else if(t instanceof $f)n={update:jp(e,t.key,t.data),updateMask:em(t.fieldMask)};else{if(!(t instanceof Xf))return zu();n={verify:xp(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Af)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Df)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Pf)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Rf)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw zu()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Pp(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:zu()}(e,t.precondition)),n}function zp(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Mf.updateTime(Np(e.updateTime)):void 0!==e.exists?Mf.exists(e.exists):Mf.none()}(t.currentDocument):Mf.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)Gu("REQUEST_TIME"===t.setToServerValue),n=new Af;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Df(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Pf(e)}else"increment"in t?n=new Rf(e,t.increment):zu();const r=fl.fromServerFormat(t.fieldPath);return new Lf(r,n)}(e,t))):[];if(t.update){t.update.name;const i=Lp(e,t.update.name),s=new od({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new Ah(t.map((e=>fl.fromServerFormat(e))))}(t.updateMask);return new $f(i,s,e,n,r)}return new Wf(i,s,n,r)}if(t.delete){const r=Lp(e,t.delete);return new Jf(r,n)}if(t.verify){const r=Lp(e,t.verify);return new Xf(r,n)}return zu()}function Gp(e,t){return{documents:[Fp(e,t.path)]}}function Wp(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Fp(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Fp(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0!==e.length)return Zp(gd.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Xp(e.field),direction:Hp(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=Ap(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function $p(e){let t=Mp(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Gu(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Kp(e);return t instanceof gd&&wd(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new dd(Yp(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,jl(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new ud(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new ud(n,t)}(n.endAt)),qd(t,i,o,s,a,"F",c,u)}function Kp(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Yp(e.unaryFilter.field);return md.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Yp(e.unaryFilter.field);return md.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Yp(e.unaryFilter.field);return md.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Yp(e.unaryFilter.field);return md.create(i,"!=",{nullValue:"NULL_VALUE"});default:return zu()}}(e):void 0!==e.fieldFilter?function(e){return md.create(Yp(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return zu()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return gd.create(e.compositeFilter.filters.map((e=>Kp(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return zu()}}(e.compositeFilter.op))}(e):zu()}function Hp(e){return Tp[e]}function Qp(e){return Ep[e]}function Jp(e){return Cp[e]}function Xp(e){return{fieldPath:e.canonicalString()}}function Yp(e){return fl.fromServerFormat(e.fieldPath)}function Zp(e){return e instanceof md?function(e){if("=="===e.op){if(Yh(e.value))return{unaryFilter:{field:Xp(e.field),op:"IS_NAN"}};if(Xh(e.value))return{unaryFilter:{field:Xp(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Yh(e.value))return{unaryFilter:{field:Xp(e.field),op:"IS_NOT_NAN"}};if(Xh(e.value))return{unaryFilter:{field:Xp(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xp(e.field),op:Qp(e.op),value:e.value}}}(e):e instanceof gd?function(e){const t=e.getFilters().map((e=>Zp(e)));return 1===t.length?t[0]:{compositeFilter:{op:Jp(e.op),filters:t}}}(e):zu()}function em(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function tm(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class nm{constructor(e,t,n,r,i=ul.min(),s=ul.min(),o=kh.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new nm(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new nm(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new nm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new nm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class rm{constructor(e){this.fe=e}}function im(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:sm(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:xp(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Dp(e,t.version.toTimestamp()),createTime:Dp(e,t.createTime.toTimestamp())}}(e.fe,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:om(t.version)};else{if(!t.isUnknownDocument())return zu();r.unknownDocument={path:n.path.toArray(),version:om(t.version)}}return r}function sm(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function om(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function am(e){const t=new cl(e.seconds,e.nanoseconds);return ul.fromTimestamp(t)}function cm(e,t){const n=(t.baseMutations||[]).map((t=>zp(e.fe,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>zp(e.fe,t))),i=cl.fromMillis(t.localWriteTimeMs);return new Yf(t.batchId,i,n,r)}function um(e){const t=am(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?am(e.lastLimboFreeSnapshotVersion):ul.min();let r;var i;return void 0!==e.query.documents?(Gu(1===(i=e.query).documents.length),r=Qd(zd(Mp(i.documents[0])))):r=function(e){return Qd($p(e))}(e.query),new nm(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,kh.fromBase64String(e.resumeToken))}function lm(e,t){const n=om(t.snapshotVersion),r=om(t.lastLimboFreeSnapshotVersion);let i;i=Md(t.target)?Gp(e.fe,t.target):Wp(e.fe,t.target);const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Ld(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function hm(e){const t=$p({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Xd(t,t.limit,"L"):t}function dm(e,t){return new ep(t.largestBatchId,zp(e.fe,t.overlayMutation))}function fm(e,t){const n=t.path.lastSegment();return[e,zl(t.path.popLast()),n]}function pm(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:om(r.readTime),documentKey:zl(r.documentKey.path),largestBatchId:r.largestBatchId}}class mm{getBundleMetadata(e,t){return gm(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:am(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return gm(e).put({bundleId:(n=t).id,createTime:om(Np(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return ym(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:hm(t.bundledQuery),readTime:am(t.readTime)};var t}))}saveNamedQuery(e,t){return ym(e).put(function(e){return{name:e.name,readTime:om(Np(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function gm(e){return yh(e,"bundles")}function ym(e){return yh(e,"namedQueries")}class vm{constructor(e,t){this.serializer=e,this.userId=t}static de(e,t){const n=t.uid||"";return new vm(e,n)}getOverlay(e,t){return wm(e).get(fm(this.userId,t)).next((e=>e?dm(this.serializer,e):null))}getOverlays(e,t){const n=df();return Al.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new ep(t,i);r.push(this.we(e,s))})),Al.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(zl(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(wm(e).J("collectionPathOverlayIndex",r))})),Al.waitFor(i)}getOverlaysForCollection(e,t,n){const r=df(),i=zl(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return wm(e).j("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=dm(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=df();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return wm(e).X({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=dm(this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}we(e,t){return wm(e).put(function(e,t,n){const[r,i,s]=fm(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:qp(e.fe,n.mutation)}}(this.serializer,this.userId,t))}}function wm(e){return yh(e,"documentOverlays")}class _m{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(Rh(e.integerValue));else if("doubleValue"in e){const n=Rh(e.doubleValue);isNaN(n)?this.ye(t,13):(this.ye(t,15),Bl(n)?t.pe(0):t.pe(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ye(t,20),"string"==typeof n?t.Ie(n):(t.Ie(`${n.seconds||""}`),t.pe(n.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(Oh(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ye(t,45),t.pe(n.latitude||0),t.pe(n.longitude||0)}else"mapValue"in e?td(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):zu()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){const n=e.fields||{};this.ye(t,55);for(const e of Object.keys(n))this.Te(e,t),this.me(n[e],t)}Pe(e,t){const n=e.values||[];this.ye(t,50);for(const e of n)this.me(e,t)}ve(e,t){this.ye(t,37),pl.fromName(e).path.forEach((e=>{this.ye(t,60),this.be(e,t)}))}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}function Im(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function bm(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=Im(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}_m.Ve=new _m;class Tm{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Se(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.De(n.value),n=t.next();this.Ce()}xe(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ne(n.value),n=t.next();this.ke()}Me(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.De(e);else if(e<2048)this.De(960|e>>>6),this.De(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.De(480|e>>>12),this.De(128|63&e>>>6),this.De(128|63&e);else{const e=t.codePointAt(0);this.De(240|e>>>18),this.De(128|63&e>>>12),this.De(128|63&e>>>6),this.De(128|63&e)}}this.Ce()}$e(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ne(e);else if(e<2048)this.Ne(960|e>>>6),this.Ne(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ne(480|e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e);else{const e=t.codePointAt(0);this.Ne(240|e>>>18),this.Ne(128|63&e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e)}}this.ke()}Oe(e){const t=this.Fe(e),n=bm(t);this.Be(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Le(e){const t=this.Fe(e),n=bm(t);this.Be(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}qe(){this.Ue(255),this.Ue(255)}Ke(){this.Ge(255),this.Ge(255)}reset(){this.position=0}seed(e){this.Be(e.length),this.buffer.set(e,this.position),this.position+=e.length}Qe(){return this.buffer.slice(0,this.position)}Fe(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}De(e){const t=255&e;0===t?(this.Ue(0),this.Ue(255)):255===t?(this.Ue(255),this.Ue(0)):this.Ue(t)}Ne(e){const t=255&e;0===t?(this.Ge(0),this.Ge(255)):255===t?(this.Ge(255),this.Ge(0)):this.Ge(e)}Ce(){this.Ue(0),this.Ue(1)}ke(){this.Ge(0),this.Ge(1)}Ue(e){this.Be(1),this.buffer[this.position++]=e}Ge(e){this.Be(1),this.buffer[this.position++]=~e}Be(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class Em{constructor(e){this.je=e}Ae(e){this.je.Se(e)}Ie(e){this.je.Me(e)}pe(e){this.je.Oe(e)}ge(){this.je.qe()}}class Cm{constructor(e){this.je=e}Ae(e){this.je.xe(e)}Ie(e){this.je.$e(e)}pe(e){this.je.Le(e)}ge(){this.je.Ke()}}class Sm{constructor(){this.je=new Tm,this.ze=new Em(this.je),this.We=new Cm(this.je)}seed(e){this.je.seed(e)}He(e){return 0===e?this.ze:this.We}Qe(){return this.je.Qe()}reset(){this.je.reset()}}class Am{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Je(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new Am(this.indexId,this.documentKey,this.arrayValue,n)}}function Dm(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=km(e.arrayValue,t.arrayValue),0!==n?n:(n=km(e.directionalValue,t.directionalValue),0!==n?n:pl.comparator(e.documentKey,t.documentKey)))}function km(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class Pm{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ye=e.orderBy,this.Xe=[];for(const t of e.filters){const e=t;e.isInequality()?this.Ze=e:this.Xe.push(e)}}tn(e){Gu(e.collectionGroup===this.collectionId);const t=gl(e);if(void 0!==t&&!this.en(t))return!1;const n=yl(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.en(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(void 0!==this.Ze){if(!r.has(this.Ze.field.canonicalString())){const e=n[i];if(!this.nn(this.Ze,e)||!this.sn(this.Ye[s++],e))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.Ye.length||!this.sn(this.Ye[s++],e))return!1}return!0}en(e){for(const t of this.Xe)if(this.nn(t,e))return!0;return!1}nn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Nm(e){var t,n;if(Gu(e instanceof md||e instanceof gd),e instanceof md){if(e instanceof Pd){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>md.create(e.field,"==",t))))||[];return gd.create(r,"or")}return e}const r=e.filters.map((e=>Nm(e)));return gd.create(r,e.op)}function Rm(e){if(0===e.getFilters().length)return[];const t=Fm(Nm(e));return Gu(Lm(t)),Om(t)||xm(t)?[t]:t.getFilters()}function Om(e){return e instanceof md}function xm(e){return e instanceof gd&&wd(e)}function Lm(e){return Om(e)||xm(e)||function(e){if(e instanceof gd&&vd(e)){for(const t of e.getFilters())if(!Om(t)&&!xm(t))return!1;return!0}return!1}(e)}function Fm(e){if(Gu(e instanceof md||e instanceof gd),e instanceof md)return e;if(1===e.filters.length)return Fm(e.filters[0]);const t=e.filters.map((e=>Fm(e)));let n=gd.create(t,e.op);return n=Vm(n),Lm(n)?n:(Gu(n instanceof gd),Gu(yd(n)),Gu(n.filters.length>1),n.filters.reduce(((e,t)=>Mm(e,t))))}function Mm(e,t){let n;return Gu(e instanceof md||e instanceof gd),Gu(t instanceof md||t instanceof gd),n=e instanceof md?t instanceof md?function(e,t){return gd.create([e,t],"and")}(e,t):Um(e,t):t instanceof md?Um(t,e):function(e,t){if(Gu(e.filters.length>0&&t.filters.length>0),yd(e)&&yd(t))return Td(e,t.getFilters());const n=vd(e)?e:t,r=vd(e)?t:e,i=n.filters.map((e=>Mm(e,r)));return gd.create(i,"or")}(e,t),Vm(n)}function Um(e,t){if(yd(t))return Td(t,e.getFilters());{const n=t.filters.map((t=>Mm(e,t)));return gd.create(n,"or")}}function Vm(e){if(Gu(e instanceof md||e instanceof gd),e instanceof md)return e;const t=e.getFilters();if(1===t.length)return Vm(t[0]);if(_d(e))return e;const n=t.map((e=>Vm(e))),r=[];return n.forEach((t=>{t instanceof md?r.push(t):t instanceof gd&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:gd.create(r,e.op)}class jm{constructor(){this.rn=new Bm}addToCollectionParentIndex(e,t){return this.rn.add(t),Al.resolve()}getCollectionParents(e,t){return Al.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return Al.resolve()}deleteFieldIndex(e,t){return Al.resolve()}getDocumentsMatchingTarget(e,t){return Al.resolve(null)}getIndexType(e,t){return Al.resolve(0)}getFieldIndexes(e,t){return Al.resolve([])}getNextCollectionGroupToUpdate(e){return Al.resolve(null)}getMinOffset(e,t){return Al.resolve(bl.min())}getMinOffsetFromCollectionGroup(e,t){return Al.resolve(bl.min())}updateCollectionGroup(e,t,n){return Al.resolve()}updateIndexEntries(e,t){return Al.resolve()}}class Bm{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Eh(hl.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Eh(hl.comparator)).toArray()}}const qm=new Uint8Array(0);class zm{constructor(e,t){this.user=e,this.databaseId=t,this.on=new Bm,this.un=new of((e=>Ld(e)),((e,t)=>Fd(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.on.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.on.add(t)}));const i={collectionId:n,parent:zl(r)};return Gm(e).put(i)}return Al.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[al(t),""],!1,!0);return Gm(e).j(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push($l(r.parent))}return n}))}addFieldIndex(e,t){const n=$m(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=Km(e);return i.next((e=>{n.put(pm(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=$m(e),r=Km(e),i=Wm(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}getDocumentsMatchingTarget(e,t){const n=Wm(e);let r=!0;const i=new Map;return Al.forEach(this.cn(t),(t=>this.an(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=yf();const r=[];return Al.forEach(i,((i,s)=>{var o;Vu("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`} to execute ${Ld(t)}`);const a=function(e,t){const n=gl(t);if(void 0===n)return null;for(const t of Ud(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),c=function(e,t){const n=new Map;for(const r of yl(t))for(const t of Ud(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of yl(t)){const t=0===i.kind?Vd(e,i.fieldPath,e.startAt):jd(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new ud(n,r)}(s,i),l=function(e,t){const n=[];let r=!0;for(const i of yl(t)){const t=0===i.kind?jd(e,i.fieldPath,e.endAt):Vd(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new ud(n,r)}(s,i),h=this.hn(i,s,u),d=this.hn(i,s,l),f=this.ln(i,s,c),p=this.fn(i.indexId,a,h,u.inclusive,d,l.inclusive,f);return Al.forEach(p,(i=>n.H(i,t.limit).next((t=>{t.forEach((t=>{const n=pl.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return Al.resolve(null)}))}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:Rm(gd.create(e.filters,"and")).map((t=>xd(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.un.set(e,t),t)}fn(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.dn(t[l/c]):qm,h=this.wn(e,a,n[l%c],r),d=this._n(e,a,i[l%c],s),f=o.map((t=>this.wn(e,a,t,!0)));u.push(...this.createRange(h,d,f))}return u}wn(e,t,n,r){const i=new Am(e,pl.empty(),t,n);return r?i:i.Je()}_n(e,t,n,r){const i=new Am(e,pl.empty(),t,n);return r?i.Je():i}an(e,t){const n=new Pm(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.cn(t);return Al.forEach(r,(t=>this.an(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new Eh(fl.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}mn(e,t){const n=new Sm;for(const r of yl(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.He(r.kind);_m.Ve._e(e,i)}return n.Qe()}dn(e){const t=new Sm;return _m.Ve._e(e,t.He(0)),t.Qe()}gn(e,t){const n=new Sm;return _m.Ve._e(Hh(this.databaseId,t),n.He(function(e){const t=yl(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Qe()}ln(e,t,n){if(null===n)return[];let r=[];r.push(new Sm);let i=0;for(const s of yl(e)){const e=n[i++];for(const n of r)if(this.yn(t,s.fieldPath)&&Jh(e))r=this.pn(r,s,e);else{const t=n.He(s.kind);_m.Ve._e(e,t)}}return this.In(r)}hn(e,t,n){return this.ln(e,t,n.position)}In(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Qe();return t}pn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new Sm;r.seed(n.Qe()),_m.Ve._e(e,r.He(t.kind)),i.push(r)}return i}yn(e,t){return!!e.filters.find((e=>e instanceof md&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=$m(e),r=Km(e);return(t?n.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.j()).next((e=>{const t=[];return Al.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new wl(t.sequenceNumber,new bl(am(t.readTime),new pl($l(t.documentKey)),t.largestBatchId)):wl.empty(),r=e.fields.map((([e,t])=>new vl(fl.fromServerFormat(e),t)));return new ml(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:sl(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=$m(e),i=Km(e);return this.Tn(e).next((e=>r.j("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>Al.forEach(t,(t=>i.put(pm(t.indexId,this.user,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return Al.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?Al.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),Al.forEach(i,(n=>this.En(e,t,n).next((t=>{const i=this.An(r,n);return t.isEqual(i)?Al.resolve():this.vn(e,r,n,t,i)})))))))}))}Rn(e,t,n,r){return Wm(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.gn(n,t.key),documentKey:t.key.path.toArray()})}Pn(e,t,n,r){return Wm(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.gn(n,t.key),t.key.path.toArray()])}En(e,t,n){const r=Wm(e);let i=new Eh(Dm);return r.X({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.gn(n,t)])},((e,r)=>{i=i.add(new Am(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}An(e,t){let n=new Eh(Dm);const r=this.mn(t,e);if(null==r)return n;const i=gl(t);if(null!=i){const s=e.data.field(i.fieldPath);if(Jh(s))for(const i of s.arrayValue.values||[])n=n.add(new Am(t.indexId,e.key,this.dn(i),r))}else n=n.add(new Am(t.indexId,e.key,qm,r));return n}vn(e,t,n,r,i){Vu("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=Sh(s),c=Sh(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=Sh(o)):t?(i(a),a=Sh(s)):(a=Sh(s),c=Sh(o))}}(r,i,Dm,(r=>{s.push(this.Rn(e,t,n,r))}),(r=>{s.push(this.Pn(e,t,n,r))})),Al.waitFor(s)}Tn(e){let t=1;return Km(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>Dm(e,t))).filter(((e,t,n)=>!t||0!==Dm(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=Dm(i,e),s=Dm(i,t);if(0===n)r[0]=e.Je();else if(n>0&&s<0)r.push(i),r.push(i.Je());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.bn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,qm,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,qm,[]];i.push(IDBKeyRange.bound(t,n))}return i}bn(e,t){return Dm(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Hm)}getMinOffset(e,t){return Al.mapArray(this.cn(t),(t=>this.an(e,t).next((e=>e||zu())))).next(Hm)}}function Gm(e){return yh(e,"collectionParents")}function Wm(e){return yh(e,"indexEntries")}function $m(e){return yh(e,"indexConfiguration")}function Km(e){return yh(e,"indexState")}function Hm(e){Gu(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;Tl(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new bl(t.readTime,t.documentKey,n)}const Qm={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Jm{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Jm(e,Jm.DEFAULT_COLLECTION_PERCENTILE,Jm.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Xm(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.X({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{Gu(1===a)})));const u=[];for(const e of n.mutations){const r=Ql(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return Al.waitFor(s).next((()=>u))}function Ym(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw zu();t=e.noDocument}return JSON.stringify(t).length}Jm.DEFAULT_COLLECTION_PERCENTILE=10,Jm.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Jm.DEFAULT=new Jm(41943040,Jm.DEFAULT_COLLECTION_PERCENTILE,Jm.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Jm.DISABLED=new Jm(-1,0,0);class Zm{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Vn={}}static de(e,t,n,r){Gu(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Zm(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return tg(e).X({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=ng(e),s=tg(e);return s.add({}).next((o=>{Gu("number"==typeof o);const a=new Yf(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>qp(e.fe,t))),i=n.mutations.map((t=>qp(e.fe,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,a),u=[];let l=new Eh(((e,t)=>sl(e.canonicalString(),t.canonicalString())));for(const e of r){const t=Ql(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,Jl))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Vn[o]=a.keys()})),Al.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return tg(e).get(t).next((e=>e?(Gu(e.userId===this.userId),cm(this.serializer,e)):null))}Sn(e,t){return this.Vn[t]?Al.resolve(this.Vn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Vn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return tg(e).X({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(Gu(t.batchId>=n),i=cm(this.serializer,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return tg(e).X({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return tg(e).j("userMutationsIndex",t).next((e=>e.map((e=>cm(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Hl(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return ng(e).X({range:r},((n,r,s)=>{const[o,a,c]=n,u=$l(a);if(o===this.userId&&t.path.isEqual(u))return tg(e).get(c).next((e=>{if(!e)throw zu();Gu(e.userId===this.userId),i.push(cm(this.serializer,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Eh(sl);const r=[];return t.forEach((t=>{const i=Hl(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=ng(e).X({range:s},((e,r,i)=>{const[s,o,a]=e,c=$l(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),Al.waitFor(r).next((()=>this.Dn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=Hl(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new Eh(sl);return ng(e).X({range:s},((e,t,i)=>{const[s,a,c]=e,u=$l(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.Dn(e,o)))}Dn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(tg(e).get(t).next((e=>{if(null===e)throw zu();Gu(e.userId===this.userId),n.push(cm(this.serializer,e))})))})),Al.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return Xm(e.ht,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.Cn(t.batchId)})),Al.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}Cn(e){delete this.Vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return Al.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return ng(e).X({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=$l(e[1]);r.push(t)}else n.done()})).next((()=>{Gu(0===r.length)}))}))}containsKey(e,t){return eg(e,this.userId,t)}xn(e){return rg(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function eg(e,t,n){const r=Hl(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return ng(e).X({range:s,Y:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function tg(e){return yh(e,"mutations")}function ng(e){return yh(e,"documentMutations")}function rg(e){return yh(e,"mutationQueues")}class ig{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new ig(0)}static Mn(){return new ig(-1)}}class sg{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.$n(e).next((t=>{const n=new ig(t.highestTargetId);return t.highestTargetId=n.next(),this.On(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.$n(e).next((e=>ul.fromTimestamp(new cl(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.$n(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.$n(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.On(e,r))))}addTargetData(e,t){return this.Fn(e,t).next((()=>this.$n(e).next((n=>(n.targetCount+=1,this.Bn(t,n),this.On(e,n))))))}updateTargetData(e,t){return this.Fn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>og(e).delete(t.targetId))).next((()=>this.$n(e))).next((t=>(Gu(t.targetCount>0),t.targetCount-=1,this.On(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return og(e).X(((s,o)=>{const a=um(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>Al.waitFor(i))).next((()=>r))}forEachTarget(e,t){return og(e).X(((e,n)=>{const r=um(n);t(r)}))}$n(e){return ag(e).get("targetGlobalKey").next((e=>(Gu(null!==e),e)))}On(e,t){return ag(e).put("targetGlobalKey",t)}Fn(e,t){return og(e).put(lm(this.serializer,t))}Bn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.$n(e).next((e=>e.targetCount))}getTargetData(e,t){const n=Ld(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return og(e).X({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=um(n);Fd(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=cg(e);return t.forEach((t=>{const s=zl(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),Al.waitFor(r)}removeMatchingKeys(e,t,n){const r=cg(e);return Al.forEach(t,(t=>{const i=zl(t.path);return Al.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=cg(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=cg(e);let i=yf();return r.X({range:n,Y:!0},((e,t,n)=>{const r=$l(e[1]),s=new pl(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=zl(t.path),r=IDBKeyRange.bound([n],[al(n)],!1,!0);let i=0;return cg(e).X({index:"documentTargetsIndex",Y:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}le(e,t){return og(e).get(t).next((e=>e?um(e):null))}}function og(e){return yh(e,"targets")}function ag(e){return yh(e,"targetGlobal")}function cg(e){return yh(e,"targetDocuments")}function ug([e,t],[n,r]){const i=sl(e,n);return 0===i?sl(t,r):i}class lg{constructor(e){this.Ln=e,this.buffer=new Eh(ug),this.qn=0}Un(){return++this.qn}Kn(e){const t=[e,this.Un()];if(this.buffer.size<this.Ln)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();ug(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class hg{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Qn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}Qn(e){Vu("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Rl(e)?Vu("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await Sl(e)}await this.Qn(3e5)}))}}class dg{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.zn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Al.resolve(Vl.ct);const n=new lg(t);return this.jn.forEachTarget(e,(e=>n.Kn(e.sequenceNumber))).next((()=>this.jn.Wn(e,(e=>n.Kn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(Vu("LruGarbageCollector","Garbage collection skipped; disabled"),Al.resolve(Qm)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(Vu("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Qm):this.Hn(e,t)))}getCacheSize(e){return this.jn.getCacheSize(e)}Hn(e,t){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(Vu("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),Uu()<=L.DEBUG&&Vu("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Al.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}class fg{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new dg(e,t)}(this,t)}zn(e){const t=this.Jn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Jn(e){let t=0;return this.Wn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Wn(e,t){return this.Yn(e,((e,n)=>t(n)))}addReference(e,t,n){return pg(e,n)}removeReference(e,t,n){return pg(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return pg(e,t)}Xn(e,t){return function(e,t){let n=!1;return rg(e).Z((r=>eg(e,r,t).next((e=>(e&&(n=!0),Al.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Yn(e,((s,o)=>{if(o<=t){const t=this.Xn(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,ul.min()),cg(e).delete([0,zl(s.path)]))))}));r.push(t)}})).next((()=>Al.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return pg(e,t)}Yn(e,t){const n=cg(e);let r,i=Vl.ct;return n.X({index:"documentTargetsIndex"},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==Vl.ct&&t(new pl($l(r)),i),i=o,r=s):i=Vl.ct})).next((()=>{i!==Vl.ct&&t(new pl($l(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function pg(e,t){return cg(e).put(function(e,t){return{targetId:0,path:zl(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class mg{constructor(){this.changes=new of((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,cd.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Al.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class gg{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return _g(e).put(n)}removeEntry(e,t,n){return _g(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],sm(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Zn(e,n))))}getEntry(e,t){let n=cd.newInvalidDocument(t);return _g(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(Ig(t))},((e,r)=>{n=this.ts(t,r)})).next((()=>n))}es(e,t){let n={size:0,document:cd.newInvalidDocument(t)};return _g(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(Ig(t))},((e,r)=>{n={document:this.ts(t,r),size:Ym(r)}})).next((()=>n))}getEntries(e,t){let n=cf();return this.ns(e,t,((e,t)=>{const r=this.ts(e,t);n=n.insert(e,r)})).next((()=>n))}ss(e,t){let n=cf(),r=new Ih(pl.comparator);return this.ns(e,t,((e,t)=>{const i=this.ts(e,t);n=n.insert(e,i),r=r.insert(e,Ym(t))})).next((()=>({documents:n,rs:r})))}ns(e,t,n){if(t.isEmpty())return Al.resolve();let r=new Eh(Tg);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(Ig(r.first()),Ig(r.last())),s=r.getIterator();let o=s.getNext();return _g(e).X({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=pl.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&Tg(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.G(Ig(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r){const i=t.path,s=[i.popLast().toArray(),i.lastSegment(),sm(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return _g(e).j(IDBKeyRange.bound(s,o,!0)).next((e=>{let n=cf();for(const i of e){const e=this.ts(pl.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(tf(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=cf();const s=bg(t,n),o=bg(t,bl.max());return _g(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.ts(pl.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new vg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return wg(e).get("remoteDocumentGlobalKey").next((e=>(Gu(!!e),e)))}Zn(e,t){return wg(e).put("remoteDocumentGlobalKey",t)}ts(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Bp(e.fe,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=pl.fromSegments(t.noDocument.path),r=am(t.noDocument.readTime);n=cd.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return zu();{const e=pl.fromSegments(t.unknownDocument.path),r=am(t.unknownDocument.version);n=cd.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new cl(e[0],e[1]);return ul.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(ul.min()))return e}return cd.newInvalidDocument(e)}}function yg(e){return new gg(e)}class vg extends mg{constructor(e,t){super(),this.os=e,this.trackRemovals=t,this.us=new of((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new Eh(((e,t)=>sl(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.us.get(i);if(t.push(this.os.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=im(this.os.serializer,s);r=r.add(i.path.popLast());const c=Ym(a);n+=c-o.size,t.push(this.os.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=im(this.os.serializer,s.convertToNoDocument(ul.min()));t.push(this.os.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.os.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.os.updateMetadata(e,n)),Al.waitFor(t)}getFromCache(e,t){return this.os.es(e,t).next((e=>(this.us.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.os.ss(e,t).next((({documents:e,rs:t})=>(t.forEach(((t,n)=>{this.us.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function wg(e){return yh(e,"remoteDocumentGlobal")}function _g(e){return yh(e,"remoteDocumentsV14")}function Ig(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function bg(e,t){const n=t.documentKey.path.toArray();return[e,sm(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Tg(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=sl(n[e],r[e]),i)return i;return i=sl(n.length,r.length),i||(i=sl(n[n.length-2],r[r.length-2]),i||sl(n[n.length-1],r[r.length-1]))}class Eg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Cg{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&qf(n.mutation,e,Ah.empty(),cl.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,yf()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=yf()){const r=df();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=lf();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=df();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,yf())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=cf();const s=pf(),o=pf();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof $f)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),qf(o.mutation,t,o.mutation.getFieldMask(),cl.now())):s.set(t.key,Ah.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new Eg(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=pf();let r=new Ih(((e,t)=>e-t)),i=yf();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||Ah.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||yf()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=ff();c.forEach((e=>{if(!i.has(e)){const r=jf(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Al.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return pl.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Kd(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Al.resolve(df());let o=-1,a=i;return s.next((t=>Al.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?Al.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,yf()))).next((e=>({batchId:o,changes:hf(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new pl(t)).next((e=>{let t=lf();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let i=lf();return this.indexManager.getCollectionParents(e,r).next((s=>Al.forEach(s,(s=>{const o=function(e,t){return new Bd(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r)))).next((e=>{r.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,cd.newInvalidDocument(r)))}));let n=lf();return e.forEach(((e,i)=>{const s=r.get(e);void 0!==s&&qf(s.mutation,i,Ah.empty(),cl.now()),tf(t,i)&&(n=n.insert(e,i))})),n}))}}class Sg{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return Al.resolve(this.cs.get(t))}saveBundleMetadata(e,t){var n;return this.cs.set(t.id,{id:(n=t).id,version:n.version,createTime:Np(n.createTime)}),Al.resolve()}getNamedQuery(e,t){return Al.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,function(e){return{name:e.name,query:hm(e.bundledQuery),readTime:Np(e.readTime)}}(t)),Al.resolve()}}class Ag{constructor(){this.overlays=new Ih(pl.comparator),this.ls=new Map}getOverlay(e,t){return Al.resolve(this.overlays.get(t))}getOverlays(e,t){const n=df();return Al.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.we(e,t,r)})),Al.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.ls.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.ls.delete(n)),Al.resolve()}getOverlaysForCollection(e,t,n){const r=df(),i=t.length+1,s=new pl(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Al.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Ih(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=df(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=df(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return Al.resolve(o)}we(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.ls.get(r.largestBatchId).delete(n.key);this.ls.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new ep(t,n));let i=this.ls.get(t);void 0===i&&(i=yf(),this.ls.set(t,i)),this.ls.set(t,i.add(n.key))}}class Dg{constructor(){this.fs=new Eh(kg.ds),this.ws=new Eh(kg._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){const n=new kg(e,t);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.ys(new kg(e,t))}ps(e,t){e.forEach((e=>this.removeReference(e,t)))}Is(e){const t=new pl(new hl([])),n=new kg(t,e),r=new kg(t,e+1),i=[];return this.ws.forEachInRange([n,r],(e=>{this.ys(e),i.push(e.key)})),i}Ts(){this.fs.forEach((e=>this.ys(e)))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const t=new pl(new hl([])),n=new kg(t,e),r=new kg(t,e+1);let i=yf();return this.ws.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new kg(e,0),n=this.fs.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class kg{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return pl.comparator(e.key,t.key)||sl(e.As,t.As)}static _s(e,t){return sl(e.As,t.As)||pl.comparator(e.key,t.key)}}class Pg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new Eh(kg.ds)}checkEmpty(e){return Al.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Yf(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.Rs=this.Rs.add(new kg(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Al.resolve(s)}lookupMutationBatch(e,t){return Al.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.bs(n),i=r<0?0:r;return Al.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Al.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return Al.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new kg(t,0),r=new kg(t,Number.POSITIVE_INFINITY),i=[];return this.Rs.forEachInRange([n,r],(e=>{const t=this.Ps(e.As);i.push(t)})),Al.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Eh(sl);return t.forEach((e=>{const t=new kg(e,0),r=new kg(e,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([t,r],(e=>{n=n.add(e.As)}))})),Al.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;pl.isDocumentKey(i)||(i=i.child(""));const s=new kg(new pl(i),0);let o=new Eh(sl);return this.Rs.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.As)),!0)}),s),Al.resolve(this.Vs(o))}Vs(e){const t=[];return e.forEach((e=>{const n=this.Ps(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Gu(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return Al.forEach(t.mutations,(r=>{const i=new kg(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Rs=n}))}Cn(e){}containsKey(e,t){const n=new kg(t,0),r=this.Rs.firstAfterOrEqual(n);return Al.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Al.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){const t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Ng{constructor(e){this.Ds=e,this.docs=new Ih(pl.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Ds(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Al.resolve(n?n.document.mutableCopy():cd.newInvalidDocument(t))}getEntries(e,t){let n=cf();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():cd.newInvalidDocument(e))})),Al.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=cf();const s=t.path,o=new pl(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||Tl(Il(o),n)<=0||(r.has(o.key)||tf(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Al.resolve(i)}getAllFromCollectionGroup(e,t,n,r){zu()}Cs(e,t){return Al.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Rg(this)}getSize(e){return Al.resolve(this.size)}}class Rg extends mg{constructor(e){super(),this.os=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.os.addEntry(e,r)):this.os.removeEntry(n)})),Al.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class Og{constructor(e){this.persistence=e,this.xs=new of((e=>Ld(e)),Fd),this.lastRemoteSnapshotVersion=ul.min(),this.highestTargetId=0,this.Ns=0,this.ks=new Dg,this.targetCount=0,this.Ms=ig.kn()}forEachTarget(e,t){return this.xs.forEach(((e,n)=>t(n))),Al.resolve()}getLastRemoteSnapshotVersion(e){return Al.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Al.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),Al.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ns&&(this.Ns=t),Al.resolve()}Fn(e){this.xs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ms=new ig(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,Al.resolve()}updateTargetData(e,t){return this.Fn(t),Al.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,Al.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.xs.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.xs.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),Al.waitFor(i).next((()=>r))}getTargetCount(e){return Al.resolve(this.targetCount)}getTargetData(e,t){const n=this.xs.get(t)||null;return Al.resolve(n)}addMatchingKeys(e,t,n){return this.ks.gs(t,n),Al.resolve()}removeMatchingKeys(e,t,n){this.ks.ps(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),Al.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),Al.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ks.Es(t);return Al.resolve(n)}containsKey(e,t){return Al.resolve(this.ks.containsKey(t))}}class xg{constructor(e,t){this.$s={},this.overlays={},this.Os=new Vl(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new Og(this),this.indexManager=new jm,this.remoteDocumentCache=function(e){return new Ng(e)}((e=>this.referenceDelegate.Ls(e))),this.serializer=new rm(t),this.qs=new Sg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ag,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.$s[e.toKey()];return n||(n=new Pg(t,this.referenceDelegate),this.$s[e.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,n){Vu("MemoryPersistence","Starting transaction:",e);const r=new Lg(this.Os.next());return this.referenceDelegate.Us(),n(r).next((e=>this.referenceDelegate.Ks(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gs(e,t){return Al.or(Object.values(this.$s).map((n=>()=>n.containsKey(e,t))))}}class Lg extends Cl{constructor(e){super(),this.currentSequenceNumber=e}}class Fg{constructor(e){this.persistence=e,this.Qs=new Dg,this.js=null}static zs(e){return new Fg(e)}get Ws(){if(this.js)return this.js;throw zu()}addReference(e,t,n){return this.Qs.addReference(n,t),this.Ws.delete(n.toString()),Al.resolve()}removeReference(e,t,n){return this.Qs.removeReference(n,t),this.Ws.add(n.toString()),Al.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),Al.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach((e=>this.Ws.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Ws.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Us(){this.js=new Set}Ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Al.forEach(this.Ws,(n=>{const r=pl.fromPath(n);return this.Hs(e,r).next((e=>{e||t.removeEntry(r,ul.min())}))})).next((()=>(this.js=null,t.apply(e))))}updateLimboDocument(e,t){return this.Hs(e,t).next((e=>{e?this.Ws.delete(t.toString()):this.Ws.add(t.toString())}))}Ls(e){return 0}Hs(e,t){return Al.or([()=>Al.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class Mg{constructor(e){this.serializer=e}O(e,t,n,r){const i=new Dl("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Kl,{unique:!0}),e.createObjectStore("documentMutations")}(e),Ug(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=Al.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),Ug(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ul.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").j().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Kl,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return Al.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Ys(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.Xs(i))))),n<7&&r>=7&&(s=s.next((()=>this.Zs(i)))),n<8&&r>=8&&(s=s.next((()=>this.ti(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.ei(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:ch});t.createIndex("collectionPathOverlayIndex",uh,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",lh,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:Xl});t.createIndex("documentKeyIndex",Yl),t.createIndex("collectionGroupIndex",Zl)}(e))).next((()=>this.ni(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>this.si(e,i)))),n<15&&r>=15&&(s=s.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:ih}).createIndex("sequenceNumberIndex",sh,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:oh}).createIndex("documentKeyIndex",ah,{unique:!1})}(e)))),s}Xs(e){let t=0;return e.store("remoteDocuments").X(((e,n)=>{t+=Ym(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Ys(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.j().next((t=>Al.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.j("userMutationsIndex",r).next((n=>Al.forEach(n,(n=>{Gu(n.userId===t.userId);const r=cm(this.serializer,n);return Xm(e,t.userId,r).next((()=>{}))}))))}))))}Zs(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.X(((n,i)=>{const s=new hl(n),o=function(e){return[0,zl(e)]}(s);r.push(t.get(o).next((n=>n?Al.resolve():(n=>t.put({targetId:0,path:zl(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>Al.waitFor(r)))}))}ti(e,t){e.createObjectStore("collectionParents",{keyPath:rh});const n=t.store("collectionParents"),r=new Bm,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:zl(r)})}};return t.store("remoteDocuments").X({Y:!0},((e,t)=>{const n=new hl(e);return i(n.popLast())})).next((()=>t.store("documentMutations").X({Y:!0},(([e,t,n],r)=>{const s=$l(t);return i(s.popLast())}))))}ei(e){const t=e.store("targets");return t.X(((e,n)=>{const r=um(n),i=lm(this.serializer,r);return t.put(i)}))}ni(e,t){const n=t.store("remoteDocuments"),r=[];return n.X(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=(o=n,o.document?new pl(hl.fromString(o.document.name).popFirst(5)):o.noDocument?pl.fromSegments(o.noDocument.path):o.unknownDocument?pl.fromSegments(o.unknownDocument.path):zu()).path.toArray();var o;const a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))})).next((()=>Al.waitFor(r)))}si(e,t){const n=t.store("mutations"),r=yg(this.serializer),i=new xg(Fg.zs,this.serializer.fe);return n.j().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:yf();cm(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),Al.forEach(n,((e,n)=>{const s=new Lu(n),o=vm.de(this.serializer,s),a=i.getIndexManager(s),c=Zm.de(s,this.serializer,a,i.referenceDelegate);return new Cg(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new gh(t,Vl.ct),e).next()}))}))}}function Ug(e){e.createObjectStore("targetDocuments",{keyPath:th}).createIndex("documentTargetsIndex",nh,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",eh,{unique:!0}),e.createObjectStore("targetGlobal")}const Vg="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class jg{constructor(e,t,n,r,i,s,o,a,c,u,l=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ii=i,this.window=s,this.document=o,this.ri=c,this.oi=u,this.ui=l,this.Os=null,this.Fs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.ai=null,this.hi=null,this.li=Number.NEGATIVE_INFINITY,this.fi=e=>Promise.resolve(),!jg.D())throw new Ku($u.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new fg(this,r),this.di=t+"main",this.serializer=new rm(a),this.wi=new kl(this.di,this.ui,new Mg(this.serializer)),this.Bs=new sg(this.referenceDelegate,this.serializer),this.remoteDocumentCache=yg(this.serializer),this.qs=new mm,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===u&&ju("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Ku($u.FAILED_PRECONDITION,Vg);return this.gi(),this.yi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Bs.getHighestSequenceNumber(e)))})).then((e=>{this.Os=new Vl(e,this.ri)})).then((()=>{this.Fs=!0})).catch((e=>(this.wi&&this.wi.close(),Promise.reject(e))))}Ii(e){return this.fi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.wi.B((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ii.enqueueAndForget((async()=>{this.started&&await this.mi()})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>qg(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Ti(e).next((e=>{e||(this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))))}))})).next((()=>this.Ei(e))).next((t=>this.isPrimary&&!t?this.Ai(e).next((()=>!1)):!!t&&this.vi(e).next((()=>!0)))))).catch((e=>{if(Rl(e))return Vu("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Vu("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.ii.enqueueRetryable((()=>this.fi(e))),this.isPrimary=e}))}Ti(e){return Bg(e).get("owner").next((e=>Al.resolve(this.Ri(e))))}Pi(e){return qg(e).delete(this.clientId)}async bi(){if(this.isPrimary&&!this.Vi(this.li,18e5)){this.li=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=yh(e,"clientMetadata");return t.j().next((e=>{const n=this.Si(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return Al.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this._i)for(const t of e)this._i.removeItem(this.Di(t.clientId))}}pi(){this.hi=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.mi().then((()=>this.bi())).then((()=>this.pi()))))}Ri(e){return!!e&&e.ownerId===this.clientId}Ei(e){return this.oi?Al.resolve(!0):Bg(e).get("owner").next((t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)){if(this.Ri(t)&&this.networkEnabled)return!0;if(!this.Ri(t)){if(!t.allowTabSynchronization)throw new Ku($u.FAILED_PRECONDITION,Vg);return!1}}return!(!this.networkEnabled||!this.inForeground)||qg(e).j().next((e=>void 0===this.Si(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&Vu("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.Fs=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Ni(),this.ki(),await this.wi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new gh(e,Vl.ct);return this.Ai(t).next((()=>this.Pi(t)))})),this.wi.close(),this.Mi()}Si(e,t){return e.filter((e=>this.Vi(e.updateTimeMs,t)&&!this.Ci(e.clientId)))}$i(){return this.runTransaction("getActiveClients","readonly",(e=>qg(e).j().next((e=>this.Si(e,18e5).map((e=>e.clientId))))))}get started(){return this.Fs}getMutationQueue(e,t){return Zm.de(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new zm(e,this.serializer.fe.databaseId)}getDocumentOverlayCache(e){return vm.de(this.serializer,e)}getBundleCache(){return this.qs}runTransaction(e,t,n){Vu("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=15===(s=this.ui)?mh:14===s?ph:13===s?fh:12===s?dh:11===s?hh:void zu();var s;let o;return this.wi.runTransaction(e,r,i,(r=>(o=new gh(r,this.Os?this.Os.next():Vl.ct),"readwrite-primary"===t?this.Ti(o).next((e=>!!e||this.Ei(o))).next((t=>{if(!t)throw ju(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ii.enqueueRetryable((()=>this.fi(!1))),new Ku($u.FAILED_PRECONDITION,El);return n(o)})).next((e=>this.vi(o).next((()=>e)))):this.Oi(o).next((()=>n(o)))))).then((e=>(o.raiseOnCommittedEvent(),e)))}Oi(e){return Bg(e).get("owner").next((e=>{if(null!==e&&this.Vi(e.leaseTimestampMs,5e3)&&!this.Ci(e.ownerId)&&!this.Ri(e)&&!(this.oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Ku($u.FAILED_PRECONDITION,Vg)}))}vi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Bg(e).put("owner",t)}static D(){return kl.D()}Ai(e){const t=Bg(e);return t.get("owner").next((e=>this.Ri(e)?(Vu("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):Al.resolve()))}Vi(e,t){const n=Date.now();return!(e<n-t||e>n&&(ju(`Detected an update time that is in the future: ${e} > ${n}`),1))}gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ai=()=>{this.ii.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.mi())))},this.document.addEventListener("visibilitychange",this.ai),this.inForeground="visible"===this.document.visibilityState)}Ni(){this.ai&&(this.document.removeEventListener("visibilitychange",this.ai),this.ai=null)}yi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const e=/(?:Version|Mobile)\/1[456]/;!d()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ci))}ki(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Ci(e){var t;try{const n=null!==(null===(t=this._i)||void 0===t?void 0:t.getItem(this.Di(e)));return Vu("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return ju("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this._i)try{this._i.setItem(this.Di(this.clientId),String(Date.now()))}catch(e){ju("Failed to set zombie client id.",e)}}Mi(){if(this._i)try{this._i.removeItem(this.Di(this.clientId))}catch(e){}}Di(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Bg(e){return yh(e,"owner")}function qg(e){return yh(e,"clientMetadata")}function zg(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Gg{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Fi=n,this.Bi=r}static Li(e,t){let n=yf(),r=yf();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Gg(e,t.fromCache,n,r)}}class Wg{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.Ki(e,t).next((i=>i||this.Gi(e,t,r,n))).next((n=>n||this.Qi(e,t)))}Ki(e,t){if(Gd(t))return Al.resolve(null);let n=Qd(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Xd(t,null,"F"),n=Qd(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=yf(...r);return this.Ui.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.ji(t,r);return this.zi(t,s,i,n.readTime)?this.Ki(e,Xd(t,null,"F")):this.Wi(e,s,t,n)}))))})))))}Gi(e,t,n,r){return Gd(t)||r.isEqual(ul.min())?this.Qi(e,t):this.Ui.getDocuments(e,n).next((i=>{const s=this.ji(t,i);return this.zi(t,s,n,r)?this.Qi(e,t):(Uu()<=L.DEBUG&&Vu("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ef(t)),this.Wi(e,s,t,_l(r,-1)))}))}ji(e,t){let n=new Eh(rf(e));return t.forEach(((t,r)=>{tf(e,r)&&(n=n.add(r))})),n}zi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Qi(e,t){return Uu()<=L.DEBUG&&Vu("QueryEngine","Using full collection scan to execute query:",ef(t)),this.Ui.getDocumentsMatchingQuery(e,t,bl.min())}Wi(e,t,n,r){return this.Ui.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class $g{constructor(e,t,n,r){this.persistence=e,this.Hi=t,this.serializer=r,this.Ji=new Ih(sl),this.Yi=new of((e=>Ld(e)),Fd),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(n)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Cg(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ji)))}}function Kg(e,t,n,r){return new $g(e,t,n,r)}async function Hg(e,t){const n=Wu(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.tr(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=yf();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({er:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Qg(e){const t=Wu(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Bs.getLastRemoteSnapshotVersion(e)))}function Jg(e,t,n){let r=yf(),i=yf();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=cf();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(ul.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):Vu("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{nr:r,sr:i}}))}function Xg(e,t){const n=Wu(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function Yg(e,t){const n=Wu(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Bs.getTargetData(e,t).next((i=>i?(r=i,Al.resolve(r)):n.Bs.allocateTargetId(e).next((i=>(r=new nm(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Bs.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.Ji.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(e.targetId,e),n.Yi.set(t,e.targetId)),e}))}async function Zg(e,t,n){const r=Wu(e),i=r.Ji.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!Rl(e))throw e;Vu("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ji=r.Ji.remove(t),r.Yi.delete(i.target)}function ey(e,t,n){const r=Wu(e);let i=ul.min(),s=yf();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=Wu(e),i=r.Yi.get(n);return void 0!==i?Al.resolve(r.Ji.get(i)):r.Bs.getTargetData(t,n)}(r,e,Qd(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Bs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.Hi.getDocumentsMatchingQuery(e,t,n?i:ul.min(),n?s:yf()))).next((e=>(ry(r,nf(t),e),{documents:e,ir:s})))))}function ty(e,t){const n=Wu(e),r=Wu(n.Bs),i=n.Ji.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.le(e,t).next((e=>e?e.target:null))))}function ny(e,t){const n=Wu(e),r=n.Xi.get(t)||ul.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.Zi.getAllFromCollectionGroup(e,t,_l(r,-1),Number.MAX_SAFE_INTEGER))).then((e=>(ry(n,t,e),e)))}function ry(e,t,n){let r=e.Xi.get(t)||ul.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Xi.set(t,r)}async function iy(e,t,n=yf()){const r=await Yg(e,Qd(hm(t.bundledQuery))),i=Wu(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const s=Np(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.qs.saveNamedQuery(e,t);const o=r.withResumeToken(kh.EMPTY_BYTE_STRING,s);return i.Ji=i.Ji.insert(o.targetId,o),i.Bs.updateTargetData(e,o).next((()=>i.Bs.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.Bs.addMatchingKeys(e,n,r.targetId))).next((()=>i.qs.saveNamedQuery(e,t)))}))}function sy(e,t){return`firestore_clients_${e}_${t}`}function oy(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function ay(e,t){return`firestore_targets_${e}_${t}`}class cy{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static ar(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new Ku(r.error.code,r.error.message))),s?new cy(e,t,r.state,i):(ju("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}hr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class uy{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static ar(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new Ku(n.error.code,n.error.message))),i?new uy(e,n.state,r):(ju("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}hr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ly{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static ar(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=wf();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=ql(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new ly(e,i):(ju("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class hy{constructor(e,t){this.clientId=e,this.onlineState=t}static ar(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new hy(t.clientId,t.onlineState):(ju("SharedClientState",`Failed to parse online state: ${e}`),null)}}class dy{constructor(){this.activeTargetIds=wf()}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class fy{constructor(e,t,n,r,i){this.window=e,this.ii=t,this.persistenceKey=n,this.wr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this._r=this.mr.bind(this),this.gr=new Ih(sl),this.started=!1,this.yr=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.pr=sy(this.persistenceKey,this.wr),this.Ir=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.gr=this.gr.insert(this.wr,new dy),this.Tr=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.Er=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Ar=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.vr=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.Rr=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this._r)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.$i();for(const t of e){if(t===this.wr)continue;const e=this.getItem(sy(this.persistenceKey,t));if(e){const n=ly.ar(t,e);n&&(this.gr=this.gr.insert(n.clientId,n))}}this.Pr();const t=this.storage.getItem(this.vr);if(t){const e=this.br(t);e&&this.Vr(e)}for(const e of this.yr)this.mr(e);this.yr=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ir,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Sr(this.gr)}isActiveQueryTarget(e){let t=!1;return this.gr.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Dr(e,"pending")}updateMutationState(e,t,n){this.Dr(e,t,n),this.Cr(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(ay(this.persistenceKey,e));if(n){const r=uy.ar(e,n);r&&(t=r.state)}}return this.Nr.lr(e),this.Pr(),t}removeLocalQueryTarget(e){this.Nr.dr(e),this.Pr()}isLocalQueryTarget(e){return this.Nr.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(ay(this.persistenceKey,e))}updateQueryState(e,t,n){this.kr(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.Cr(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Mr(e)}notifyBundleLoaded(e){this.$r(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this._r),this.removeItem(this.pr),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Vu("SharedClientState","READ",e,t),t}setItem(e,t){Vu("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){Vu("SharedClientState","REMOVE",e),this.storage.removeItem(e)}mr(e){const t=e;if(t.storageArea===this.storage){if(Vu("SharedClientState","EVENT",t.key,t.newValue),t.key===this.pr)return void ju("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ii.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.Tr.test(t.key)){if(null==t.newValue){const e=this.Or(t.key);return this.Fr(e,null)}{const e=this.Br(t.key,t.newValue);if(e)return this.Fr(e.clientId,e)}}else if(this.Er.test(t.key)){if(null!==t.newValue){const e=this.Lr(t.key,t.newValue);if(e)return this.qr(e)}}else if(this.Ar.test(t.key)){if(null!==t.newValue){const e=this.Ur(t.key,t.newValue);if(e)return this.Kr(e)}}else if(t.key===this.vr){if(null!==t.newValue){const e=this.br(t.newValue);if(e)return this.Vr(e)}}else if(t.key===this.Ir){const e=function(e){let t=Vl.ct;if(null!=e)try{const n=JSON.parse(e);Gu("number"==typeof n),t=n}catch(e){ju("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==Vl.ct&&this.sequenceNumberHandler(e)}else if(t.key===this.Rr){const e=this.Gr(t.newValue);await Promise.all(e.map((e=>this.syncEngine.Qr(e))))}}else this.yr.push(t)}))}}get Nr(){return this.gr.get(this.wr)}Pr(){this.setItem(this.pr,this.Nr.hr())}Dr(e,t,n){const r=new cy(this.currentUser,e,t,n),i=oy(this.persistenceKey,this.currentUser,e);this.setItem(i,r.hr())}Cr(e){const t=oy(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Mr(e){const t={clientId:this.wr,onlineState:e};this.storage.setItem(this.vr,JSON.stringify(t))}kr(e,t,n){const r=ay(this.persistenceKey,e),i=new uy(e,t,n);this.setItem(r,i.hr())}$r(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Rr,t)}Or(e){const t=this.Tr.exec(e);return t?t[1]:null}Br(e,t){const n=this.Or(e);return ly.ar(n,t)}Lr(e,t){const n=this.Er.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return cy.ar(new Lu(i),r,t)}Ur(e,t){const n=this.Ar.exec(e),r=Number(n[1]);return uy.ar(r,t)}br(e){return hy.ar(e)}Gr(e){return JSON.parse(e)}async qr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.jr(e.batchId,e.state,e.error);Vu("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Kr(e){return this.syncEngine.zr(e.targetId,e.state,e.error)}Fr(e,t){const n=t?this.gr.insert(e,t):this.gr.remove(e),r=this.Sr(this.gr),i=this.Sr(n),s=[],o=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.Wr(s,o).then((()=>{this.gr=n}))}Vr(e){this.gr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Sr(e){let t=wf();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class py{constructor(){this.Hr=new dy,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,n){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new dy,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class my{Yr(e){}shutdown(){}}class gy{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){Vu("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){Vu("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let yy=null;function vy(){return null===yy?yy=268435456+Math.round(2147483648*Math.random()):yy++,"0x"+yy.toString(16)}const wy={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class _y{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}const Iy="WebChannelConnection";class by extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.mo=t+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,n,r,i){const s=vy(),o=this.To(e,t);Vu("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const a={};return this.Eo(a,r,i),this.Ao(e,o,a,n).then((t=>(Vu("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw Bu("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,r,i,s){return this.Io(e,t,n,r,i)}Eo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Fu,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}To(e,t){const n=wy[e];return`${this.mo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,n,r){const i=vy();return new Promise(((s,o)=>{const a=new Nu;a.setWithCredentials(!0),a.listenOnce(Su.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Cu.NO_ERROR:const t=a.getResponseJson();Vu(Iy,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case Cu.TIMEOUT:Vu(Iy,`RPC '${e}' ${i} timed out`),o(new Ku($u.DEADLINE_EXCEEDED,"Request time out"));break;case Cu.HTTP_ERROR:const n=a.getStatus();if(Vu(Iy,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values($u).indexOf(t)>=0?t:$u.UNKNOWN}(t.status);o(new Ku(e,t.message))}else o(new Ku($u.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Ku($u.UNAVAILABLE,"Connection failed."));break;default:zu()}}finally{Vu(Iy,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(r);Vu(Iy,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)}))}Ro(e,t,n){const r=vy(),i=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=Tu(),o=Eu(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new ku({})),this.Eo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=i.join("");Vu(Iy,`Creating RPC '${e}' stream ${r}: ${u}`,a);const l=s.createWebChannel(u,a);let h=!1,d=!1;const f=new _y({ro:t=>{d?Vu(Iy,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(Vu(Iy,`Opening RPC '${e}' stream ${r} transport.`),l.open(),h=!0),Vu(Iy,`RPC '${e}' stream ${r} sending:`,t),l.send(t))},oo:()=>l.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return p(l,Pu.EventType.OPEN,(()=>{d||Vu(Iy,`RPC '${e}' stream ${r} transport opened.`)})),p(l,Pu.EventType.CLOSE,(()=>{d||(d=!0,Vu(Iy,`RPC '${e}' stream ${r} transport closed`),f.wo())})),p(l,Pu.EventType.ERROR,(t=>{d||(d=!0,Bu(Iy,`RPC '${e}' stream ${r} transport errored:`,t),f.wo(new Ku($u.UNAVAILABLE,"The operation could not be completed")))})),p(l,Pu.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];Gu(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Vu(Iy,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=np[e];if(void 0!==t)return sp(t)}(t),i=o.message;void 0===n&&(n=$u.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.wo(new Ku(n,i)),l.close()}else Vu(Iy,`RPC '${e}' stream ${r} received:`,i),f._o(i)}})),p(o,Au.STAT_EVENT,(t=>{t.stat===Du.PROXY?Vu(Iy,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===Du.NOPROXY&&Vu(Iy,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.fo()}),0),f}}function Ty(){return"undefined"!=typeof window?window:null}function Ey(){return"undefined"!=typeof document?document:null}function Cy(e){return new Sp(e,!0)}class Sy{constructor(e,t,n=1e3,r=1.5,i=6e4){this.ii=e,this.timerId=t,this.Po=n,this.bo=r,this.Vo=i,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const t=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),r=Math.max(0,t-n);r>0&&Vu("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,r,(()=>(this.Co=Date.now(),e()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class Ay{constructor(e,t,n,r,i,s,o,a){this.ii=e,this.$o=n,this.Oo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new Sy(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,t){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==e?this.qo.reset():t&&t.code===$u.RESOURCE_EXHAUSTED?(ju(t.toString()),ju("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):t&&t.code===$u.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(t)}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Fo===t&&this.Zo(e,n)}),(t=>{e((()=>{const e=new Ku($u.UNKNOWN,"Fetching auth token failed: "+t.message);return this.tu(e)}))}))}Zo(e,t){const n=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((e=>{n((()=>this.tu(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(e){return Vu("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget((()=>this.Fo===e?t():(Vu("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Dy extends Ay{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:zu()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(Gu(void 0===t||"string"==typeof t),kh.fromBase64String(t||"")):(Gu(void 0===t||t instanceof Uint8Array),kh.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?$u.UNKNOWN:sp(e.code);return new Ku(t,e.message||"")}(o);n=new vp(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Lp(e,r.document.name),s=Np(r.document.updateTime),o=r.document.createTime?Np(r.document.createTime):ul.min(),a=new od({mapValue:{fields:r.document.fields}}),c=cd.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new gp(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Lp(e,r.document),s=r.readTime?Np(r.readTime):ul.min(),o=cd.newNoDocument(i,s),a=r.removedTargetIds||[];n=new gp([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Lp(e,r.document),s=r.removedTargetIds||[];n=new gp([],s,i,null)}else{if(!("filter"in t))return zu();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new tp(r,i),o=e.targetId;n=new yp(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ul.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ul.min():t.readTime?Np(t.readTime):ul.min()}(e);return this.listener.nu(t,n)}su(e){const t={};t.database=Up(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Md(r)?{documents:Gp(e,r)}:{query:Wp(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=kp(e,t.resumeToken);const r=Ap(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(ul.min())>0){n.readTime=Dp(e,t.snapshotVersion.toTimestamp());const r=Ap(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return zu()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Wo(t)}iu(e){const t={};t.database=Up(this.serializer),t.removeTarget=e,this.Wo(t)}}class ky extends Ay{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(Gu(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const t=function(e,t){return e&&e.length>0?(Gu(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Np(e.updateTime):Np(t);return n.isEqual(ul.min())&&(n=Np(t)),new Ff(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Np(e.commitTime);return this.listener.cu(n,t)}return Gu(!e.writeResults||0===e.writeResults.length),this.ru=!0,this.listener.au()}hu(){const e={};e.database=Up(this.serializer),this.Wo(e)}uu(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>qp(this.serializer,e)))};this.Wo(t)}}class Py extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.lu=!1}fu(){if(this.lu)throw new Ku($u.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.Io(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===$u.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Ku($u.UNKNOWN,e.toString())}))}vo(e,t,n,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.vo(e,t,n,i,s,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===$u.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Ku($u.UNKNOWN,e.toString())}))}terminate(){this.lu=!0}}class Ny{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(ju(t),this.mu=!1):Vu("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class Ry{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=i,this.Pu.Yr((e=>{n.enqueueAndForget((async()=>{By(this)&&(Vu("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Wu(e);t.vu.add(4),await xy(t),t.bu.set("Unknown"),t.vu.delete(4),await Oy(t)}(this))}))})),this.bu=new Ny(n,r)}}async function Oy(e){if(By(e))for(const t of e.Ru)await t(!0)}async function xy(e){for(const t of e.Ru)await t(!1)}function Ly(e,t){const n=Wu(e);n.Au.has(t.targetId)||(n.Au.set(t.targetId,t),jy(n)?Vy(n):sv(n).Ko()&&My(n,t))}function Fy(e,t){const n=Wu(e),r=sv(n);n.Au.delete(t),r.Ko()&&Uy(n,t),0===n.Au.size&&(r.Ko()?r.jo():By(n)&&n.bu.set("Unknown"))}function My(e,t){if(e.Vu.qt(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ul.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}sv(e).su(t)}function Uy(e,t){e.Vu.qt(t),sv(e).iu(t)}function Vy(e){e.Vu=new _p({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),le:t=>e.Au.get(t)||null,ue:()=>e.datastore.serializer.databaseId}),sv(e).start(),e.bu.gu()}function jy(e){return By(e)&&!sv(e).Uo()&&e.Au.size>0}function By(e){return 0===Wu(e).vu.size}function qy(e){e.Vu=void 0}async function zy(e){e.Au.forEach(((t,n)=>{My(e,t)}))}async function Gy(e,t){qy(e),jy(e)?(e.bu.Iu(t),Vy(e)):e.bu.set("Unknown")}async function Wy(e,t,n){if(e.bu.set("Online"),t instanceof vp&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Au.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Au.delete(r),e.Vu.removeTarget(r))}(e,t)}catch(n){Vu("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await $y(e,n)}else if(t instanceof gp?e.Vu.Ht(t):t instanceof yp?e.Vu.ne(t):e.Vu.Xt(t),!n.isEqual(ul.min()))try{const t=await Qg(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Vu.ce(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Au.get(r);i&&e.Au.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.Au.get(t);if(!r)return;e.Au.set(t,r.withResumeToken(kh.EMPTY_BYTE_STRING,r.snapshotVersion)),Uy(e,t);const i=new nm(r.target,t,n,r.sequenceNumber);My(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Vu("RemoteStore","Failed to raise snapshot:",t),await $y(e,t)}}async function $y(e,t,n){if(!Rl(t))throw t;e.vu.add(1),await xy(e),e.bu.set("Offline"),n||(n=()=>Qg(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Vu("RemoteStore","Retrying IndexedDB access"),await n(),e.vu.delete(1),await Oy(e)}))}function Ky(e,t){return t().catch((n=>$y(e,n,t)))}async function Hy(e){const t=Wu(e),n=ov(t);let r=t.Eu.length>0?t.Eu[t.Eu.length-1].batchId:-1;for(;Qy(t);)try{const e=await Xg(t.localStore,r);if(null===e){0===t.Eu.length&&n.jo();break}r=e.batchId,Jy(t,e)}catch(e){await $y(t,e)}Xy(t)&&Yy(t)}function Qy(e){return By(e)&&e.Eu.length<10}function Jy(e,t){e.Eu.push(t);const n=ov(e);n.Ko()&&n.ou&&n.uu(t.mutations)}function Xy(e){return By(e)&&!ov(e).Uo()&&e.Eu.length>0}function Yy(e){ov(e).start()}async function Zy(e){ov(e).hu()}async function ev(e){const t=ov(e);for(const n of e.Eu)t.uu(n.mutations)}async function tv(e,t,n){const r=e.Eu.shift(),i=Zf.from(r,t,n);await Ky(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Hy(e)}async function nv(e,t){t&&ov(e).ou&&await async function(e,t){if(ip(n=t.code)&&n!==$u.ABORTED){const n=e.Eu.shift();ov(e).Qo(),await Ky(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Hy(e)}var n}(e,t),Xy(e)&&Yy(e)}async function rv(e,t){const n=Wu(e);n.asyncQueue.verifyOperationInProgress(),Vu("RemoteStore","RemoteStore received new credentials");const r=By(n);n.vu.add(3),await xy(n),r&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.vu.delete(3),await Oy(n)}async function iv(e,t){const n=Wu(e);t?(n.vu.delete(2),await Oy(n)):t||(n.vu.add(2),await xy(n),n.bu.set("Unknown"))}function sv(e){return e.Su||(e.Su=function(e,t,n){const r=Wu(e);return r.fu(),new Dy(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:zy.bind(null,e),ao:Gy.bind(null,e),nu:Wy.bind(null,e)}),e.Ru.push((async t=>{t?(e.Su.Qo(),jy(e)?Vy(e):e.bu.set("Unknown")):(await e.Su.stop(),qy(e))}))),e.Su}function ov(e){return e.Du||(e.Du=function(e,t,n){const r=Wu(e);return r.fu(),new ky(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{uo:Zy.bind(null,e),ao:nv.bind(null,e),au:ev.bind(null,e),cu:tv.bind(null,e)}),e.Ru.push((async t=>{t?(e.Du.Qo(),await Hy(e)):(await e.Du.stop(),e.Eu.length>0&&(Vu("RemoteStore",`Stopping write stream with ${e.Eu.length} pending writes`),e.Eu=[]))}))),e.Du}class av{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Hu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new av(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ku($u.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function cv(e,t){if(ju("AsyncQueue",`${t}: ${e}`),Rl(e))return new Ku($u.UNAVAILABLE,`${t}: ${e}`);throw e}class uv{constructor(e){this.comparator=e?(t,n)=>e(t,n)||pl.comparator(t.key,n.key):(e,t)=>pl.comparator(e.key,t.key),this.keyedMap=lf(),this.sortedSet=new Ih(this.comparator)}static emptySet(e){return new uv(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof uv))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new uv;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class lv{constructor(){this.Cu=new Ih(pl.comparator)}track(e){const t=e.doc.key,n=this.Cu.get(t);n?0!==e.type&&3===n.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==n.type?this.Cu=this.Cu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Cu=this.Cu.remove(t):1===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):zu():this.Cu=this.Cu.insert(t,e)}xu(){const e=[];return this.Cu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class hv{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new hv(e,t,uv.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Yd(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class dv{constructor(){this.Nu=void 0,this.listeners=[]}}class fv{constructor(){this.queries=new of((e=>Zd(e)),Yd),this.onlineState="Unknown",this.ku=new Set}}async function pv(e,t){const n=Wu(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new dv),i)try{s.Nu=await n.onListen(r)}catch(e){const n=cv(e,`Initialization of query '${ef(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.Mu(n.onlineState),s.Nu&&t.$u(s.Nu)&&vv(n)}async function mv(e,t){const n=Wu(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function gv(e,t){const n=Wu(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.$u(e)&&(r=!0);i.Nu=e}}r&&vv(n)}function yv(e,t,n){const r=Wu(e),i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}function vv(e){e.ku.forEach((e=>{e.next()}))}class wv{constructor(e,t,n){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new hv(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Ku||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){if(e.docChanges.length>0)return!0;const t=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Uu(e){e=hv.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class _v{constructor(e,t){this.Gu=e,this.byteLength=t}Qu(){return"metadata"in this.Gu}}class Iv{constructor(e){this.serializer=e}rr(e){return Lp(this.serializer,e)}ur(e){return e.metadata.exists?Bp(this.serializer,e.document,!1):cd.newNoDocument(this.rr(e.metadata.name),this.cr(e.metadata.readTime))}cr(e){return Np(e)}}class bv{constructor(e,t,n){this.ju=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Tv(e)}zu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Gu.namedQuery)this.queries.push(e.Gu.namedQuery);else if(e.Gu.documentMetadata){this.documents.push({metadata:e.Gu.documentMetadata}),e.Gu.documentMetadata.exists||++t;const n=hl.fromString(e.Gu.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Gu.document&&(this.documents[this.documents.length-1].document=e.Gu.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Wu(e){const t=new Map,n=new Iv(this.serializer);for(const r of e)if(r.metadata.queries){const e=n.rr(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||yf()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=Wu(e);let s=yf(),o=cf();for(const e of n){const n=t.rr(e.metadata.name);e.document&&(s=s.add(n));const r=t.ur(e);r.setReadTime(t.cr(e.metadata.readTime)),o=o.insert(n,r)}const a=i.Zi.newChangeBuffer({trackRemovals:!0}),c=await Yg(i,function(e){return Qd(zd(hl.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>Jg(e,a,o).next((t=>(a.apply(e),t))).next((t=>i.Bs.removeMatchingKeysForTargetId(e,c.targetId).next((()=>i.Bs.addMatchingKeys(e,s,c.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(e,t.nr,t.sr))).next((()=>t.nr))))))}(this.localStore,new Iv(this.serializer),this.documents,this.ju.id),t=this.Wu(this.documents);for(const e of this.queries)await iy(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Hu:this.collectionGroups,Ju:e}}}function Tv(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Ev{constructor(e){this.key=e}}class Cv{constructor(e){this.key=e}}class Sv{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=yf(),this.mutatedKeys=yf(),this.tc=rf(e),this.ec=new uv(this.tc)}get nc(){return this.Yu}sc(e,t){const n=t?t.ic:new lv,r=t?t.ec:this.ec;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=tf(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.rc(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.tc(l,a)>0||c&&this.tc(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ec:s,ic:n,zi:o,mutatedKeys:i}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const i=e.ic.xu();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return zu()}};return n(e)-n(t)}(e.type,t.type)||this.tc(e.doc,t.doc))),this.oc(n);const s=t?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==i.length||a?{snapshot:new hv(this.query,e.ec,r,i,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:s}:{cc:s}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new lv,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach((e=>this.Yu=this.Yu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Yu=this.Yu.delete(e))),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=yf(),this.ec.forEach((e=>{this.ac(e.key)&&(this.Zu=this.Zu.add(e.key))}));const t=[];return e.forEach((e=>{this.Zu.has(e)||t.push(new Cv(e))})),this.Zu.forEach((n=>{e.has(n)||t.push(new Ev(n))})),t}hc(e){this.Yu=e.ir,this.Zu=yf();const t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return hv.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class Av{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Dv{constructor(e){this.key=e,this.fc=!1}}class kv{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.dc={},this.wc=new of((e=>Zd(e)),Yd),this._c=new Map,this.mc=new Set,this.gc=new Ih(pl.comparator),this.yc=new Map,this.Ic=new Dg,this.Tc={},this.Ec=new Map,this.Ac=ig.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function Pv(e,t){const n=nw(e);let r,i;const s=n.wc.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.lc();else{const e=await Yg(n.localStore,Qd(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await Nv(n,t,r,"current"===s,e.resumeToken),n.isPrimaryClient&&Ly(n.remoteStore,e)}return i}async function Nv(e,t,n,r,i){e.Rc=(t,n,r)=>async function(e,t,n,r){let i=t.view.sc(n);i.zi&&(i=await ey(e.localStore,t.query,!1).then((({documents:e})=>t.view.sc(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return qv(e,t.targetId,o.cc),o.snapshot}(e,t,n,r);const s=await ey(e.localStore,t,!0),o=new Sv(t,s.ir),a=o.sc(s.documents),c=mp.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);qv(e,n,u.cc);const l=new Av(t,n,o);return e.wc.set(t,l),e._c.has(n)?e._c.get(n).push(t):e._c.set(n,[t]),u.snapshot}async function Rv(e,t){const n=Wu(e),r=n.wc.get(t),i=n._c.get(r.targetId);if(i.length>1)return n._c.set(r.targetId,i.filter((e=>!Yd(e,t)))),void n.wc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Zg(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),Fy(n.remoteStore,r.targetId),jv(n,r.targetId)})).catch(Sl)):(jv(n,r.targetId),await Zg(n.localStore,r.targetId,!0))}async function Ov(e,t){const n=Wu(e);try{const e=await function(e,t){const n=Wu(e),r=t.snapshotVersion;let i=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Zi.newChangeBuffer({trackRemovals:!0});i=n.Ji;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Bs.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Bs.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(kh.EMPTY_BYTE_STRING,ul.min()).withLastLimboFreeSnapshotVersion(ul.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Bs.updateTargetData(e,u))}));let a=cf(),c=yf();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(Jg(e,s,t.documentUpdates).next((e=>{a=e.nr,c=e.sr}))),!r.isEqual(ul.min())){const t=n.Bs.getLastRemoteSnapshotVersion(e).next((t=>n.Bs.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return Al.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.Ji=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.yc.get(t);r&&(Gu(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.fc=!0:e.modifiedDocuments.size>0?Gu(r.fc):e.removedDocuments.size>0&&(Gu(r.fc),r.fc=!1))})),await Wv(n,e,t)}catch(e){await Sl(e)}}function xv(e,t,n){const r=Wu(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.wc.forEach(((n,r)=>{const i=r.view.Mu(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=Wu(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.Mu(t)&&(r=!0)})),r&&vv(n)}(r.eventManager,t),e.length&&r.dc.nu(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Lv(e,t,n){const r=Wu(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.yc.get(t),s=i&&i.key;if(s){let e=new Ih(pl.comparator);e=e.insert(s,cd.newNoDocument(s,ul.min()));const n=yf().add(s),i=new pp(ul.min(),new Map,new Ih(sl),e,n);await Ov(r,i),r.gc=r.gc.remove(s),r.yc.delete(t),Gv(r)}else await Zg(r.localStore,t,!1).then((()=>jv(r,t,n))).catch(Sl)}async function Fv(e,t){const n=Wu(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Wu(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.Zi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=Al.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);Gu(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=yf();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Vv(n,r,null),Uv(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Wv(n,e)}catch(e){await Sl(e)}}async function Mv(e,t,n){const r=Wu(e);try{const e=await function(e,t){const n=Wu(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Gu(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Vv(r,t,n),Uv(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Wv(r,e)}catch(n){await Sl(n)}}function Uv(e,t){(e.Ec.get(t)||[]).forEach((e=>{e.resolve()})),e.Ec.delete(t)}function Vv(e,t,n){const r=Wu(e);let i=r.Tc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Tc[r.currentUser.toKey()]=i}}function jv(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e._c.get(t))e.wc.delete(r),n&&e.dc.Pc(r,n);e._c.delete(t),e.isPrimaryClient&&e.Ic.Is(t).forEach((t=>{e.Ic.containsKey(t)||Bv(e,t)}))}function Bv(e,t){e.mc.delete(t.path.canonicalString());const n=e.gc.get(t);null!==n&&(Fy(e.remoteStore,n),e.gc=e.gc.remove(t),e.yc.delete(n),Gv(e))}function qv(e,t,n){for(const r of n)r instanceof Ev?(e.Ic.addReference(r.key,t),zv(e,r)):r instanceof Cv?(Vu("SyncEngine","Document no longer in limbo: "+r.key),e.Ic.removeReference(r.key,t),e.Ic.containsKey(r.key)||Bv(e,r.key)):zu()}function zv(e,t){const n=t.key,r=n.path.canonicalString();e.gc.get(n)||e.mc.has(r)||(Vu("SyncEngine","New document in limbo: "+n),e.mc.add(r),Gv(e))}function Gv(e){for(;e.mc.size>0&&e.gc.size<e.maxConcurrentLimboResolutions;){const t=e.mc.values().next().value;e.mc.delete(t);const n=new pl(hl.fromString(t)),r=e.Ac.next();e.yc.set(r,new Dv(n)),e.gc=e.gc.insert(n,r),Ly(e.remoteStore,new nm(Qd(zd(n.path)),r,"TargetPurposeLimboResolution",Vl.ct))}}async function Wv(e,t,n){const r=Wu(e),i=[],s=[],o=[];r.wc.isEmpty()||(r.wc.forEach(((e,a)=>{o.push(r.Rc(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=Gg.Li(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.dc.nu(i),await async function(e,t){const n=Wu(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Al.forEach(t,(t=>Al.forEach(t.Fi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Al.forEach(t.Bi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Rl(e))throw e;Vu("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ji.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.Ji=n.Ji.insert(t,i)}}}(r.localStore,s))}async function $v(e,t){const n=Wu(e);if(!n.currentUser.isEqual(t)){Vu("SyncEngine","User change. New user:",t.toKey());const e=await Hg(n.localStore,t);n.currentUser=t,function(e,t){e.Ec.forEach((e=>{e.forEach((e=>{e.reject(new Ku($u.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ec.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Wv(n,e.er)}}function Kv(e,t){const n=Wu(e),r=n.yc.get(t);if(r&&r.fc)return yf().add(r.key);{let e=yf();const r=n._c.get(t);if(!r)return e;for(const t of r){const r=n.wc.get(t);e=e.unionWith(r.view.nc)}return e}}async function Hv(e,t){const n=Wu(e),r=await ey(n.localStore,t.query,!0),i=t.view.hc(r);return n.isPrimaryClient&&qv(n,t.targetId,i.cc),i}async function Qv(e,t){const n=Wu(e);return ny(n.localStore,t).then((e=>Wv(n,e)))}async function Jv(e,t,n,r){const i=Wu(e),s=await function(e,t){const n=Wu(e),r=Wu(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.Sn(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):Al.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await Hy(i.remoteStore):"acknowledged"===n||"rejected"===n?(Vv(i,t,r||null),Uv(i,t),function(e,t){Wu(Wu(e).mutationQueue).Cn(t)}(i.localStore,t)):zu(),await Wv(i,s)):Vu("SyncEngine","Cannot apply mutation batch with id: "+t)}async function Xv(e,t,n){const r=Wu(e),i=[],s=[];for(const e of t){let t;const n=r._c.get(e);if(n&&0!==n.length){t=await Yg(r.localStore,Qd(n[0]));for(const e of n){const t=r.wc.get(e),n=await Hv(r,t);n.snapshot&&s.push(n.snapshot)}}else{const n=await ty(r.localStore,e);t=await Yg(r.localStore,n),await Nv(r,Yv(n),e,!1,t.resumeToken)}i.push(t)}return r.dc.nu(s),i}function Yv(e){return qd(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Zv(e){const t=Wu(e);return Wu(Wu(t.localStore).persistence).$i()}async function ew(e,t,n,r){const i=Wu(e);if(i.vc)return void Vu("SyncEngine","Ignoring unexpected query state notification.");const s=i._c.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await ny(i.localStore,nf(s[0])),r=pp.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,kh.EMPTY_BYTE_STRING);await Wv(i,e,r);break}case"rejected":await Zg(i.localStore,t,!0),jv(i,t,r);break;default:zu()}}async function tw(e,t,n){const r=nw(e);if(r.vc){for(const e of t){if(r._c.has(e)){Vu("SyncEngine","Adding an already active target "+e);continue}const t=await ty(r.localStore,e),n=await Yg(r.localStore,t);await Nv(r,Yv(t),n.targetId,!1,n.resumeToken),Ly(r.remoteStore,n)}for(const e of n)r._c.has(e)&&await Zg(r.localStore,e,!1).then((()=>{Fy(r.remoteStore,e),jv(r,e)})).catch(Sl)}}function nw(e){const t=Wu(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ov.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Kv.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Lv.bind(null,t),t.dc.nu=gv.bind(null,t.eventManager),t.dc.Pc=yv.bind(null,t.eventManager),t}function rw(e){const t=Wu(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Fv.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Mv.bind(null,t),t}class iw{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Cy(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Kg(this.persistence,new Wg,e.initialUser,this.serializer)}createPersistence(e){return new xg(Fg.zs,this.serializer)}createSharedClientState(e){return new py}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class sw extends iw{constructor(e,t,n){super(),this.Vc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Vc.initialize(this,e),await rw(this.Vc.syncEngine),await Hy(this.Vc.remoteStore),await this.persistence.Ii((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(e){return Kg(this.persistence,new Wg,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new hg(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new Ul(t,this.persistence);return new Ml(e.asyncQueue,n)}createPersistence(e){const t=zg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Jm.withCacheSize(this.cacheSizeBytes):Jm.DEFAULT;return new jg(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Ty(),Ey(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new py}}class ow extends sw{constructor(e,t){super(e,t,!1),this.Vc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Vc.syncEngine;this.sharedClientState instanceof fy&&(this.sharedClientState.syncEngine={jr:Jv.bind(null,t),zr:ew.bind(null,t),Wr:tw.bind(null,t),$i:Zv.bind(null,t),Qr:Qv.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ii((async e=>{await async function(e,t){const n=Wu(e);if(nw(n),rw(n),!0===t&&!0!==n.vc){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await Xv(n,e.toArray());n.vc=!0,await iv(n.remoteStore,!0);for(const e of t)Ly(n.remoteStore,e)}else if(!1===t&&!1!==n.vc){const e=[];let t=Promise.resolve();n._c.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(jv(n,i),Zg(n.localStore,i,!0)))),Fy(n.remoteStore,i)})),await t,await Xv(n,e),function(e){const t=Wu(e);t.yc.forEach(((e,n)=>{Fy(t.remoteStore,n)})),t.Ic.Ts(),t.yc=new Map,t.gc=new Ih(pl.comparator)}(n),n.vc=!1,await iv(n.remoteStore,!1)}}(this.Vc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}createSharedClientState(e){const t=Ty();if(!fy.D(t))throw new Ku($u.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=zg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new fy(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class aw{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>xv(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=$v.bind(null,this.syncEngine),await iv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new fv}createDatastore(e){const t=Cy(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new by(r));var r;return function(e,t,n,r){return new Py(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>xv(this.syncEngine,e,0),s=gy.D()?new gy:new my,new Ry(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new kv(e,t,n,r,i,s);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Wu(e);Vu("RemoteStore","RemoteStore shutting down."),t.vu.add(5),await xy(t),t.Pu.shutdown(),t.bu.set("Unknown")}(this.remoteStore)}}function cw(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class uw{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):ju("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class lw{constructor(e,t){this.Cc=e,this.serializer=t,this.metadata=new Hu,this.buffer=new Uint8Array,this.xc=new TextDecoder("utf-8"),this.Nc().then((e=>{e&&e.Qu()?this.metadata.resolve(e.Gu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.Gu)}`))}),(e=>this.metadata.reject(e)))}close(){return this.Cc.cancel()}async getMetadata(){return this.metadata.promise}async bc(){return await this.getMetadata(),this.Nc()}async Nc(){const e=await this.kc();if(null===e)return null;const t=this.xc.decode(e),n=Number(t);isNaN(n)&&this.Mc(`length string (${t}) is not valid number`);const r=await this.$c(n);return new _v(JSON.parse(r),e.length+n)}Oc(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async kc(){for(;this.Oc()<0&&!await this.Fc(););if(0===this.buffer.length)return null;const e=this.Oc();e<0&&this.Mc("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $c(e){for(;this.buffer.length<e;)await this.Fc()&&this.Mc("Reached the end of bundle when more is expected.");const t=this.xc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Mc(e){throw this.Cc.cancel(),new Error(`Invalid bundle format: ${e}`)}async Fc(){const e=await this.Cc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class hw{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Ku($u.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=Wu(e),r=Up(n.serializer)+"/documents",i={documents:t.map((e=>xp(n.serializer,e)))},s=await n.vo("BatchGetDocuments",r,i,t.length),o=new Map;s.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){Gu(!!t.found),t.found.name,t.found.updateTime;const n=Lp(e,t.found.name),r=Np(t.found.updateTime),i=t.found.createTime?Np(t.found.createTime):ul.min(),s=new od({mapValue:{fields:t.found.fields}});return cd.newFoundDocument(n,r,i,s)}(e,t):"missing"in t?function(e,t){Gu(!!t.missing),Gu(!!t.readTime);const n=Lp(e,t.missing),r=Np(t.readTime);return cd.newNoDocument(n,r)}(e,t):zu()}(n.serializer,e);o.set(t.key.toString(),t)}));const a=[];return t.forEach((e=>{const t=o.get(e.toString());Gu(!!t),a.push(t)})),a}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Jf(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=pl.fromPath(t);this.mutations.push(new Xf(n,this.precondition(n)))})),await async function(e,t){const n=Wu(e),r=Up(n.serializer)+"/documents",i={writes:t.map((e=>qp(n.serializer,e)))};await n.Io("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw zu();t=ul.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Ku($u.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ul.min())?Mf.exists(!1):Mf.updateTime(t):Mf.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ul.min()))throw new Ku($u.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Mf.updateTime(t)}return Mf.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class dw{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Bc=n.maxAttempts,this.qo=new Sy(this.asyncQueue,"transaction_retry")}run(){this.Bc-=1,this.Lc()}Lc(){this.qo.No((async()=>{const e=new hw(this.datastore),t=this.qc(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.Uc(e)}))))})).catch((e=>{this.Uc(e)}))}))}qc(e){try{const t=this.updateFunction(e);return!jl(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Uc(e){this.Bc>0&&this.Kc(e)?(this.Bc-=1,this.asyncQueue.enqueueAndForget((()=>(this.Lc(),Promise.resolve())))):this.deferred.reject(e)}Kc(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!ip(t)}return!1}}class fw{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Lu.UNAUTHENTICATED,this.clientId=il.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Vu("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Vu("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Ku($u.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Hu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=cv(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function pw(e,t){e.asyncQueue.verifyOperationInProgress(),Vu("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Hg(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function mw(e,t){e.asyncQueue.verifyOperationInProgress();const n=await yw(e);Vu("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>rv(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>rv(t.remoteStore,n))),e._onlineComponents=t}function gw(e){return"FirebaseError"===e.name?e.code===$u.FAILED_PRECONDITION||e.code===$u.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function yw(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Vu("FirestoreClient","Using user provided OfflineComponentProvider");try{await pw(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!gw(n))throw n;Bu("Error using user provided cache. Falling back to memory cache: "+n),await pw(e,new iw)}}else Vu("FirestoreClient","Using default OfflineComponentProvider"),await pw(e,new iw);return e._offlineComponents}async function vw(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Vu("FirestoreClient","Using user provided OnlineComponentProvider"),await mw(e,e._uninitializedComponentsProvider._online)):(Vu("FirestoreClient","Using default OnlineComponentProvider"),await mw(e,new aw))),e._onlineComponents}function ww(e){return yw(e).then((e=>e.persistence))}function _w(e){return yw(e).then((e=>e.localStore))}function Iw(e){return vw(e).then((e=>e.remoteStore))}function bw(e){return vw(e).then((e=>e.syncEngine))}async function Tw(e){const t=await vw(e),n=t.eventManager;return n.onListen=Pv.bind(null,t.syncEngine),n.onUnlisten=Rv.bind(null,t.syncEngine),n}function Ew(e,t,n={}){const r=new Hu;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new uw({next:s=>{t.enqueueAndForget((()=>mv(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new Ku($u.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Ku($u.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new wv(zd(n.path),s,{includeMetadataChanges:!0,Ku:!0});return pv(e,o)}(await Tw(e),e.asyncQueue,t,n,r))),r.promise}function Cw(e,t,n={}){const r=new Hu;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new uw({next:n=>{t.enqueueAndForget((()=>mv(e,o))),n.fromCache&&"server"===r.source?i.reject(new Ku($u.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new wv(n,s,{includeMetadataChanges:!0,Ku:!0});return pv(e,o)}(await Tw(e),e.asyncQueue,t,n,r))),r.promise}function Sw(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Aw=new Map;function Dw(e,t,n){if(!n)throw new Ku($u.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function kw(e,t,n,r){if(!0===t&&!0===r)throw new Ku($u.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Pw(e){if(!pl.isDocumentKey(e))throw new Ku($u.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Nw(e){if(pl.isDocumentKey(e))throw new Ku($u.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Rw(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":zu()}function Ow(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Ku($u.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Rw(e);throw new Ku($u.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function xw(e,t){if(t<=0)throw new Ku($u.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Lw{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new Ku($u.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Ku($u.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}kw("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Sw(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Ku($u.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new Ku($u.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new Ku($u.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class Fw{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Lw({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Ku($u.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Ku($u.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Lw(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Ju;switch(e.type){case"firstParty":return new el(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Ku($u.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Aw.get(e);t&&(Vu("ComponentProvider","Removing Datastore"),Aw.delete(e),t.terminate())}(this),Promise.resolve()}}class Mw{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Vw(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Mw(this.firestore,e,this._key)}}class Uw{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Uw(this.firestore,e,this._query)}}class Vw extends Uw{constructor(e,t,n){super(e,t,zd(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Mw(this.firestore,null,new pl(e))}withConverter(e){return new Vw(this.firestore,e,this._path)}}function jw(e,t,...n){if(e=k(e),Dw("collection","path",t),e instanceof Fw){const r=hl.fromString(t,...n);return Nw(r),new Vw(e,null,r)}{if(!(e instanceof Mw||e instanceof Vw))throw new Ku($u.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(hl.fromString(t,...n));return Nw(r),new Vw(e.firestore,null,r)}}function Bw(e,t,...n){if(e=k(e),1===arguments.length&&(t=il.A()),Dw("doc","path",t),e instanceof Fw){const r=hl.fromString(t,...n);return Pw(r),new Mw(e,null,new pl(r))}{if(!(e instanceof Mw||e instanceof Vw))throw new Ku($u.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(hl.fromString(t,...n));return Pw(r),new Mw(e.firestore,e instanceof Vw?e.converter:null,new pl(r))}}function qw(e,t){return e=k(e),t=k(t),(e instanceof Mw||e instanceof Vw)&&(t instanceof Mw||t instanceof Vw)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function zw(e,t){return e=k(e),t=k(t),e instanceof Uw&&t instanceof Uw&&e.firestore===t.firestore&&Yd(e._query,t._query)&&e.converter===t.converter}class Gw{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new Sy(this,"async_queue_retry"),this.Xc=()=>{const e=Ey();e&&Vu("AsyncQueue","Visibility state changed to "+e.visibilityState),this.qo.Mo()};const e=Ey();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const t=Ey();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise((()=>{}));const t=new Hu;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Qc.push(e),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!Rl(e))throw e;Vu("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(e){const t=this.Gc.then((()=>(this.Hc=!0,e().catch((e=>{this.Wc=e,this.Hc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw ju("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Hc=!1,e))))));return this.Gc=t,t}enqueueAfterDelay(e,t,n){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);const r=av.createAndSchedule(this,e,t,n,(e=>this.na(e)));return this.zc.push(r),r}Zc(){this.Wc&&zu()}verifyOperationInProgress(){}async sa(){let e;do{e=this.Gc,await e}while(e!==this.Gc)}ia(e){for(const t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then((()=>{this.zc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.zc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()}))}oa(e){this.Yc.push(e)}na(e){const t=this.zc.indexOf(e);this.zc.splice(t,1)}}function Ww(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class $w{constructor(){this._progressObserver={},this._taskCompletionResolver=new Hu,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Kw extends Fw{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Gw,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Qw(this),this._firestoreClient.terminate()}}function Hw(e){return e._firestoreClient||Qw(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Qw(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new Mh(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Sw(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new fw(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.cache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.cache.kind,_offline:i.cache._offlineComponentProvider,_online:i.cache._onlineComponentProvider})}function Jw(e,t,n){const r=new Hu;return e.asyncQueue.enqueue((async()=>{try{await pw(e,n),await mw(e,t),r.resolve()}catch(e){const t=e;if(!gw(t))throw t;Bu("Error enabling indexeddb cache. Falling back to memory cache: "+t),r.reject(t)}})).then((()=>r.promise))}function Xw(e){if(e._initialized||e._terminated)throw new Ku($u.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Yw{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Yw(kh.fromBase64String(e))}catch(e){throw new Ku($u.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Yw(kh.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Zw{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Ku($u.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new fl(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class e_{constructor(e){this._methodName=e}}class t_{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ku($u.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ku($u.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return sl(this._lat,e._lat)||sl(this._long,e._long)}}const n_=/^__.*__$/;class r_{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new $f(e,this.data,this.fieldMask,t,this.fieldTransforms):new Wf(e,this.data,t,this.fieldTransforms)}}class i_{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new $f(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function s_(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw zu()}}class o_{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.ua(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new o_(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.fa(e),r}da(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.ua(),r}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return S_(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(s_(this.ca)&&n_.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class a_{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Cy(e)}ya(e,t,n,r=!1){return new o_({ca:e,methodName:t,ga:n,path:fl.emptyPath(),la:!1,ma:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function c_(e){const t=e._freezeSettings(),n=Cy(e._databaseId);return new a_(e._databaseId,!!t.ignoreUndefinedProperties,n)}function u_(e,t,n,r,i,s={}){const o=e.ya(s.merge||s.mergeFields?2:0,t,n,i);b_("Data must be an object, but it was:",o,r);const a=__(r,o);let c,u;if(s.merge)c=new Ah(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=T_(t,r,n);if(!o.contains(i))throw new Ku($u.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);A_(e,i)||e.push(i)}c=new Ah(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new r_(new od(a),c,u)}class l_ extends e_{_toFieldTransform(e){if(2!==e.ca)throw 1===e.ca?e._a(`${this._methodName}() can only appear at the top level of your update data`):e._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof l_}}function h_(e,t,n){return new o_({ca:3,ga:t.settings.ga,methodName:e._methodName,la:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class d_ extends e_{_toFieldTransform(e){return new Lf(e.path,new Af)}isEqual(e){return e instanceof d_}}class f_ extends e_{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=h_(this,e,!0),n=this.pa.map((e=>w_(e,t))),r=new Df(n);return new Lf(e.path,r)}isEqual(e){return this===e}}class p_ extends e_{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=h_(this,e,!0),n=this.pa.map((e=>w_(e,t))),r=new Pf(n);return new Lf(e.path,r)}isEqual(e){return this===e}}class m_ extends e_{constructor(e,t){super(e),this.Ia=t}_toFieldTransform(e){const t=new Rf(e.serializer,bf(e.serializer,this.Ia));return new Lf(e.path,t)}isEqual(e){return this===e}}function g_(e,t,n,r){const i=e.ya(1,t,n);b_("Data must be an object, but it was:",i,r);const s=[],o=od.empty();wh(r,((e,r)=>{const a=C_(t,e,n);r=k(r);const c=i.da(a);if(r instanceof l_)s.push(a);else{const e=w_(r,c);null!=e&&(s.push(a),o.set(a,e))}}));const a=new Ah(s);return new i_(o,a,i.fieldTransforms)}function y_(e,t,n,r,i,s){const o=e.ya(1,t,n),a=[T_(t,r,n)],c=[i];if(s.length%2!=0)throw new Ku($u.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(T_(t,s[e])),c.push(s[e+1]);const u=[],l=od.empty();for(let e=a.length-1;e>=0;--e)if(!A_(u,a[e])){const t=a[e];let n=c[e];n=k(n);const r=o.da(t);if(n instanceof l_)u.push(t);else{const e=w_(n,r);null!=e&&(u.push(t),l.set(t,e))}}const h=new Ah(u);return new i_(l,h,o.fieldTransforms)}function v_(e,t,n,r=!1){return w_(n,e.ya(r?4:3,t))}function w_(e,t){if(I_(e=k(e)))return b_("Unsupported field value:",t,e),__(e,t);if(e instanceof e_)return function(e,t){if(!s_(t.ca))throw t._a(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t._a(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.la&&4!==t.ca)throw t._a("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=w_(i,t.wa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=k(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return bf(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=cl.fromDate(e);return{timestampValue:Dp(t.serializer,n)}}if(e instanceof cl){const n=new cl(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Dp(t.serializer,n)}}if(e instanceof t_)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Yw)return{bytesValue:kp(t.serializer,e._byteString)};if(e instanceof Mw){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t._a(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Rp(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t._a(`Unsupported field value: ${Rw(e)}`)}(e,t)}function __(e,t){const n={};return _h(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):wh(e,((e,r)=>{const i=w_(r,t.ha(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function I_(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof cl||e instanceof t_||e instanceof Yw||e instanceof Mw||e instanceof e_)}function b_(e,t,n){if(!I_(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Rw(n);throw"an object"===r?t._a(e+" a custom object"):t._a(e+" "+r)}}function T_(e,t,n){if((t=k(t))instanceof Zw)return t._internalPath;if("string"==typeof t)return C_(e,t);throw S_("Field path arguments must be of type string or ",e,!1,void 0,n)}const E_=new RegExp("[~\\*/\\[\\]]");function C_(e,t,n){if(t.search(E_)>=0)throw S_(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Zw(...t.split("."))._internalPath}catch(r){throw S_(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function S_(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Ku($u.INVALID_ARGUMENT,a+e+c)}function A_(e,t){return e.some((e=>e.isEqual(t)))}class D_{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Mw(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new k_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(P_("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class k_ extends D_{data(){return super.data()}}function P_(e,t){return"string"==typeof t?C_(e,t):t instanceof Zw?t._internalPath:t._delegate._internalPath}function N_(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Ku($u.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class R_{}class O_ extends R_{}function x_(e,t,...n){let r=[];t instanceof R_&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof F_)).length,n=e.filter((e=>e instanceof L_)).length;if(t>1||t>0&&n>0)throw new Ku($u.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class L_ extends O_{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new L_(e,t,n)}_apply(e){const t=this._parse(e);return G_(e._query,t),new Uw(e.firestore,e.converter,Jd(e._query,t))}_parse(e){const t=c_(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Ku($u.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){z_(o,s);const t=[];for(const n of o)t.push(q_(r,e,n));a={arrayValue:{values:t}}}else a=q_(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||z_(o,s),a=v_(n,"where",o,"in"===s||"not-in"===s);return md.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class F_ extends R_{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new F_(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:gd.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)G_(n,e),n=Jd(n,e)}(e._query,t),new Uw(e.firestore,e.converter,Jd(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class M_ extends O_{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new M_(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new Ku($u.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Ku($u.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new dd(t,n);return function(e,t){if(null===Wd(e)){const n=$d(e);null!==n&&W_(0,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new Uw(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Bd(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class U_ extends O_{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new U_(e,t,n)}_apply(e){return new Uw(e.firestore,e.converter,Xd(e._query,this._limit,this._limitType))}}class V_ extends O_{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new V_(e,t,n)}_apply(e){const t=B_(e,this.type,this._docOrFields,this._inclusive);return new Uw(e.firestore,e.converter,function(e,t){return new Bd(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class j_ extends O_{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new j_(e,t,n)}_apply(e){const t=B_(e,this.type,this._docOrFields,this._inclusive);return new Uw(e.firestore,e.converter,function(e,t){return new Bd(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function B_(e,t,n,r){if(n[0]=k(n[0]),n[0]instanceof D_)return function(e,t,n,r,i){if(!r)throw new Ku($u.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Hd(e))if(n.field.isKeyField())s.push(Hh(t,r.key));else{const e=r.data.field(n.field);if(xh(e))throw new Ku($u.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new Ku($u.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new ud(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=c_(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new Ku($u.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new Ku($u.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Kd(e)&&-1!==c.indexOf("/"))throw new Ku($u.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(hl.fromString(c));if(!pl.isDocumentKey(n))throw new Ku($u.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new pl(n);a.push(Hh(t,i))}else{const e=v_(n,r,c);a.push(e)}}return new ud(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function q_(e,t,n){if("string"==typeof(n=k(n))){if(""===n)throw new Ku($u.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Kd(t)&&-1!==n.indexOf("/"))throw new Ku($u.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(hl.fromString(n));if(!pl.isDocumentKey(r))throw new Ku($u.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Hh(e,new pl(r))}if(n instanceof Mw)return Hh(e,n._key);throw new Ku($u.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Rw(n)}.`)}function z_(e,t){if(!Array.isArray(e)||0===e.length)throw new Ku($u.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function G_(e,t){if(t.isInequality()){const n=$d(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new Ku($u.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);const i=Wd(e);null!==i&&W_(0,r,i)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new Ku($u.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Ku($u.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function W_(e,t,n){if(!n.isEqual(t))throw new Ku($u.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class $_{convertValue(e,t="none"){switch(Bh(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Rh(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Oh(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw zu()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return wh(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new t_(Rh(e.latitude),Rh(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Lh(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Fh(e));default:return null}}convertTimestamp(e){const t=Nh(e);return new cl(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=hl.fromString(e);Gu(tm(n));const r=new Uh(n.get(1),n.get(3)),i=new pl(n.popFirst(5));return r.isEqual(t)||ju(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function K_(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class H_ extends $_{constructor(e){super(),this.firestore=e}convertBytes(e){return new Yw(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Mw(this.firestore,null,t)}}class Q_{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class J_ extends D_{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new X_(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(P_("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class X_ extends J_{data(e={}){return super.data(e)}}class Y_{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Q_(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new X_(this._firestore,this._userDataWriter,n.key,n,new Q_(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ku($u.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new X_(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Q_(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new X_(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Q_(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Z_(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Z_(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return zu()}}function eI(e,t){return e instanceof J_&&t instanceof J_?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Y_&&t instanceof Y_&&e._firestore===t._firestore&&zw(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class tI extends $_{constructor(e){super(),this.firestore=e}convertBytes(e){return new Yw(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Mw(this.firestore,null,t)}}function nI(e,t,n){e=Ow(e,Mw);const r=Ow(e.firestore,Kw),i=K_(e.converter,t,n);return sI(r,[u_(c_(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Mf.none())])}function rI(e,t,n,...r){e=Ow(e,Mw);const i=Ow(e.firestore,Kw),s=c_(i);let o;return o="string"==typeof(t=k(t))||t instanceof Zw?y_(s,"updateDoc",e._key,t,n,r):g_(s,"updateDoc",e._key,t),sI(i,[o.toMutation(e._key,Mf.exists(!0))])}function iI(e,...t){var n,r,i;e=k(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||Ww(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(Ww(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let c,u,l;if(e instanceof Mw)u=Ow(e.firestore,Kw),l=zd(e._key.path),c={next:n=>{t[o]&&t[o](oI(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Ow(e,Uw);u=Ow(n.firestore,Kw),l=n._query;const r=new tI(u);c={next:e=>{t[o]&&t[o](new Y_(u,r,n,e))},error:t[o+1],complete:t[o+2]},N_(e._query)}return function(e,t,n,r){const i=new uw(r),s=new wv(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>pv(await Tw(e),s))),()=>{i.Dc(),e.asyncQueue.enqueueAndForget((async()=>mv(await Tw(e),s)))}}(Hw(u),l,a,c)}function sI(e,t){return function(e,t){const n=new Hu;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=rw(e);try{const e=await function(e,t){const n=Wu(e),r=cl.now(),i=t.reduce(((e,t)=>e.add(t.key)),yf());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=cf(),c=yf();return n.Zi.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=zf(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new $f(e.key,t,ad(t.value.mapValue),Mf.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:hf(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Tc[e.currentUser.toKey()];r||(r=new Ih(sl)),r=r.insert(t,n),e.Tc[e.currentUser.toKey()]=r}(r,e.batchId,n),await Wv(r,e.changes),await Hy(r.remoteStore)}catch(e){const t=cv(e,"Failed to persist write");n.reject(t)}}(await bw(e),t,n))),n.promise}(Hw(e),t)}function oI(e,t,n){const r=n.docs.get(t._key),i=new tI(e);return new J_(e,i,t._key,r,new Q_(n.hasPendingWrites,n.fromCache),t.converter)}const aI={maxAttempts:5};class cI{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=c_(e)}set(e,t,n){this._verifyNotCommitted();const r=uI(e,this._firestore),i=K_(r.converter,t,n),s=u_(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Mf.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=uI(e,this._firestore);let s;return s="string"==typeof(t=k(t))||t instanceof Zw?y_(this._dataReader,"WriteBatch.update",i._key,t,n,r):g_(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Mf.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=uI(e,this._firestore);return this._mutations=this._mutations.concat(new Jf(t._key,Mf.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Ku($u.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function uI(e,t){if((e=k(e)).firestore!==t)throw new Ku($u.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class lI extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=c_(e)}get(e){const t=uI(e,this._firestore),n=new H_(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return zu();const r=e[0];if(r.isFoundDocument())return new D_(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new D_(this._firestore,n,t._key,null,t.converter);throw zu()}))}set(e,t,n){const r=uI(e,this._firestore),i=K_(r.converter,t,n),s=u_(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=uI(e,this._firestore);let s;return s="string"==typeof(t=k(t))||t instanceof Zw?y_(this._dataReader,"Transaction.update",i._key,t,n,r):g_(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=uI(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=uI(e,this._firestore),n=new tI(this._firestore);return super.get(e).then((e=>new J_(this._firestore,n,t._key,e._document,new Q_(!1,!1),t.converter)))}}function hI(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Ku("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function dI(){if("undefined"==typeof Uint8Array)throw new Ku("unimplemented","Uint8Arrays are not available in this environment.")}function fI(){if("undefined"==typeof atob)throw new Ku("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){!function(e){Fu=e}(_e),pe(new P("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new Kw(new Yu(e.getProvider("auth-internal")),new nl(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Ku($u.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Uh(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Ce(xu,"3.13.0",e),Ce(xu,"3.13.0","esm2017")}();class pI{constructor(e){this._delegate=e}static fromBase64String(e){return fI(),new pI(Yw.fromBase64String(e))}static fromUint8Array(e){return dI(),new pI(Yw.fromUint8Array(e))}toBase64(){return fI(),this._delegate.toBase64()}toUint8Array(){return dI(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function mI(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class gI{enableIndexedDbPersistence(e,t){return function(e,t){Xw(e=Ow(e,Kw));const n=Hw(e);if(n._uninitializedComponentsProvider)throw new Ku($u.FAILED_PRECONDITION,"SDK cache is already specified.");Bu("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=e._freezeSettings(),i=new aw;return Jw(n,i,new sw(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){Xw(e=Ow(e,Kw));const t=Hw(e);if(t._uninitializedComponentsProvider)throw new Ku($u.FAILED_PRECONDITION,"SDK cache is already specified.");Bu("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings(),r=new aw;return Jw(t,r,new ow(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new Ku($u.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Hu;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!kl.D())return Promise.resolve();const t=e+"main";await kl.delete(t)}(zg(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}(e._delegate)}}class yI{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Uh||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||Bu("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(e,t,n,r={}){var i;const o=(e=Ow(e,Fw))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&Bu("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Lu.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new Ku($u.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Lu(o)}e._authCredentials=new Xu(new Qu(t,n))}}(this._delegate,e,t,n)}enableNetwork(){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await ww(e),n=await Iw(e);return t.setNetworkEnabled(!0),function(e){const t=Wu(e);return t.vu.delete(0),Oy(t)}(n)}))}(Hw(Ow(this._delegate,Kw)))}disableNetwork(){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await ww(e),n=await Iw(e);return t.setNetworkEnabled(!1),async function(e){const t=Wu(e);t.vu.add(0),await xy(t),t.bu.set("Offline")}(n)}))}(Hw(Ow(this._delegate,Kw)))}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,kw("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(e){const t=new Hu;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=Wu(e);By(n.remoteStore)||Vu("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=Wu(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.Ec.get(e)||[];r.push(t),n.Ec.set(e,r)}catch(e){const n=cv(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await bw(e),t))),t.promise}(Hw(Ow(this._delegate,Kw)))}onSnapshotsInSync(e){return t=this._delegate,n=e,function(e,t){const n=new uw(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){Wu(e).ku.add(t),t.next()}(await Tw(e),n))),()=>{n.Dc(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){Wu(e).ku.delete(t)}(await Tw(e),n)))}}(Hw(t=Ow(t,Kw)),Ww(n)?n:{next:n});var t,n}get app(){if(!this._appCompat)throw new Ku("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new NI(this,jw(this._delegate,e))}catch(e){throw TI(e,"collection()","Firestore.collection()")}}doc(e){try{return new bI(this,Bw(this._delegate,e))}catch(e){throw TI(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new DI(this,function(e,t){if(e=Ow(e,Fw),Dw("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Ku($u.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Uw(e,null,function(e){return new Bd(hl.emptyPath(),e)}(t))}(this._delegate,e))}catch(e){throw TI(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(e,t,n){e=Ow(e,Kw);const r=Object.assign(Object.assign({},aI),void 0);return function(e){if(e.maxAttempts<1)throw new Ku($u.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new Hu;return e.asyncQueue.enqueueAndForget((async()=>{const i=await function(e){return vw(e).then((e=>e.datastore))}(e);new dw(e.asyncQueue,i,n,t,r).run()})),r.promise}(Hw(e),(n=>t(new lI(e,n))),r)}(this._delegate,(t=>e(new wI(this,t))))}batch(){return Hw(this._delegate),new _I(new cI(this._delegate,(e=>sI(this._delegate,e))))}loadBundle(e){return function(e,t){const n=Hw(e=Ow(e,Kw)),r=new $w;return function(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?cp().encode(e):e,function(e,t){return new lw(e,t)}(function(e,t){if(e instanceof Uint8Array)return cw(e,t);if(e instanceof ArrayBuffer)return cw(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,Cy(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=Wu(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=Wu(e),r=Np(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.qs.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(Tv(r));const i=new bv(r,e.localStore,t.serializer);let s=await t.bc();for(;s;){const e=await i.zu(s);e&&n._updateProgress(e),s=await t.bc()}const o=await i.complete();return await Wv(e,o.Ju,void 0),await function(e,t){const n=Wu(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.qs.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.Hu)}catch(e){return Bu("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then((e=>{r.sharedClientState.notifyBundleLoaded(e)}))}(await bw(e),i,r)}))}(n,e._databaseId,t,r),r}(this._delegate,e)}namedQuery(e){return(t=this._delegate,n=e,function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=Wu(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.qs.getNamedQuery(e,t)))}(await _w(e),t)))}(Hw(t=Ow(t,Kw)),n).then((e=>e?new Uw(t,null,e.query):null))).then((e=>e?new DI(this,e):null));var t,n}}class vI extends $_{constructor(e){super(),this.firestore=e}convertBytes(e){return new pI(new Yw(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return bI.forKey(t,this.firestore,null)}}class wI{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new vI(e)}get(e){const t=RI(e);return this._delegate.get(t).then((e=>new SI(this._firestore,new J_(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,t,n){const r=RI(e);return n?(hI("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=RI(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=RI(e);return this._delegate.delete(t),this}}class _I{constructor(e){this._delegate=e}set(e,t,n){const r=RI(e);return n?(hI("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=RI(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=RI(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class II{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new X_(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new AI(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=II.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new II(e,new vI(e),t),r.set(t,i)),i}}II.INSTANCES=new WeakMap;class bI{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new vI(e)}static forPath(e,t,n){if(e.length%2!=0)throw new Ku("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new bI(t,new Mw(t._delegate,n,new pl(e)))}static forKey(e,t,n){return new bI(t,new Mw(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new NI(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new NI(this.firestore,jw(this._delegate,e))}catch(e){throw TI(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=k(e))instanceof Mw&&qw(this._delegate,e)}set(e,t){t=hI("DocumentReference.set",t);try{return t?nI(this._delegate,e,t):nI(this._delegate,e)}catch(e){throw TI(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?rI(this._delegate,e):rI(this._delegate,e,t,...n)}catch(e){throw TI(e,"updateDoc()","DocumentReference.update()")}}delete(){return sI(Ow((e=this._delegate).firestore,Kw),[new Jf(e._key,Mf.none())]);var e}onSnapshot(...e){const t=EI(e),n=CI(e,(e=>new SI(this.firestore,new J_(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return iI(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=Ow(e,Mw);const t=Ow(e.firestore,Kw),n=Hw(t),r=new tI(t);return function(e,t){const n=new Hu;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=Wu(e);return n.persistence.runTransaction("read document","readonly",(e=>n.localDocuments.getDocument(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new Ku($u.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=cv(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await _w(e),t,n))),n.promise}(n,e._key).then((n=>new J_(t,r,e._key,n,new Q_(null!==n&&n.hasLocalMutations,!0),e.converter)))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Ow(e,Mw);const t=Ow(e.firestore,Kw);return Ew(Hw(t),e._key,{source:"server"}).then((n=>oI(t,e,n)))}(this._delegate):function(e){e=Ow(e,Mw);const t=Ow(e.firestore,Kw);return Ew(Hw(t),e._key).then((n=>oI(t,e,n)))}(this._delegate),t.then((e=>new SI(this.firestore,new J_(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new bI(this.firestore,e?this._delegate.withConverter(II.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function TI(e,t,n){return e.message=e.message.replace(t,n),e}function EI(e){for(const t of e)if("object"==typeof t&&!mI(t))return t;return{}}function CI(e,t){var n,r;let i;return i=mI(e[0])?e[0]:mI(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class SI{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new bI(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return eI(this._delegate,e._delegate)}}class AI extends SI{data(e){const t=this._delegate.data(e);return void 0!==t||zu(),t}}class DI{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new vI(e)}where(e,t,n){try{return new DI(this.firestore,x_(this._delegate,function(e,t,n){const r=t,i=P_("where",e);return L_._create(i,r,n)}(e,t,n)))}catch(e){throw TI(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new DI(this.firestore,x_(this._delegate,function(e,t="asc"){const n=t,r=P_("orderBy",e);return M_._create(r,n)}(e,t)))}catch(e){throw TI(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new DI(this.firestore,x_(this._delegate,(xw("limit",t=e),U_._create("limit",t,"F"))))}catch(e){throw TI(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new DI(this.firestore,x_(this._delegate,(xw("limitToLast",t=e),U_._create("limitToLast",t,"L"))))}catch(e){throw TI(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new DI(this.firestore,x_(this._delegate,function(...e){return V_._create("startAt",e,!0)}(...e)))}catch(e){throw TI(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new DI(this.firestore,x_(this._delegate,function(...e){return V_._create("startAfter",e,!1)}(...e)))}catch(e){throw TI(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new DI(this.firestore,x_(this._delegate,function(...e){return j_._create("endBefore",e,!1)}(...e)))}catch(e){throw TI(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new DI(this.firestore,x_(this._delegate,function(...e){return j_._create("endAt",e,!0)}(...e)))}catch(e){throw TI(e,"endAt()","Query.endAt()")}}isEqual(e){return zw(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=Ow(e,Uw);const t=Ow(e.firestore,Kw),n=Hw(t),r=new tI(t);return function(e,t){const n=new Hu;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await ey(e,t,!0),i=new Sv(t,r.ir),s=i.sc(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=cv(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await _w(e),t,n))),n.promise}(n,e._query).then((n=>new Y_(t,r,e,n)))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Ow(e,Uw);const t=Ow(e.firestore,Kw),n=Hw(t),r=new tI(t);return Cw(n,e._query,{source:"server"}).then((n=>new Y_(t,r,e,n)))}(this._delegate):function(e){e=Ow(e,Uw);const t=Ow(e.firestore,Kw),n=Hw(t),r=new tI(t);return N_(e._query),Cw(n,e._query).then((n=>new Y_(t,r,e,n)))}(this._delegate),t.then((e=>new PI(this.firestore,new Y_(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){const t=EI(e),n=CI(e,(e=>new PI(this.firestore,new Y_(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return iI(this._delegate,t,n)}withConverter(e){return new DI(this.firestore,e?this._delegate.withConverter(II.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class kI{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new AI(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class PI{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new DI(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new AI(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new kI(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new AI(this._firestore,n))}))}isEqual(e){return eI(this._delegate,e._delegate)}}class NI extends DI{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new bI(this.firestore,e):null}doc(e){try{return new bI(this.firestore,void 0===e?Bw(this._delegate):Bw(this._delegate,e))}catch(e){throw TI(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Ow(e.firestore,Kw),r=Bw(e),i=K_(e.converter,t);return sI(n,[u_(c_(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Mf.exists(!1))]).then((()=>r))}(this._delegate,e).then((e=>new bI(this.firestore,e)))}isEqual(e){return qw(this._delegate,e._delegate)}withConverter(e){return new NI(this.firestore,e?this._delegate.withConverter(II.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function RI(e){return Ow(e,Mw)}class OI{constructor(...e){this._delegate=new Zw(...e)}static documentId(){return new OI(fl.keyField().canonicalString())}isEqual(e){return(e=k(e))instanceof Zw&&this._delegate._internalPath.isEqual(e._internalPath)}}class xI{constructor(e){this._delegate=e}static serverTimestamp(){const e=new d_("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new xI(e)}static delete(){const e=new l_("deleteField");return e._methodName="FieldValue.delete",new xI(e)}static arrayUnion(...e){const t=function(...e){return new f_("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new xI(t)}static arrayRemove(...e){const t=function(...e){return new p_("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new xI(t)}static increment(e){const t=new m_("increment",e);return t._methodName="FieldValue.increment",new xI(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const LI={Firestore:yI,GeoPoint:t_,Timestamp:cl,Blob:pI,Transaction:wI,WriteBatch:_I,DocumentReference:bI,DocumentSnapshot:SI,Query:DI,QueryDocumentSnapshot:AI,QuerySnapshot:PI,CollectionReference:NI,FieldPath:OI,FieldValue:xI,setLogLevel:function(e){var t;t=e,Mu.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};!function(e){!function(e,t){e.INTERNAL.registerComponent(new P("firestore-compat",(e=>((e,t)=>new yI(e,t,new gI))(e.getProvider("app-compat").getImmediate(),e.getProvider("firestore").getImmediate())),"PUBLIC").setServiceProps(Object.assign({},LI)))}(e),e.registerVersion("@firebase/firestore-compat","0.3.12")}(ze),console.log("Loaded!",{ALLUSERSPROFILE:"C:\\ProgramData",APPDATA:"C:\\Users\\tanuj\\AppData\\Roaming",ChocolateyInstall:"C:\\ProgramData\\chocolatey",ChocolateyLastPathUpdate:"133002477445968421",COLOR:"1",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"TANUJS-PC",ComSpec:"C:\\Windows\\system32\\cmd.exe",CUDA_PATH:"C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8",CUDA_PATH_V11_8:"C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EDITOR:"C:\\Windows\\notepad.exe",HOME:"C:\\Users\\tanuj",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\tanuj",INIT_CWD:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend",JAVA_HOME:"C:\\Program Files (x86)\\Eclipse Adoptium\\jdk-16.0.2.7-hotspot\\",LOCALAPPDATA:"C:\\Users\\tanuj\\AppData\\Local",LOGONSERVER:"\\\\TANUJS-PC",NODE:"C:\\Program Files\\nodejs\\node.exe",NODE_EXE:"C:\\Program Files\\nodejs\\\\node.exe",NPM_CLI_JS:"C:\\Program Files\\nodejs\\\\node_modules\\npm\\bin\\npm-cli.js",npm_command:"exec",npm_config_cache:"C:\\Users\\tanuj\\AppData\\Local\\npm-cache",npm_config_globalconfig:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\etc\\npmrc",npm_config_global_prefix:"C:\\Users\\tanuj\\AppData\\Roaming\\npm",npm_config_init_module:"C:\\Users\\tanuj\\.npm-init.js",npm_config_local_prefix:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend",npm_config_metrics_registry:"https://registry.npmjs.org/",npm_config_node_gyp:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js",npm_config_noproxy:"",npm_config_prefix:"C:\\Users\\tanuj\\AppData\\Roaming\\npm",npm_config_userconfig:"C:\\Users\\tanuj\\.npmrc",npm_config_user_agent:"npm/9.6.5 node/v18.12.1 win32 x64 workspaces/false",npm_execpath:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npx-cli.js",npm_lifecycle_event:"npx",npm_lifecycle_script:"webpack",npm_node_execpath:"C:\\Program Files\\nodejs\\node.exe",npm_package_json:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend\\package.json",npm_package_name:"frontend",npm_package_version:"1.0.0",NPM_PREFIX_NPX_CLI_JS:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npx-cli.js",NPX_CLI_JS:"C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npx-cli.js",NUMBER_OF_PROCESSORS:"16",NVTOOLSEXT_PATH:"C:\\Program Files\\NVIDIA Corporation\\NvToolsExt\\",OneDrive:"C:\\Users\\tanuj\\OneDrive",OneDriveConsumer:"C:\\Users\\tanuj\\OneDrive",OPENAI_API_KEY:"test",OS:"Windows_NT",Path:"C:\\Users\\tanuj\\Code\\WriteRight\\frontend\\node_modules\\.bin;C:\\Users\\tanuj\\Code\\WriteRight\\frontend\\node_modules\\.bin;C:\\Users\\tanuj\\Code\\WriteRight\\node_modules\\.bin;C:\\Users\\tanuj\\Code\\node_modules\\.bin;C:\\Users\\tanuj\\node_modules\\.bin;C:\\Users\\node_modules\\.bin;C:\\node_modules\\.bin;C:\\Users\\tanuj\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\@npmcli\\run-script\\lib\\node-gyp-bin;C:\\Program Files\\Eclipse Adoptium\\jdk-11.0.17.8-hotspot\\bin;C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8\\bin;C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v11.8\\libnvvp;C:\\Users\\tanuj\\AppData\\Local\\Programs\\Python\\Python310\\Scripts\\;C:\\Users\\tanuj\\AppData\\Local\\Programs\\Python\\Python310\\;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\Program Files (x86)\\Eclipse Adoptium\\jdk-16.0.2.7-hotspot\\bin;C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\;C:\\Windows\\System32\\OpenSSH\\;D:\\Program Files\\PuTTY\\;C:\\Program Files (x86)\\NVIDIA Corporation\\PhysX\\Common;C:\\Program Files\\NVIDIA Corporation\\NVIDIA NvDLISR;C:\\Program Files\\Git\\cmd;C:\\ProgramData\\chocolatey\\bin;C:\\Program Files\\dotnet\\;C:\\Program Files\\Docker\\Docker\\resources\\bin;C:\\ProgramData\\DockerDesktop\\version-bin;C:\\Program Files\\WireGuard\\;C:\\Program Files\\NVIDIA Corporation\\Nsight Compute 2022.3.0\\;C:\\Program Files\\nodejs\\;C:\\Program Files\\Tailscale\\;C:\\Users\\tanuj\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\tanuj\\AppData\\Local\\atom\\bin;C:\\Program Files\\heroku\\bin;C:\\Program Files (x86)\\Nmap;C:\\Users\\tanuj\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\tanuj\\.dotnet\\tools;C:\\Users\\tanuj\\anaconda3\\Library\\bin;C:\\Users\\tanuj\\anaconda3\\Scripts;C:\\Users\\tanuj\\anaconda3\\condabin;C:\\Users\\tanuj\\AppData\\Roaming\\npm;C:\\Users\\tanuj\\AppData\\Local\\Programs\\oh-my-posh\\bin;C:\\ffmpeg-2023-05-11-git-ceb050427c-full_build\\bin",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.PY;.PYW",POSH_THEMES_PATH:"C:\\Users\\tanuj\\AppData\\Local\\Programs\\oh-my-posh\\themes",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 165 Stepping 5, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"a505",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Program Files\\WindowsPowerShell\\Modules;C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",SystemDrive:"C:",SystemRoot:"C:\\Windows",TEMP:"C:\\Users\\tanuj\\AppData\\Local\\Temp",TMP:"C:\\Users\\tanuj\\AppData\\Local\\Temp",USERDOMAIN:"TANUJS-PC",USERDOMAIN_ROAMINGPROFILE:"TANUJS-PC",USERNAME:"tanuj",USERPROFILE:"C:\\Users\\tanuj",VBOX_MSI_INSTALL_PATH:"C:\\Program Files\\Oracle\\VirtualBox\\",windir:"C:\\Windows",WSLENV:"WT_SESSION::WT_PROFILE_ID",WT_PROFILE_ID:"{0caa0dad-35be-5f56-a8ff-afceeeaa6101}",WT_SESSION:"d47979e6-8af5-40d1-a7e6-32dae0c3ba1d",ZES_ENABLE_SYSMAN:"1"}),console.log(ze),ze.initializeApp({apiKey:"AIzaSyAl2Mpvpshv2Nlo3tQ84MDbuV3gy_XtKvo",authDomain:"writeright-de7ff.firebaseapp.com",projectId:"writeright-de7ff",storageBucket:"writeright-de7ff.appspot.com",messagingSenderId:"156869202749",appId:"1:156869202749:web:6637c77cf272223cb42b54",measurementId:"G-GDF38BC12R"}),ze.firestore();const FI=document.getElementById("mainbox"),MI=document.getElementById("submit");let UI="";function VI(e,t){var n=document.getElementById("mainbox").innerHTML,r=function(e,t,n){var r=e.length;if(0==r)return[];var i,s=0,o=[];for(n||(t=t.toLowerCase(),e=e.toLowerCase());(i=t.indexOf(e,s))>-1;)o.push(i),s=i+r;return o}(e,n,!1);if(0==r.length)return!1;console.log(r);var i=r[t],s=n.substring(0,i)+'<u class="ud" id="ud">'+e+"</u>"+n.substring(i+e.length);return document.getElementById("mainbox").innerHTML=s,!0}MI.addEventListener("click",(async function(){console.log("Submitting...");const e=FI.textContent;if(FI.innerHTML=FI.textContent,e==UI)console.log("shit was right!!!!");else{let t=await async function(e){const t={model:"gpt-3.5-turbo",messages:[{role:"system",content:'Given an excerpt, identify any punctuation, capitalization, and grammatical errors, return each incorrect word rewritten correctly as well as an explaination for why they are wrong and return the full corrected excerpt in the JSON format.\n        \n        Example Input : "i cant spell good."\n\n        Example Response:\n        {\n            "i": ["I", "I should be capitalized because [detailed explaination]"],\n            "cant": ["can\'t", "You need an apostrophe because [detailed explaination]"],\n            "corrected: "I can\'t spell good.",\n        }\n        \n        REGARDLESS OF YOUR RESPONSE IT MUST BE IN THE JSON FORMAT.\n        DO NOT include any of the correct words in your response.\n        DO NOT return any opinion on how to improve the writing\'s engagement.'},{role:"user",content:e}]},n=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer test"},body:JSON.stringify(t)});return await n.json()}(e);t=JSON.parse(t.choices[0].message.content),UI=t.corrected,console.log("Response",t);for(let e in t)console.log(e),VI(e,0)}}))})();